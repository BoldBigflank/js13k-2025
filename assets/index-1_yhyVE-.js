import*as t from"https://js13kgames.com/2025/webxr/three.module.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function l(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(o){if(o.ep)return;o.ep=!0;const i=l(o);fetch(o.href,i)}})();const K=()=>[["cube_case1_1_8_2_7.5_4_0_0_0_0_7.5_4_0_#0000ff","cube_case2_3_9_2_5.5_4.5_0_0_0_0_5.5_4.5_0_#0000ff","cube_case3_8_4_2_0_7_0_0_0_0_0_8.5_0_#0000ff","cube_case4_8_1_2_0_2.5_0_0_0_0_0_2.5_0_#0000ff","cube_case5_3_9_2_-5.5_4.5_0_0_0_0_-5.5_4.5_0_#0000ff","cube_case6_1_8_2_-7.5_4_0_0_0_0_-7.5_4_0_#0000ff"],"cube_base_12_2.1_2.4_0_0.95_0_0_0_0_0_0_0_#ff0000","cube_rightReel_2_2_1_2.72_3.89_0_0_0_-45_2.72_3.89_0_#ff7300","cube_rightTape_4_4_0.2_2.81_3.91_-0.1_0_0_-45_2.81_3.91_-0.1_#c300ff","cube_leftReel_2_2_1_-2.69_3.91_0_0_0_-45_-2.75_4_0_#ff7300","sphere_dot_1_1_1_0_4_0_0_0_0_0_4_0_#9999ff","plane_label_12_3_0_0_7_1.01_90_0_0_0_7_1.01_#d3d3d3","cylinder_base_16_8_16_0_-8_0_0_0_0_0_-8_0_#00ff00"],B={uniforms:{uDirLightPos:{value:new t.Vector3},uDirLightColor:{value:new t.Color(15658734)},uAmbientLightColor:{value:new t.Color(328965)},uBaseColor:{value:new t.Color(16777215)},uLineColor1:{value:new t.Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},Y=a=>{const r=new t.Group;r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1);const l=s=>{const[g,d,n,u,h,m,_,E,S,C,M,y,w,v,G]=s.split("_"),c=new t.BoxGeometry(n,u,h);return c.translate(m-y,_-w,E-v),c.rotateX(t.MathUtils.degToRad(S)),c.rotateY(t.MathUtils.degToRad(C)),c.rotateZ(t.MathUtils.degToRad(M)),c},e=s=>{const[g,d,n,u,h,m,_,E,S,C,M,y,w,v,G]=s.split("_"),c=new t.SphereGeometry(parseFloat(n)/2,32,16);return c.scale(n/n,u/n,h/n),c.translate(m-y,_-w,E-v),c.rotateX(t.MathUtils.degToRad(S)),c.rotateY(t.MathUtils.degToRad(C)),c.rotateZ(t.MathUtils.degToRad(M)),c},o=s=>{const[g,d,n,u,h,m,_,E,S,C,M,y,w,v,G]=s.split("_"),c=new t.PlaneGeometry(n,u);return c.rotateX(t.MathUtils.degToRad(-90)),c.translate(m-y,_-w,E-v),c.rotateX(t.MathUtils.degToRad(S)),c.rotateY(t.MathUtils.degToRad(C)),c.rotateZ(t.MathUtils.degToRad(M)),c},i=s=>{const[g,d,n,u,h,m,_,E,S,C,M,y,w,v,G]=s.split("_"),c=n/2,x=new t.CylinderGeometry(c,c,h,32);return x.translate(m-y,_-w,E-v),x.rotateX(t.MathUtils.degToRad(S)),x.rotateY(t.MathUtils.degToRad(C)),x.rotateZ(t.MathUtils.degToRad(M)),x};return a.forEach(s=>{if(Array.isArray(s))r.add(Y(s));else{const[g,d,n,u,h,m,_,E,S,C,M,y,w,v,G]=s.split("_");let c=null;switch(g){case"cube":c=l(s);break;case"sphere":c=e(s);break;case"plane":c=o(s);break;case"cylinder":c=i(s);break;default:throw new Error(`Unknown shape: ${g}`)}let x=null;d.startsWith("case")?x=new t.ShaderMaterial({uniforms:{...B.uniforms},vertexShader:B.vertexShader,fragmentShader:B.fragmentShader}):x=new t.MeshStandardMaterial({color:G,side:t.DoubleSide});const A=new t.Mesh(c,x);A.name=d,A.position.set(y,w,v),r.add(A)}}),r},z=a=>{const{radius:r,depth:l,color:e}=a,o=new t.CylinderGeometry(r,r,l,32),i=new t.MeshBasicMaterial({color:e});return new t.Mesh(o,i)},Q=a=>{{const r=Y(K());return r.name="cassette",r}},$="#e81416",J="#ffa500",q="#faeb36",ee="#79c314",te="#487de7",oe="#70369d",ne="#000000",re="#ff00ff",W=[$,J,q,ee,te,oe],H=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],Z=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],ie=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]],N={color:W,title:H,artist:Z};class se{constructor(){this.currentRecord=null,this.comboType=null,this.records=[],this.reset()}addRecord(r){if(!this.currentRecord){this.currentRecord=r;return}this.comboType&&(this.currentRecord[this.comboType],this.recordsMatchSequence(this.currentRecord,r,this.comboType)?(this.currentRecord=r,this.comboCount+=1,this.comboCount>=this.records.length&&(this.solvedCombos[this.comboType]=!0)):(this.comboType=null,this.comboCount=1)),this.comboType||(this.comboType=this.recordsMatchSequence(this.currentRecord,r))}recordsMatchSequence(r,l,e){let o=null;return["color","title","artist"].forEach(s=>{if(e&&e!==s)return;const g=N[s].indexOf[r[s]];N[s].indexOf[l[s]]===(g+1)%N[s].length&&(o=s)}),o}isSolved(r){return this.solvedCombos[r]}reset(){this.currentRecord=null,this.comboType=null,this.comboCount=0,this.comboStartIndex=-1;const[r,l,e]=ie;this.records=W.map((o,i)=>({color:W[r[i]],title:H[l[i]],artist:Z[e[i]]}))}}class O{static createButton(r,l={}){const e=document.createElement("button");function o(){let n=null;async function u(_){_.addEventListener("end",h),await r.xr.setSession(_),e.textContent="EXIT VR",n=_}function h(){n.removeEventListener("end",h),e.textContent="ENTER VR",n=null}e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",e.textContent="ENTER VR";const m={...l,optionalFeatures:["local-floor","bounded-floor","layers",...l.optionalFeatures||[]]};e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){n===null?navigator.xr.requestSession("immersive-vr",m).then(u):(n.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",m).then(u).catch(_=>{console.warn(_)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",m).then(u).catch(_=>{console.warn(_)})}function i(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}function s(){i(),e.textContent="VR NOT SUPPORTED"}function g(n){i(),console.warn("Exception when trying to call xr.isSessionSupported",n),e.textContent="VR NOT ALLOWED"}function d(n){n.style.position="absolute",n.style.bottom="20px",n.style.padding="12px 6px",n.style.border="1px solid #fff",n.style.borderRadius="4px",n.style.background="rgba(0,0,0,0.1)",n.style.color="#fff",n.style.font="normal 13px sans-serif",n.style.textAlign="center",n.style.opacity="0.5",n.style.outline="none",n.style.zIndex="999"}if("xr"in navigator)return e.id="VRButton",e.style.display="none",d(e),navigator.xr.isSessionSupported("immersive-vr").then(function(n){n?o():s(),n&&O.xrSessionIsGranted&&e.click()}).catch(g),e;{const n=document.createElement("a");return window.isSecureContext===!1?(n.href=document.location.href.replace(/^http:/,"https:"),n.innerHTML="WEBXR NEEDS HTTPS"):(n.href="https://immersiveweb.dev/",n.innerHTML="WEBXR NOT AVAILABLE"),n.style.left="calc(50% - 90px)",n.style.width="180px",n.style.textDecoration="none",d(n),n}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{O.xrSessionIsGranted=!0})}}}O.xrSessionIsGranted=!1;O.registerSessionGrantedListener();const ae=(a=512)=>{const r=document.createElement("canvas");r.width=a,r.height=a;const l=r.getContext("2d");return[r,l]},b=.0254,le=(a,r)=>{const l=[a,r],[e,o]=ae();o.fillStyle=re,o.fillRect(0,0,e.width,e.height),o.fillStyle=ne,o.font="64px Helvetica",o.scale(1,l.length),o.textBaseline="top",o.textAlign="left";let i=64;if(l.length>0){const d=o.measureText(l[0]);i=Math.min(64*448/d.width,512),o.font=`${i}px Helvetica`}l.forEach((d,n)=>{o.fillText(`${d}`,32,32+i*n)});const s=new t.CanvasTexture(e);return new t.MeshBasicMaterial({map:s})},ce=({color:a,title:r,artist:l})=>{const e=new t.Group,o=new t.RingGeometry(4,7,32);o.scale(b,b,b);const i=new t.MeshStandardMaterial({color:a,side:t.DoubleSide});e.add(new t.Mesh(o,i));const s=new t.RingGeometry(.25,4,32);s.scale(b,b,b);const g=new t.MeshStandardMaterial({color:16777215,side:t.DoubleSide});e.add(new t.Mesh(s,g));const d=new t.PlaneGeometry(5,2);d.translate(0,2,.001),d.scale(b,b,b);const n=le(r,l);e.add(new t.Mesh(d,n));const u=e.clone();return u.rotation.set(0,Math.PI,0),u.position.set(0,0,-.002),e.add(u),e};new t.Clock;let D,p,U,f,L,T,P,I,X,R;const de=async()=>{document.getElementById("intro").style.display="none";const r=document.getElementById("c");if(!r)return;r.style.display="block";const l=new se;console.log(l.records),p=new t.Scene,D=new t.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),D.position.set(0,1,0);const e=new t.AmbientLight(16777215,.8);p.add(e);const o=new t.DirectionalLight(16777215,.8);o.position.set(6,10,8),o.castShadow=!0,o.target.position.set(0,0,0),p.add(o),p.add(o.target),R=Q(),R.position.set(0,0,-20),R.userData.isPickable=!0,R.onPointerPick=()=>{console.log("PICK")},R.onPointerMove=()=>{console.log("MOVE")},p.add(R),l.records.forEach((n,u)=>{const h=ce(n);h.position.set(u*1-3,1,-1),h.userData.isPickable=!0,h.onPointerPick=()=>{console.log("picked",h)},p.add(h)}),f=new t.WebGLRenderer({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor("#000000"),f.xr.addEventListener("sessionstart",()=>f.xr.getReferenceSpace()),f.xr.enabled=!0,f.setAnimationLoop(ue),document.body.appendChild(O.createButton(f)),document.body.appendChild(f.domElement),T=f.xr.getController(0),T.addEventListener("selectstart",k),T.addEventListener("selectend",F),p.add(T),P=f.xr.getController(1),P.addEventListener("selectstart",k),P.addEventListener("selectend",F),p.add(P),I=f.xr.getControllerGrip(0);const i=z({radius:.01,depth:.2,color:16711935});i.name="controllerMesh1",i.rotateX(Math.PI/4),I.add(i),p.add(I),X=f.xr.getControllerGrip(1);const s=z({radius:.01,depth:.2,color:65280});s.rotateX(Math.PI/4),X.add(s),p.add(X);const g=new t.BufferGeometry().setFromPoints([new t.Vector3(0,0,0),new t.Vector3(0,0,-1)]),d=new t.Line(g);d.name="line",d.scale.z=5,T.add(d.clone()),P.add(d.clone()),U=new t.Raycaster,window.addEventListener("resize",he,!1)};function k(a){console.log("onSelectStart"),L=a.target;const r=j(L);r.length>0&&r.forEach(({object:l,distance:e})=>{let o=l;for(;o;){if(o.onPointerPick){o.onPointerPick();break}o=o.parent}}),L.userData.targetRayMode=a.data.targetRayMode}function F(a){console.log("onSelectEnd"),L=a.target,L.userData.selected!==void 0&&(L.userData.selected,L.userData.selected=void 0)}function j(a){return a.updateMatrixWorld(),U.setFromXRController(a),U.intersectObjects(p.children,!0)}function V(a){if(a.userData.targetRayMode==="screen"||a.userData.selected!==void 0)return;const r=a.getObjectByName("line"),l=j(a);r.scale.z=5,l.length>0&&l.forEach(({object:e,distance:o})=>{let i=e;for(;i;){if(i.userData.isPickable){r.scale.z=o;break}i=i.parent}})}function ue(){R.rotation.y+=.005,V(T),V(P),f.render(p,D)}const he=()=>{D.aspect=window.innerWidth/window.innerHeight,D.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("playButton");a.onclick=de});
