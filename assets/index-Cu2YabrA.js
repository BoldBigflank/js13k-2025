import*as e from"https://js13kgames.com/2025/webxr/three.module.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={uDirLightPos:{value:new e.Vector3},uDirLightColor:{value:new e.Color(15658734)},uAmbientLightColor:{value:new e.Color(328965)},uBaseColor:{value:new e.Color(16777215)},uLineColor1:{value:new e.Color(0)}},n=_=>{const r=new e.Group;return r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),_.forEach(_=>{if(null!==_)if(Array.isArray(_))r.add(n(_));else{const[n,o,s,i,a,c,l,d,u,f,h,p,g,m,b]=_.split("_");let y=null;switch(n){case"cube":y=(t=>{const[n,_,r,o,s,i,a,c,l,d,u,f,h,p,g]=t.split("_"),m=new e.BoxGeometry(r,o,s);return m.translate(i-f,a-h,c-p),m.rotateX(e.MathUtils.degToRad(l)),m.rotateY(e.MathUtils.degToRad(d)),m.rotateZ(e.MathUtils.degToRad(u)),m})(_);break;case"sphere":y=(t=>{const[n,_,r,o,s,i,a,c,l,d,u,f,h,p,g]=t.split("_"),m=new e.SphereGeometry(parseFloat(r)/2,32,16);return m.scale(r/r,o/r,s/r),m.translate(i-f,a-h,c-p),m.rotateX(e.MathUtils.degToRad(l)),m.rotateY(e.MathUtils.degToRad(d)),m.rotateZ(e.MathUtils.degToRad(u)),m})(_);break;case"plane":y=(t=>{const[n,_,r,o,s,i,a,c,l,d,u,f,h,p,g]=t.split("_"),m=new e.PlaneGeometry(r,o);return m.rotateX(e.MathUtils.degToRad(-90)),m.translate(i-f,a-h,c-p),m.rotateX(e.MathUtils.degToRad(l)),m.rotateY(e.MathUtils.degToRad(d)),m.rotateZ(e.MathUtils.degToRad(u)),m})(_);break;case"cylinder":y=(t=>{const[n,_,r,o,s,i,a,c,l,d,u,f,h,p,g]=t.split("_"),m=r/2,b=new e.CylinderGeometry(m,m,o,32);b.translate(i-f,a-h,c-p),b.scale(1,1,s/r);const y=e.MathUtils.degToRad(l),v=e.MathUtils.degToRad(d),w=e.MathUtils.degToRad(u),x=new e.Euler(y,v,w);return b.applyQuaternion((new e.Quaternion).setFromEuler(x)),b})(_);break;case"pyramid":y=(t=>{const[n,_,r,o,s,i,a,c,l,d,u,f,h,p,g]=t.split("_"),m=Math.sqrt(r*r+r*r)/2,b=new e.CylinderGeometry(0,m,o,4,1,!1,Math.PI/4);return b.scale(1,1,s/r),b.translate(i-f,a-h+.3*o,c-p),b.rotateX(e.MathUtils.degToRad(l)),b.rotateY(e.MathUtils.degToRad(d)),b.rotateZ(e.MathUtils.degToRad(u)),b})(_);break;default:throw new Error(`Unknown shape: ${n}`)}let v=null;v=o.startsWith("case")?new e.ShaderMaterial({uniforms:{...t},vertexShader:"\n\n\t\tvarying vec3 vNormal;\n\n\t\tvoid main() {\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\tvNormal = normalize( normalMatrix * normal );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 uBaseColor;\n\t\tuniform vec3 uLineColor1;\n\t\tuniform vec3 uLineColor2;\n\t\tuniform vec3 uLineColor3;\n\t\tuniform vec3 uLineColor4;\n\n\t\tuniform vec3 uDirLightPos;\n\t\tuniform vec3 uDirLightColor;\n\n\t\tuniform vec3 uAmbientLightColor;\n\n\t\tvarying vec3 vNormal;\n\n\t\tvoid main() {\n\n\t\t\tfloat directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);\n\t\t\tvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;\n\n\t\t\tgl_FragColor = vec4( uBaseColor, 1.0 );\n\n\t\t\tif ( length(lightWeighting) < 1.00 ) {\n\n\t\t\t\tif ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {\n\n\t\t\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( length(lightWeighting) < 0.50 ) {\n\n\t\t\t\tif ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {\n\n\t\t\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t#include <colorspace_fragment>\n\n\t\t}"}):new e.MeshStandardMaterial({color:b,side:e.DoubleSide});const w=new e.Mesh(y,v);w.name=o,w.position.set(p,g,m),r.add(w)}}),r},_=e=>{if("cassette"===e){const e=n([["cube_case1_1_8_2_7.50_4_0_0_0_0_7.50_4_0_#0000ff","cube_case2_3_9_2_5.50_4.50_0_0_0_0_5.50_4.50_0_#0000ff","cube_case3_8_4_2_0_7_0_0_0_0_0_8.50_0_#0000ff","cube_case4_8_1_2_0_2.50_0_0_0_0_0_2.50_0_#0000ff","cube_case5_3_9_2_-5.50_4.50_0_0_0_0_-5.50_4.50_0_#0000ff","cube_case6_1_8_2_-7.50_4_0_0_0_0_-7.50_4_0_#0000ff"],"cube_base_12_2.10_2.40_0_0.95_0_0_0_0_0_0_0_#ff0000","cube_rightReel_2_2_1_2.72_3.89_0_0_0_-45_2.72_3.89_0_#ff7300","cube_rightTape_4_4_0.20_2.81_3.91_-0.10_0_0_-45_2.81_3.91_-0.10_#c300ff","cube_leftReel_2_2_1_-2.69_3.91_0_0_0_-45_-2.75_4_0_#ff7300","sphere_dot_1_1_1_0_4_0_0_0_0_0_4_0_#9999ff","plane_label_12_3_0_0_7_1.01_90_0_0_0_7_1.01_#d3d3d3","cylinder_base_16_8_16_0_-4_0_0_0_0_0_-4_0_#00ff00"]);return e.name="cassette",e}if("arena"===e){const e=n([[["cube_complete-0_0.3_0.1_0.1_-0.75_1.05_-0.45_0_0_0_-0.75_1.05_-0.45_#ff0000","cube_complete-1_0.3_0.1_0.1_-0.75_1.05_-0.35_0_0_0_-0.75_1.05_-0.35_#00ff00","cube_complete-2_0.3_0.1_0.1_-0.75_1.05_-0.25_0_0_0_-0.75_1.05_-0.25_#0000ff"],["sphere_progress-0_0.2_0.2_0.2_-0.75_1.05_-0.75_0_0_0_-0.75_1.05_-0.75_#fffb00","sphere_progress-1_0.2_0.2_0.2_-0.55_1.05_-0.75_0_0_0_-0.55_1.05_-0.75_#fffb00","sphere_progress-2_0.2_0.2_0.2_-0.35_1.05_-0.75_0_0_0_-0.35_1.05_-0.75_#fffb00","sphere_progress-3_0.2_0.2_0.2_-0.15_1.05_-0.75_0_0_0_-0.15_1.05_-0.75_#fffb00","sphere_progress-4_0.2_0.2_0.2_0.05_1.05_-0.75_0_0_0_0.05_1.05_-0.75_#fffb00","sphere_progress-5_0.2_0.2_0.2_0.25_1.05_-0.75_0_0_0_0.25_1.05_-0.75_#fffb00"],"cube_desk_2_0.9_1_0_0.45_-0.5_0_0_0_0_-0.1_0_#fffb00","cube_record-rack_0.4_0.1_0.8_0.7_0.95_-0.5_0_0_0_0.7_0.95_-0.5_#b0ffb0","cube_progress-bar_1.3_0.1_0.3_-0.25_0.95_-0.75_0_0_0_-0.25_0.95_-0.75_#d3d3d3","cube_cube_0.3_0.1_0.4_-0.75_0.95_-0.3_0_0_0_-0.75_0.95_-0.3_#9999ff","cube_cube_0.4_0.1_0.4_-0.3_0.95_-0.3_0_0_0_-0.3_0.95_-0.3_#d3d3d3","cube_tableA_0.4_0.1_0.4_0.2_0.95_-0.3_0_0_0_0.2_1.01_-0.3_#b0ffb0","cylinder_pad_0.4_0.02_0.4_0.2_1_-0.3_0_0_0_0.2_1_-0.3_#ff0000"],"cube_cube_22_1_19_0_-2.5_-4.5_0_0_0_0_-3_-4_#ff00ff","cube_cube_12_1_12_0_-1.5_-4_0_0_0_0_-2_-4_#ff0000","cube_cube_8_1_3_0_-0.5_0.5_0_0_0_0_-1_-4_#c300ff","cube_pillar_1_4_1_7.5_0_-2.5_0_0_0_8_0_-3_#fffb00","cube_pillar_1_4_1_7.5_0_-6.5_0_0_0_8_0_-7_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_-7.5_0_-2.5_0_0_0_-7_0_-3_#fffb00","cube_pillar_1_4_1_-7.5_0_1.5_0_0_0_-7_0_1_#fffb00","cube_pillar_1_4_1_7.5_0_1.5_0_0_0_8_0_1_#fffb00","cube_pillar_1_4_1_-7.5_0_-6.5_0_0_0_-7_0_-7_#fffb00","cube_pillar_1_4_1_-7.5_0_-10.5_0_0_0_-7_0_-11_#fffb00","cube_cube_4_1_16_9_2.5_-6_0_0_0_8_2_0_#00ff00","cube_cube_4_1_16_-9_2.5_-6_0_0_0_-10_2_0_#00ff00"]);return e.name="arena",e}if("cat"===e){const e=n(["sphere_head_16_16_16_0_8_0_0_0_0_0_8_0_#c300ff",["cylinder_leftEye_4_1_4_-3_11_-6.3_-60_0_25_-3_11_-6.3_#fffb00","sphere_leftPupil_2_2_4_-3.6_11.3_-7_-60_0_25_-3.6_11.3_-7_#c300ff","cylinder_rightEye_4_1_4_3_11_-6.3_-60_0_-25_3_11_-6.3_#fffb00","sphere_rightPupil_2_2_4_3.4_11.3_-7_-60_0_-25_3.4_11.3_-7_#c300ff"],["cube_rightCheek_3_3_2_1.84_6.53_-7.5_-25_0_80_1.84_6.53_-7.5_#0000ff","cube_leftCheek_3_3_2_-1.91_6.48_-7.5_0_23_10_-1.91_6.48_-7.5_#0000ff","cube_tongue_2_2_2_0_5_-7_0_0_0_0_4_-7_#ff0000","pyramid_pyramid_3_1.6_1_0_8.2_-8_-180_0_0_0_8.2_-8_#ff00ff"],["pyramid_ear_6_11_4_-4.86_15.55_-1.28_-14_-6_24_-4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_-5.04_15.94_-1.59_-14_-6_24_-5.04_15.94_-1.59_#fffb00","pyramid_ear_6_11_4_4.86_15.55_-1.28_-14_6_-24_4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_5.04_15.94_-1.59_-14_6_-24_5.04_15.94_-1.59_#fffb00"],["cylinder_cylinder_0.2_6_0.2_-3.93_6_-8.92_0_-15_90_-3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_7.52_-8.5_0_-15_75_-4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_4.48_-8.5_0_-15_105_-4.87_4.48_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_7.52_-8.5_180_-15_-105_4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_6_0.2_3.93_6_-8.92_0_-165_90_3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_4.48_-8.5_180_-15_-75_4.87_4.48_-8.5_#d3d3d3"]]);return e.name="cat",e}if("paw"===e){const e=n(["cylinder_cylinder_4_6_2_0_-1_0_0_0_0_0_-1_0_#c300ff","sphere_sphere_4_4_2_0_2_0_0_0_0_0_2_0_#c300ff","cube_cube_0.3_1_0.3_-1.15_3.5_-0.55_-77_0_0_-1.15_3.5_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_-0.45_3.9_-0.55_-77_0_0_-0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_0.45_3.9_-0.55_-77_0_0_0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_1.05_3.6_-0.55_-77_0_0_1.05_3.6_-0.55_#d3d3d3","cube_cube_2_0.7_0.4_0_1.85_-0.9_0_0_0_0_1.5_-0.1_#ff0000","cube_cube_0.8_0.5_1.1_0_2.45_-0.55_0_0_0_0_2.2_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-1.15_2.7_-0.8_0_0_0_-1.15_2.7_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-0.45_3.1_-0.8_0_0_0_-0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_0.45_3.1_-0.8_0_0_0_0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_1.05_2.7_-0.8_0_0_0_1.05_2.7_-0.1_#ff0000"]);return e.name="paw",e.scale.set(.03125,.03125,.03125),e}return null};class r{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return r._instance||(r._instance=new r),r._instance}on(e,t){this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(t)}off(e,t){this.callbacks[e]=(this.callbacks[e]||[]).filter(e=>e!==t)}emit(e,...t){(this.callbacks[e]||[]).forEach(e=>e(...t))}_reset(){Object.keys(this.callbacks).forEach(e=>{delete this.callbacks[e]})}getCallbacks(){return this.callbacks}}const o="#e81416",s="#79c314",i="#487de7",a="#000000",c=[o,"#ffa500","#faeb36",s,i,"#70369d"],l=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],d=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],u=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]];class f{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset()}addVinylByIndex(e){const{color:t,artist:n,title:_}=this.vinyls[e],o=c.indexOf(t),s=l.indexOf(n),i=d.indexOf(_);o===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===c.length&&(this.progress.color.solved=!0),this.progress.color.currentIndex=o):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),s===(this.progress.artist.currentIndex+1)%l.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===l.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=s,i===(this.progress.title.currentIndex+1)%d.length?(this.progress.title.correctCount++,this.progress.title.correctCount===d.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=i,this.queue.unshift(e),r.Instance.emit("progress",this.progress),r.Instance.emit("debug",JSON.stringify(this.progress))}getVinylInQueue(e){return this.vinyls[this.queue[e]]}isSolved(e){return this.progress[e].solved}reset(){this.queue=[],this.selected={};const[e,t,n]=u;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-2,correctCount:0,solved:!1},title:{currentIndex:-2,correctCount:0,solved:!1}},this.vinyls=c.map((e,t)=>({index:t,color:e,artist:"",title:""})),e.forEach((e,t)=>{this.vinyls[e].color=c[t]}),t.forEach((e,t)=>{this.vinyls[e].artist=l[t]}),n.forEach((e,t)=>{this.vinyls[e].title=d[t]}),r.Instance.emit("progress",this.progress)}}class h{static createButton(e,t={}){const n=document.createElement("button");function _(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",r(n),navigator.xr.isSessionSupported("immersive-vr").then(function(r){r?function(){let _=null;async function r(t){t.addEventListener("end",o),await e.xr.setSession(t),n.textContent="EXIT VR",_=t}function o(){_.removeEventListener("end",o),n.textContent="ENTER VR",_=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";const s={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){null===_?navigator.xr.requestSession("immersive-vr",s).then(r):(_.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch(e=>{}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch(e=>{})}():(_(),n.textContent="VR NOT SUPPORTED"),r&&h.xrSessionIsGranted&&n.click()}).catch(function(e){_(),n.textContent="VR NOT ALLOWED"}),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}static registerSessionGrantedListener(){if("undefined"!=typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{h.xrSessionIsGranted=!0})}}}h.xrSessionIsGranted=!1,h.registerSessionGrantedListener();const p=44100,g=new(window.AudioContext||window.webkitAudioContext);let m=0;const b=(e=512)=>{const t=document.createElement("canvas");t.width=e,t.height=e;const n=t.getContext("2d");return[t,n]},y={},v=new e.Color,w=(t,n)=>{const _=1==n?.glow,r=`color-${t}-${_}`;if(y[r])return y[r];const o=new(_?e.MeshBasicMaterial:e.MeshStandardMaterial)({color:t,side:e.FrontSide});return y[r]=o,o},x=(t,n)=>{v.set(n);const _="string"==typeof n?n:`#${v.getHexString()}`,r=`text-${_}-${t.join("")}`;if(y[r])return y[r];const o=1024,[s,i]=b(o);i.textAlign="center",t.forEach((e,n)=>{i.strokeStyle=a,i.font="64px monospace",i.textBaseline="middle",i.lineWidth=8,i.strokeText(e,512,.5*(o-64*t.length)+64*n),i.fillStyle=_,i.fillText(e,512,.5*(o-64*t.length)+64*n)});const c=new e.CanvasTexture(s),l=new e.MeshBasicMaterial({map:c,transparent:!0});return y[r]=l,l},C=.0254,M=e=>e*e;class E{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new e.Clock}static get Instance(){return E._instance||(E._instance=new E),E._instance}initScene(e){this.scene||(this.scene=e,this.clock.start())}update(){const t=1e3*this.clock.getElapsedTime();this.animations=this.animations.filter(n=>{const _=t-n.startTime,r=n.endTime-n.startTime,o=(s=_/r,Math.min(Math.max(s,0),1));var s;if(t>=n.endTime)return n.loop?(n.startTime=t,n.endTime=t+r,n.end.position&&n.mesh.position.copy(n.start.position),n.end.rotation&&n.mesh.rotation.copy(n.start.rotation),n.end.scaling&&n.mesh.scale.copy(n.start.scaling),!0):(n.end.position&&n.mesh.position.copy(n.end.position),n.end.rotation&&n.mesh.rotation.copy(n.end.rotation),n.end.scaling&&n.mesh.scale.copy(n.end.scaling),n.resolve&&(n.resolve(),n.resolve=void 0,n.reject=void 0),!1);if(n.end.position&&n.mesh.position.lerpVectors(n.start.position,n.end.position,n.easeFunc(o)),n.end.rotation){const t=n.start.rotation,_=n.end.rotation,r=new e.Euler;r.x=t.x+(_.x-t.x)*n.easeFunc(o),r.y=t.y+(_.y-t.y)*n.easeFunc(o),r.z=t.z+(_.z-t.z)*n.easeFunc(o),n.mesh.rotation.copy(r)}return n.end.scaling&&n.mesh.scale.lerpVectors(n.start.scaling,n.end.scaling,n.easeFunc(o)),!0})}animateTransform(e){const{mesh:t,end:n}=e,_=e.duration||1e3,r=e.delay||0,o=e.ease||M,s=1e3*this.clock.getElapsedTime();let i,a;const c=new Promise((e,t)=>{i=e,a=t});return this.animations.push({mesh:t,start:{position:t.position.clone(),rotation:t.rotation.clone(),scaling:t.scale.clone()},end:n,easeFunc:o,startTime:s+r,endTime:s+r+_,loop:e.loop||!1,resolve:i,reject:a}),c}cancelAnimation(e,t=!1){const n=this.animations.filter(t=>t.mesh===e);n.length&&(n.forEach(n=>{t&&(n.end.position&&e.position.copy(n.end.position),n.end.rotation&&e.rotation.copy(n.end.rotation),n.end.scaling&&e.scale.copy(n.end.scaling)),n.reject&&(n.reject(),n.resolve=void 0,n.reject=void 0)}),this.animations=this.animations.filter(t=>t.mesh!==e))}}const I={color:o,artist:s,title:i};let P,k,T,S,L,R,B,D,O;const A=new e.Vector3(0,0,.3),N=async()=>{document.getElementById("intro").style.display="none",document.getElementById("playButton").setAttribute("disabled","true");const t=document.getElementById("c");if(!t)return;t.style.display="block",S=new e.WebGLRenderer({antialias:!0}),S.setPixelRatio(window.devicePixelRatio),S.setSize(window.innerWidth,window.innerHeight),S.setClearColor("#000000"),S.xr.addEventListener("sessionstart",j),S.xr.enabled=!0,S.setAnimationLoop(z),document.body.appendChild(h.createButton(S)),document.body.appendChild(S.domElement);const n=new f;k=new e.Scene,P=new e.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),P.position.set(0,2,1),P.rotation.set(-1*Math.PI/12,0,0),P.name="camera",k.add(P),E.Instance.initScene(k);const o=new e.AmbientLight(16777215,.8);k.add(o);const l=new e.DirectionalLight(16777215,.8);l.position.set(6,10,8),l.castShadow=!0,l.target.position.set(0,0,0),k.add(l),k.add(l.target);const d=(()=>{const t=new e.Group;t.name="debugScreen",t.renderOrder=1;const n=new e.PlaneGeometry(5,5);n.translate(0,-2,0);const _=x(["You win!","Thanks for playing","Created by Alex Swan"],"white"),o=new e.Mesh(n,_);return t.add(o),o.position.set(0,0,0),o.visible=!1,r.Instance.on("progress",e=>{e.color.solved&&e.artist.solved&&e.title.solved&&(o.userData.solved=!0,o.visible=!0,o.material.needsUpdate=!0)}),t})();d.position.set(0,4,-1),k.add(d),D=_("cassette"),D.position.set(0,0,-20),D.userData.isPickable=!0,k.add(D),E.Instance.animateTransform({mesh:D,end:{rotation:new e.Euler(0,2*Math.PI-.01,0)},duration:3e3,ease:e=>e,loop:!0});const u=_("arena"),y=u.getObjectByName("tableA");k.add(u);const v=_("cat");v.position.set(-3,1,0),v.scale.set(.1,.1,.1),k.add(v);const M=v.clone(!0);M.name="catMesh2",M.position.set(3,1,-1),M.rotation.set(0,Math.PI/2,0),k.add(M);const L=((t,n)=>{const o=new e.Group;o.name="Witch"+ ++m;const s=[],i=_("cat");return i.scale.set(.03,.03,.03),o.add(i),i.position.set(0,-.25,-.05),r.Instance.on("tick",()=>{if(n.xr?.getCamera()&&n.xr?.getCamera()){const t=n.xr?.getCamera();if(s.push(t.quaternion.clone()),s.length>60){let t=s.shift();const n=(new e.Quaternion).setFromEuler(new e.Euler(0,Math.PI,0));t&&o.quaternion.copy(n.multiply(t))}}}),o.userData.isPickable=!0,o.onPointerPick=()=>{((...e)=>{((...e)=>{let t=g.createBufferSource(),n=g.createBuffer(e.length,e[0].length,p);e.map((e,t)=>n.getChannelData(t).set(e)),t.buffer=n,t.connect(g.destination),t.start()})(((e=1,t=.05,n=220,_=0,r=0,o=.1,s=0,i=1,a=0,c=0,l=0,d=0,u=0,f=0,h=0,g=0,m=0,b=1,y=0,v=0)=>{let w,x,C=2*Math.PI,M=a*=500*C/p**2,E=(0<h?1:-1)*C/4,I=n*=(1+2*t*Math.random()-t)*C/p,P=[],k=0,T=0,S=0,L=1,R=0,B=0,D=0;for(c*=500*C/p**3,h*=C/p,l*=C/p,d*=p,u=p*u|0,x=(_=99+p*_)+(y*=p)+(r*=p)+(o*=p)+(m*=p)|0;S<x;P[S++]=D)++B%(100*g|0)||(D=s?1<s?2<s?3<s?Math.sin((k%C)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/C%2+2)%2:1-4*Math.abs(Math.round(k/C)-k/C):Math.sin(k),D=(u?1-v+v*Math.sin(2*Math.PI*S/u):1)*(0<D?1:-1)*Math.abs(D)**i*e*.3*(S<_?S/_:S<_+y?1-(S-_)/y*(1-b):S<_+y+r?b:S<x-m?(x-S-m)/o*b:0),D=m?D/2+(m>S?0:(S<x-m?1:(x-S)/m)*P[S-m|0]/2):D),w=(n+=a+=c)*Math.sin(T*h-E),k+=w-w*f*(1-1e9*(Math.sin(S)+1)%2),T+=w-w*f*(1-1e9*(Math.sin(S)**2+1)%2),L&&++L>d&&(n+=l,I+=l,L=0),!u||++R%u||(n=I,a=M,L=L||1);return P})(...e))})(...[1.01,,275,.01,.01,.15,1,1.03,-3.7,,-93,.07,,,,-.1,,.5,.04,.09])},t.add(o),o})(k,S);L.position.set(0,1.5,-1),L.rotation.set(0,Math.PI,0),n.vinyls.forEach((t,_)=>{const r=(({color:t,artist:n,title:_})=>{const r=new e.Group,o=new e.RingGeometry(4,7,32);o.scale(C,C,C);const c=w(t,{glow:!0});r.add(new e.Mesh(o,c));const l=new e.RingGeometry(.25,4,32);l.scale(C,C,C);const d=w(16777215,{});r.add(new e.Mesh(l,d));const u=new e.PlaneGeometry(14,14);u.translate(0,0,.001),u.scale(C,C,C);const f=((t,n)=>{const[_,r]=b(1024);r.fillStyle=a,r.strokeStyle=a,r.lineWidth=8,r.beginPath(),r.arc(512,512,20,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(512,512,288,0,2*Math.PI),r.stroke(),r.textAlign="center",t&&(r.font="64px monospace",r.textBaseline="middle",r.strokeStyle=a,r.lineWidth=8,r.strokeText(t,512,430.08),r.fillStyle=s,r.fillText(t,512,430.08)),n&&(r.font="96px monospace",r.textBaseline="bottom",r.fillStyle=i,r.strokeText(n,512,696.32),r.fillText(n,512,696.32));const o=new e.CanvasTexture(_);return o.encoding=e.LinearSRGBColorSpace,new e.MeshBasicMaterial({map:o,transparent:!0})})(n,_);r.add(new e.Mesh(u,f));const h=r.clone();return h.rotation.set(0,Math.PI,0),h.position.set(0,0,-.002),r.add(h),r})(t);r.name=`vinyl-${_}`;const o=new e.Vector3(.7,1.15,-.2-.125*_);r.position.copy(o),r.userData.originalPosition=o,r.userData.isPickable=!0,r.userData.recordIndex=_,r.userData.returnToOriginalPosition=()=>{k.attach(r),E.Instance.cancelAnimation(r),E.Instance.animateTransform({mesh:r,end:{position:r.userData.originalPosition,rotation:new e.Euler(0,0,0)},duration:100})},r.onPointerPick=t=>{if(t.userData.selected)return;n.selected[t.id]=_;const o=t.getObjectByName("target");o&&(E.Instance.cancelAnimation(r),o.attach(r),E.Instance.animateTransform({mesh:r,end:{position:new e.Vector3(0,0,0),rotation:new e.Euler(0,Math.PI/2,0)},duration:60}),t.userData.selected=r)},r.onPointerDrop=t=>{if(E.Instance.cancelAnimation(r,!0),r.getWorldPosition(new e.Vector3).distanceTo(y.getWorldPosition(new e.Vector3))<.3)return n.addVinylByIndex(r.userData.recordIndex),delete n.selected[t.id],t.userData.selected=void 0,y.children.forEach(e=>{e.userData.returnToOriginalPosition&&e.userData.returnToOriginalPosition()}),y.attach(r),void E.Instance.animateTransform({mesh:r,end:{position:new e.Vector3(0,.01,0),rotation:new e.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{E.Instance.animateTransform({mesh:r,end:{rotation:new e.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:e=>e,duration:1800,loop:!0})});r.userData.returnToOriginalPosition(),t.userData.selected=void 0},k.add(r)}),R=S.xr.getController(0),R.addEventListener("connected",W),R.addEventListener("selectstart",F),R.addEventListener("selectend",G),R.addEventListener("squeezestart",F),R.addEventListener("squeezeend",G),k.add(R),B=S.xr.getController(1),B.addEventListener("connected",W),B.addEventListener("selectstart",F),B.addEventListener("selectend",G),B.addEventListener("squeezestart",F),B.addEventListener("squeezeend",G),k.add(B),T=new e.Raycaster,window.addEventListener("resize",q,!1),r.Instance.on("progress",t=>{let _="color";t.artist.correctCount>=t[_].correctCount&&(_="artist"),t.title.correctCount>=t[_].correctCount&&(_="title");for(let o=0;o<6;o++){const r=n.getVinylInQueue(t[_].correctCount-o-1),s=u.getObjectByName(`progress-${o}`);let i=o<t[_].correctCount?I[_]:0;if(o<t[_].correctCount&&"color"===_&&(i=c[o]),s){s.visible=!0,s.material.color.set(i),s.material.emissive.set(i),s.material.needsUpdate=!0;let n=s.getObjectByName("progress-label");if(!n){const t=new e.PlaneGeometry(1,1);t.translate(.1,.1,.15),t.rotateZ(Math.PI/8),n=new e.Mesh(t),n.renderOrder=1,n.name="progress-label",s.add(n)}n.visible=!!(o<t[_].correctCount&&r),r&&(n.material=x([r[_]],i)),"color"===_&&(n.visible=!1),t[_].solved&&(n.visible=!1)}}const r=Object.keys(t);for(let e=0;e<r.length;e++){const n=r[e],_=u.getObjectByName(`complete-${e}`),o=t[n].solved?I[n]:0;_&&(_.visible=!0,_.material.color.set(o),_.material.emissive.set(o),_.material.needsUpdate=!0)}}),n.reset()};function j(){O=S.xr.getReferenceSpace();const t={x:-1*A.x,y:-1*A.y,z:-1*A.z,w:1},n=new e.Quaternion,_=new XRRigidTransform(t,n),r=O.getOffsetReferenceSpace(_);S.xr.setReferenceSpace(r)}function W(t){const n=t.target,o="left"===t.data.handedness?-1:1,s=t.data.hand?0:o*Math.PI/2;if(r.Instance.emit("debug",`Hand: ${t.data.hand}`),!n.getObjectByName("target")){const t=new e.Group;t.name="target",t.rotation.set(0,0,0),t.position.set(-1*o*.035,.05,-.12),n.add(t)}let i=n.getObjectByName("paw");i||(i=_("paw"),i.position.set(0,0,.15),i.rotation.set(3*Math.PI/2,s,0),n.add(i.clone(!0)));let a=n.getObjectByName("line");if(!a){const t=(new e.BufferGeometry).setFromPoints([new e.Vector3(0,0,0),new e.Vector3(0,0,-1)]);a=new e.Line(t),a.material.color.set(16711680),a.name="line",a.scale.z=5,n.add(a)}}function F(e){L=e.target;const t=V(L);if(t.length>0){let e=!1;t.forEach(({object:t,distance:n})=>{if(e)return;let _=t;for(;_;){if(_.onPointerPick){_.onPointerPick(L),e=!0,L.getObjectByName("line").visible=!1;break}_=_.parent}})}L.userData.targetRayMode=e.data.targetRayMode}function G(e){L=e.target;const t=L.userData.selected;t?.onPointerDrop&&t.onPointerDrop(L),L.getObjectByName("line").visible=!0}function V(e){return e.updateMatrixWorld(),T.setFromXRController(e),T.intersectObjects(k.children,!0)}function U(e){if("screen"===e.userData.targetRayMode)return;if(void 0!==e.userData.selected)return;const t=e.getObjectByName("line"),n=V(e);if(t&&(t.scale.z=5),n.length>0){let e=!1;n.forEach(({object:n,distance:_})=>{if(e)return;let r=n;for(;r;){if(r.userData.isPickable){t&&(t.scale.z=_),e=!0;break}r=r.parent}})}}function z(){E.Instance.update(),r.Instance.emit("tick"),U(R),U(B),S.render(k,P)}const q=()=>{P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),S.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{document.getElementById("playButton").onclick=N});
