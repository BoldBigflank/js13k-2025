import*as n from"https://js13kgames.com/2025/webxr/three.module.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const $=()=>[["cube_case1_1_8_2_7.5_4_0_0_0_0_7.5_4_0_#0000ff","cube_case2_3_9_2_5.5_4.5_0_0_0_0_5.5_4.5_0_#0000ff","cube_case3_8_4_2_0_7_0_0_0_0_0_8.5_0_#0000ff","cube_case4_8_1_2_0_2.5_0_0_0_0_0_2.5_0_#0000ff","cube_case5_3_9_2_-5.5_4.5_0_0_0_0_-5.5_4.5_0_#0000ff","cube_case6_1_8_2_-7.5_4_0_0_0_0_-7.5_4_0_#0000ff"],"cube_base_12_2.1_2.4_0_0.95_0_0_0_0_0_0_0_#ff0000","cube_rightReel_2_2_1_2.72_3.89_0_0_0_-45_2.72_3.89_0_#ff7300","cube_rightTape_4_4_0.2_2.81_3.91_-0.1_0_0_-45_2.81_3.91_-0.1_#c300ff","cube_leftReel_2_2_1_-2.69_3.91_0_0_0_-45_-2.75_4_0_#ff7300","sphere_dot_1_1_1_0_4_0_0_0_0_0_4_0_#9999ff","plane_label_12_3_0_0_7_1.01_90_0_0_0_7_1.01_#d3d3d3","cylinder_base_16_8_16_0_-8_0_0_0_0_0_-8_0_#00ff00"],ee=()=>[["cube_cube_2_1_1_0_0.5_-0.5_0_0_0_0_0_0_#fffb00","cube_cube_0.4_0.1_0.8_0.7_1.05_-0.5_0_0_0_0.7_1.05_-0.5_#b0ffb0","cube_cube_1.3_0.1_0.3_-0.25_1.05_-0.75_0_0_0_-0.25_1.05_-0.75_#d3d3d3","cube_cube_0.3_0.1_0.4_-0.75_1.05_-0.3_0_0_0_-0.75_1.05_-0.3_#9999ff","cube_cube_0.4_0.1_0.4_-0.3_1.05_-0.3_0_0_0_-0.35_1.05_-0.3_#d3d3d3","cube_tableA_0.4_0.1_0.4_0.2_1.05_-0.3_0_0_0_0.2_1.05_-0.3_#b0ffb0","cylinder_cylinder_0.30000001192092896_0_0.30000001192092896_0.19999999999999998_1.1100000000000003_-0.2999999999999998_0_0_0_0.19999999999999998_1.1100000000000003_-0.2999999999999998_#00ff00"],"cube_cube_22_1_19_0_-2.5_-4.5_0_0_0_0_-3_-4_#ff00ff","cube_cube_12_1_12_0_-1.5_-4_0_0_0_0_-2_-4_#ff0000","cube_cube_8_1_3_0_-0.5_0.5_0_0_0_0_-1_-4_#c300ff","cube_pillar_1_4_1_7.5_0_-2.5_0_0_0_8_0_-3_#fffb00","cube_pillar_1_4_1_7.5_0_-6.5_0_0_0_8_0_-7_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_-7.5_0_-2.5_0_0_0_-7_0_-3_#fffb00","cube_pillar_1_4_1_-7.5_0_1.5_0_0_0_-7_0_1_#fffb00","cube_pillar_1_4_1_7.5_0_1.5_0_0_0_8_0_1_#fffb00","cube_pillar_1_4_1_-7.5_0_-6.5_0_0_0_-7_0_-7_#fffb00","cube_pillar_1_4_1_-7.5_0_-10.5_0_0_0_-7_0_-11_#fffb00","cube_cube_4_1_16_9_2.5_-6_0_0_0_8_2_0_#00ff00","cube_cube_4_1_16_-9_2.5_-6_0_0_0_-10_2_0_#00ff00"],z={uniforms:{uDirLightPos:{value:new n.Vector3},uDirLightColor:{value:new n.Color(15658734)},uAmbientLightColor:{value:new n.Color(328965)},uBaseColor:{value:new n.Color(16777215)},uLineColor1:{value:new n.Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},F=a=>{const t=new n.Group;t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1);const e=c=>{const[f,d,i,u,g,p,h,l,v,m,E,x,S,C,D]=c.split("_"),_=new n.BoxGeometry(i,u,g);return _.translate(p-x,h-S,l-C),_.rotateX(n.MathUtils.degToRad(v)),_.rotateY(n.MathUtils.degToRad(m)),_.rotateZ(n.MathUtils.degToRad(E)),_},r=c=>{const[f,d,i,u,g,p,h,l,v,m,E,x,S,C,D]=c.split("_"),_=new n.SphereGeometry(parseFloat(i)/2,32,16);return _.scale(i/i,u/i,g/i),_.translate(p-x,h-S,l-C),_.rotateX(n.MathUtils.degToRad(v)),_.rotateY(n.MathUtils.degToRad(m)),_.rotateZ(n.MathUtils.degToRad(E)),_},o=c=>{const[f,d,i,u,g,p,h,l,v,m,E,x,S,C,D]=c.split("_"),_=new n.PlaneGeometry(i,u);return _.rotateX(n.MathUtils.degToRad(-90)),_.translate(p-x,h-S,l-C),_.rotateX(n.MathUtils.degToRad(v)),_.rotateY(n.MathUtils.degToRad(m)),_.rotateZ(n.MathUtils.degToRad(E)),_},s=c=>{const[f,d,i,u,g,p,h,l,v,m,E,x,S,C,D]=c.split("_"),_=i/2,R=new n.CylinderGeometry(_,_,u,32);return R.translate(p-x,h-S,l-C),R.rotateX(n.MathUtils.degToRad(v)),R.rotateY(n.MathUtils.degToRad(m)),R.rotateZ(n.MathUtils.degToRad(E)),R};return a.forEach(c=>{if(Array.isArray(c))t.add(F(c));else{const[f,d,i,u,g,p,h,l,v,m,E,x,S,C,D]=c.split("_");let _=null;switch(f){case"cube":_=e(c);break;case"sphere":_=r(c);break;case"plane":_=o(c);break;case"cylinder":_=s(c);break;default:throw new Error(`Unknown shape: ${f}`)}let R=null;d.startsWith("case")?R=new n.ShaderMaterial({uniforms:{...z.uniforms},vertexShader:z.vertexShader,fragmentShader:z.fragmentShader}):R=new n.MeshStandardMaterial({color:D,side:n.DoubleSide});const N=new n.Mesh(_,R);N.name=d,N.position.set(x,S,C),t.add(N)}}),t},j=a=>{const{radius:t,depth:e,color:r}=a,o=new n.CylinderGeometry(t,t,e,32),s=new n.MeshBasicMaterial({color:r});return new n.Mesh(o,s)},Y=a=>{if(a==="cassette"){const t=F($());return t.name="cassette",t}else if(a==="arena"){const t=F(ee());return t.name="arena",t}return null},te="#e81416",oe="#ffa500",ne="#faeb36",re="#79c314",se="#487de7",ie="#70369d",Z="#000000",ae=(a,t,e)=>Math.min(Math.max(a,t),e),ce=(a=512)=>{const t=document.createElement("canvas");t.width=a,t.height=a;const e=t.getContext("2d");return[t,e]},k=(a,t,e=!1)=>{let r=0,o=t.findIndex(s=>s===a[0]);for(let s=0;s<a.length&&s<t.length&&a[s]===t[(o+s)%t.length];s++)r++;return r},H=[te,oe,ne,re,se,ie],le=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],_e=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],q=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]];class de{constructor(){this.reset()}addVinylByIndex(t){this.queue.unshift(t),this.updateComboCount()}updateComboCount(){const[t,e,r]=q;this.comboCount={color:k(this.queue,[...t].reverse(),!0),artist:k(this.queue,[...e].reverse()),title:k(this.queue,[...r].reverse())},this.solvedCombo={color:this.solvedCombo.color||this.comboCount.color===t.length,artist:this.solvedCombo.artist||this.comboCount.artist===e.length,title:this.solvedCombo.title||this.comboCount.title===r.length}}isSolved(t){return this.solvedCombo[t]}reset(){this.queue=[],this.rack=[],this.selected={};const[t,e,r]=q;this.vinyls=H.map((o,s)=>(this.rack.push(s),{index:s,color:H[t[s]],title:le[e[s]],artist:_e[r[s]]})),this.comboCount={color:0,artist:0,title:0},this.solvedCombo={color:!1,artist:!1,title:!1}}}class O{static createButton(t,e={}){const r=document.createElement("button");function o(){let i=null;async function u(h){h.addEventListener("end",g),await t.xr.setSession(h),r.textContent="EXIT VR",i=h}function g(){i.removeEventListener("end",g),r.textContent="ENTER VR",i=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR";const p={...e,optionalFeatures:["local-floor","bounded-floor","layers",...e.optionalFeatures||[]]};r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){i===null?navigator.xr.requestSession("immersive-vr",p).then(u):(i.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",p).then(u).catch(h=>{console.warn(h)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",p).then(u).catch(h=>{console.warn(h)})}function s(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function c(){s(),r.textContent="VR NOT SUPPORTED"}function f(i){s(),console.warn("Exception when trying to call xr.isSessionSupported",i),r.textContent="VR NOT ALLOWED"}function d(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return r.id="VRButton",r.style.display="none",d(r),navigator.xr.isSessionSupported("immersive-vr").then(function(i){i?o():c(),i&&O.xrSessionIsGranted&&r.click()}).catch(f),r;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",d(i),i}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{O.xrSessionIsGranted=!0})}}}O.xrSessionIsGranted=!1;O.registerSessionGrantedListener();const M=.0254,ue=(a,t)=>{const[r,o]=ce(1024);o.fillStyle=Z,o.textAlign="center",a&&(o.font="64px monospace",o.textBaseline="middle",o.fillText(a,.5*1024,.42*1024)),t&&(o.font="96px monospace",o.textBaseline="bottom",o.fillText(t,.5*1024,.68*1024)),o.strokeStyle=Z,o.lineWidth=8,o.beginPath(),o.arc(1024/2,1024/2,20,0,2*Math.PI),o.stroke(),o.beginPath(),o.arc(1024/2,1024/2,288,0,2*Math.PI),o.stroke();const s=new n.CanvasTexture(r);return s.encoding=n.LinearSRGBColorSpace,new n.MeshBasicMaterial({map:s,transparent:!0})},fe=({color:a,title:t,artist:e})=>{const r=new n.Group,o=new n.RingGeometry(4,7,32);o.scale(M,M,M);const s=new n.MeshStandardMaterial({color:a,side:n.DoubleSide});r.add(new n.Mesh(o,s));const c=new n.RingGeometry(.25,4,32);c.scale(M,M,M);const f=new n.MeshStandardMaterial({color:16777215,side:n.DoubleSide});r.add(new n.Mesh(c,f));const d=new n.PlaneGeometry(14,14);d.translate(0,0,.001),d.scale(M,M,M);const i=ue(e,t);r.add(new n.Mesh(d,i));const u=r.clone();return u.rotation.set(0,Math.PI,0),u.position.set(0,0,-.002),r.add(u),r},he=a=>a*a;class w{constructor(){this.animations=[],this.scene=null,this.clock=new n.Clock}static get Instance(){return w._instance||(w._instance=new w),w._instance}initScene(t){this.scene||(this.scene=t,this.clock.start())}update(){const t=this.clock.getElapsedTime()*1e3;this.animations=this.animations.filter(e=>{const r=t-e.startTime,o=e.endTime-e.startTime,s=ae(r/o,0,1);if(t>=e.endTime)return e.loop?(e.startTime=t,e.endTime=t+o,e.end.position&&e.mesh.position.copy(e.start.position),e.end.rotation&&e.mesh.rotation.copy(e.start.rotation),e.end.scaling&&e.mesh.scale.copy(e.start.scaling),!0):(e.end.position&&e.mesh.position.copy(e.end.position),e.end.rotation&&e.mesh.rotation.copy(e.end.rotation),e.end.scaling&&e.mesh.scale.copy(e.end.scaling),e.resolve&&(e.resolve(),e.resolve=void 0,e.reject=void 0),!1);if(e.end.position&&e.mesh.position.lerpVectors(e.start.position,e.end.position,e.easeFunc(s)),e.end.rotation){const c=e.start.rotation,f=e.end.rotation,d=new n.Euler;d.x=c.x+(f.x-c.x)*e.easeFunc(s),d.y=c.y+(f.y-c.y)*e.easeFunc(s),d.z=c.z+(f.z-c.z)*e.easeFunc(s),e.mesh.rotation.copy(d)}return e.end.scaling&&e.mesh.scale.lerpVectors(e.start.scaling,e.end.scaling,e.easeFunc(s)),!0})}animateTransform(t){const{mesh:e,end:r}=t,o=t.duration||1e3,s=t.delay||0,c=t.ease||he,f=this.clock.getElapsedTime()*1e3;let d,i;const u=new Promise((g,p)=>{d=g,i=p});return this.animations.push({mesh:e,start:{position:e.position.clone(),rotation:e.rotation.clone(),scaling:e.scale.clone()},end:r,easeFunc:c,startTime:f+s,endTime:f+s+o,loop:t.loop||!1,resolve:d,reject:i}),u}cancelAnimation(t,e=!1){const r=this.animations.filter(o=>o.mesh===t);r.length&&(r.forEach(o=>{e&&(o.end.position&&t.position.copy(o.end.position),o.end.rotation&&t.rotation.copy(o.end.rotation),o.end.scaling&&t.scale.copy(o.end.scaling)),o.reject&&(o.reject(),o.resolve=void 0,o.reject=void 0)}),this.animations=this.animations.filter(o=>o.mesh!==t))}}new n.Clock;let I,y,U,b,P,L,T,V,X,B,K;const W=new n.Vector3(0,0,.3),pe=async()=>{document.getElementById("intro").style.display="none";const t=document.getElementById("c");if(!t)return;t.style.display="block";const e=new de;y=new n.Scene,I=new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),I.position.set(0,2,1),I.rotation.set(-1*Math.PI/12,0,0),w.Instance.initScene(y);const r=new n.AmbientLight(16777215,.8);y.add(r);const o=new n.DirectionalLight(16777215,.8);o.position.set(6,10,8),o.castShadow=!0,o.target.position.set(0,0,0),y.add(o),y.add(o.target),B=Y("cassette"),B.position.set(0,0,-20),B.userData.isPickable=!0,y.add(B),w.Instance.animateTransform({mesh:B,end:{rotation:new n.Euler(0,2*Math.PI-.01,0)},duration:3e3,ease:p=>p,loop:!0});const s=Y("arena"),c=s.getObjectByName("tableA");y.add(s),e.vinyls.forEach((p,h)=>{const l=fe(p);l.name=`vinyl-${h}`;const v=new n.Vector3(.7,1.25,-.2-.125*h);l.position.copy(v),l.userData.originalPosition=v,l.userData.isPickable=!0,l.userData.recordIndex=h,l.onPointerPick=m=>{if(m.userData.selected)return;e.selected[m.id]=h;const E=m.getObjectByName("target");E&&(w.Instance.cancelAnimation(l),E.attach(l),w.Instance.animateTransform({mesh:l,end:{position:new n.Vector3(0,0,0),rotation:new n.Euler(0,0,0)},duration:60}),m.userData.selected=l)},l.onPointerDrop=m=>{if(w.Instance.cancelAnimation(l,!0),l.getWorldPosition(new n.Vector3).distanceTo(c.getWorldPosition(new n.Vector3))<.3){e.addVinylByIndex(l.userData.recordIndex),delete e.selected[m.id],m.userData.selected=void 0,c.attach(l),w.Instance.animateTransform({mesh:l,end:{position:new n.Vector3(0,.07,0),rotation:new n.Euler(-1*Math.PI/2,0,0)},duration:60}).then(x=>{x||w.Instance.animateTransform({mesh:l,end:{rotation:new n.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:S=>S,duration:1800,loop:!0})});return}else y.attach(l),w.Instance.animateTransform({mesh:l,end:{position:v,rotation:new n.Euler},duration:60}),m.userData.selected=void 0},y.add(l)}),b=new n.WebGLRenderer({antialias:!0}),b.setPixelRatio(window.devicePixelRatio),b.setSize(window.innerWidth,window.innerHeight),b.setClearColor("#000000"),b.xr.addEventListener("sessionstart",ge),b.xr.enabled=!0,b.setAnimationLoop(me),document.body.appendChild(O.createButton(b)),document.body.appendChild(b.domElement),L=b.xr.getController(0),L.addEventListener("selectstart",A),L.addEventListener("selectend",G),L.addEventListener("squeezestart",A),L.addEventListener("squeezeend",G),y.add(L),T=b.xr.getController(1),T.addEventListener("selectstart",A),T.addEventListener("selectend",G),T.addEventListener("squeezestart",A),T.addEventListener("squeezeend",G),y.add(T),V=b.xr.getControllerGrip(0);const f=j({radius:.01,depth:.2,color:16711935});f.name="controllerMesh1",f.rotateX(Math.PI/4),V.add(f),y.add(V),X=b.xr.getControllerGrip(1);const d=j({radius:.01,depth:.2,color:65280});d.rotateX(Math.PI/4),X.add(d),y.add(X);const i=new n.BufferGeometry().setFromPoints([new n.Vector3(0,0,0),new n.Vector3(0,0,-1)]),u=new n.Line(i);u.name="line",u.scale.z=5,L.add(u.clone()),T.add(u.clone());const g=new n.Group;g.rotation.set(-1*Math.PI/2,0,0),g.position.set(0,-.05,-.12),g.name="target",L.add(g.clone()),T.add(g.clone()),U=new n.Raycaster,window.addEventListener("resize",be,!1)};function ge(){K=b.xr.getReferenceSpace();const a={x:-1*W.x,y:-1*W.y,z:-1*W.z,w:1},t=new n.Quaternion,e=new XRRigidTransform(a,t),r=K.getOffsetReferenceSpace(e);b.xr.setReferenceSpace(r)}function A(a){P=a.target;const t=J(P);if(t.length>0){let e=!1;t.forEach(({object:r,distance:o})=>{if(e)return;let s=r;for(;s;){if(s.onPointerPick){s.onPointerPick(P),e=!0;break}s=s.parent}})}P.userData.targetRayMode=a.data.targetRayMode}function G(a){P=a.target;const t=P.userData.selected;t?.onPointerDrop&&t.onPointerDrop(P)}function J(a){return a.updateMatrixWorld(),U.setFromXRController(a),U.intersectObjects(y.children,!0)}function Q(a){if(a.userData.targetRayMode==="screen"||a.userData.selected!==void 0)return;const t=a.getObjectByName("line"),e=J(a);if(t.scale.z=5,e.length>0){let r=!1;e.forEach(({object:o,distance:s})=>{if(r)return;let c=o;for(;c;){if(c.userData.isPickable){t.scale.z=s,r=!0;break}c=c.parent}})}}function me(){w.Instance.update(),Q(L),Q(T),b.render(y,I)}const be=()=>{I.aspect=window.innerWidth/window.innerHeight,I.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("playButton");a.onclick=pe});
