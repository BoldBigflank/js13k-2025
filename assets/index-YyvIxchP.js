import*as c from"https://js13kgames.com/2025/webxr/three.module.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const t of r.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();class I{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return I._instance||(I._instance=new I),I._instance}on(e,o){this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(o)}off(e,o){this.callbacks[e]=(this.callbacks[e]||[]).filter(s=>s!==o)}emit(e,...o){(this.callbacks[e]||[]).forEach(s=>s(...o))}_reset(){Object.keys(this.callbacks).forEach(e=>{delete this.callbacks[e]})}getCallbacks(){return this.callbacks}}const pe="#e81416",ge="#ffa500",we="#faeb36",ce="#79c314",j="#487de7",Ie="#70369d",Ue="#1aff1a",ye="#ffffff",_e="#666666",_="#000000",ne="#abb7d0",Ve="#687793",Ye="#42485d",We="#93e0a8",K="#ff3b94",Xe="#ffcc00",Re="#f6ff00",Pe="#8ea5ff",qe="#af3dff",Ze="#39013a",ie="#333333",Fe="#888888",ve={color:pe,artist:ce,title:j},$=[pe,ge,we,ce,j,Ie],ee=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],te=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],je={color:$,artist:ee,title:te},He={color:0,artist:24,title:34},$e=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]],Ke=["color","artist","title"];class Qe{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset(),this.progress.bestComboType="color"}addVinylByIndex(e){if(this.queue[0]===e)return;const{color:o,artist:s,title:n}=this.vinyls[e],r=$.indexOf(o),t=ee.indexOf(s),i=te.indexOf(n);r===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===$.length&&(this.progress.color.solved=!0),this.progress.color.currentIndex=r):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),t===(this.progress.artist.currentIndex+1)%ee.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===ee.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=t,i===(this.progress.title.currentIndex+1)%te.length?(this.progress.title.correctCount++,this.progress.title.correctCount===te.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=i;const u=Math.max(this.progress.color.correctCount,this.progress.artist.correctCount,this.progress.title.correctCount);this.progress.bestComboCount<6&&u<this.progress.bestComboCount&&I.Instance.emit("comboBroken"),this.progress.bestComboCount=u,this.progress.bestComboType=this.progress.color.correctCount===this.progress.bestComboCount?"color":this.progress.artist.correctCount===this.progress.bestComboCount?"artist":"title",this.queue.unshift(e),this.progress.displayText=this.getDisplayText(),I.Instance.emit("progress",this.progress)}getVinylInQueue(e){return this.vinyls[this.queue[e]]}isSolved(e){if(e)return this.progress.color.solved&&this.progress.artist.solved&&this.progress.title.solved,this.progress[e].solved}getDisplayText(){let e="";const{currentIndex:o,correctCount:s,solved:n}=this.progress[this.progress.bestComboType],r=je[this.progress.bestComboType];for(let t=0;t<s;t++){let i=o-t;i<0&&(i+=r.length),e=`${r[i]}â†’${e}`}return e}reset(){this.queue=[],this.selected={};const[e,o,s]=$e;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-2,correctCount:0,solved:!1},title:{currentIndex:-2,correctCount:0,solved:!1},bestComboType:"color",bestComboCount:0},this.vinyls=$.map((n,r)=>({index:r,color:n,artist:"",title:""})),e.forEach((n,r)=>{this.vinyls[n].color=$[r]}),o.forEach((n,r)=>{this.vinyls[n].artist=ee[r]}),s.forEach((n,r)=>{this.vinyls[n].title=te[r]}),I.Instance.emit("progress",this.progress)}}class J{static createButton(e,o={}){const s=document.createElement("button");function n(){let u=null;async function l(h){h.addEventListener("end",d),await e.xr.setSession(h),s.textContent="EXIT VR",u=h}function d(){u.removeEventListener("end",d),s.textContent="ENTER VR",u=null}s.style.display="block",s.removeAttribute("data-disabled"),s.textContent="ENTER VR";const m={...o,optionalFeatures:["local-floor","bounded-floor","layers",...o.optionalFeatures||[]]};s.onclick=function(){u===null?navigator.xr.requestSession("immersive-vr",m).then(l):(u.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",m).then(l).catch(h=>{console.warn(h)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",m).then(l).catch(h=>{console.warn(h)})}function r(){s.style.display="block",s.setAttribute("data-disabled","true"),s.onmouseenter=null,s.onmouseleave=null,s.onclick=null}function t(){r(),s.textContent="VR NOT SUPPORTED"}function i(u){r(),console.warn("Exception when trying to call xr.isSessionSupported",u),s.textContent="VR NOT ALLOWED"}if("xr"in navigator)return s.id="VRButton",s.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(function(u){u?n():t(),u&&J.xrSessionIsGranted&&s.click()}).catch(i),s;{const u=document.createElement("a");return window.isSecureContext===!1?(u.href=document.location.href.replace(/^http:/,"https:"),u.innerHTML="WEBXR NEEDS HTTPS"):(u.href="https://immersiveweb.dev/",u.innerHTML="WEBXR NOT AVAILABLE"),u.className="webxr-message",u}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{J.xrSessionIsGranted=!0})}}}J.xrSessionIsGranted=!1;J.registerSessionGrantedListener();const U=.0254,Oe=(a=1024,e=1024)=>{const o=document.createElement("canvas");o.width=a,o.height=e;const s=o.getContext("2d");return[o,s]},xe=(a,e,o)=>{const s=new c.Vector3(1,0,0),n=new c.Euler(0,a,-Math.PI/2+e);return s.applyEuler(n).normalize().multiplyScalar(o)},p=a=>parseFloat(`${a||0}`),Je=a=>a[Math.floor(Math.random()*a.length)],Q={},Se=new c.Color,ue=(a,e)=>{const o=e?.glow==!0,s=`color-${a}-${o}`;if(Q[s])return Q[s];const n=o?c.MeshBasicMaterial:c.MeshStandardMaterial,r=new n({color:a,side:c.FrontSide});return Q[s]=r,r},Le=(a,e)=>{const{color:o,bgColor:s,textAlign:n,ratio:r,fontSize:t}=e;Se.set(o);const i=typeof o=="string"?o:`#${Se.getHexString()}`,u=`text-${i}-${a.join("")}`;if(Q[u])return Q[u];const l=1024,d=r?l/r:l,[m,h]=Oe(l,d);h.textAlign=n||"center";let g=16;h.textAlign==="center"&&(g=.5*l);let y=16;a.forEach((M,b)=>{const v=t!==void 0?t:64;h.strokeStyle=_,h.font=`${v}px monospace`,h.textBaseline="top",h.lineWidth=8,h.strokeText(M,g,y+v*b),h.fillStyle=i,h.fillText(M,g,y+v*b)});const E=new c.CanvasTexture(m),f=new c.MeshBasicMaterial({map:E,transparent:!0});return Q[u]=f,f},et=(a,e)=>{const[s,n]=Oe();n.fillStyle=_,n.strokeStyle=_,n.lineWidth=8,n.beginPath(),n.arc(1024/2,1024/2,20,0,2*Math.PI),n.stroke(),n.beginPath(),n.arc(1024/2,1024/2,288,0,2*Math.PI),n.stroke(),n.textAlign="center",a&&(n.font="64px monospace",n.textBaseline="middle",n.strokeStyle=_,n.lineWidth=8,n.strokeText(a,.5*1024,.42*1024),n.fillStyle=ce,n.fillText(a,.5*1024,.42*1024)),e&&(n.font="96px monospace",n.textBaseline="bottom",n.fillStyle=j,n.strokeText(e,.5*1024,.68*1024),n.fillText(e,.5*1024,.68*1024));const r=new c.CanvasTexture(s);return r.encoding=c.LinearSRGBColorSpace,new c.MeshBasicMaterial({map:r,transparent:!0})},tt=({color:a,artist:e,title:o})=>{const s=new c.Group,n=new c.RingGeometry(4,7,32);n.translate(0,0,-.001),n.scale(U,U,U);const r=ue(a,{glow:!0});s.add(new c.Mesh(n,r));const t=new c.RingGeometry(.25,4,32);t.scale(U,U,U),t.translate(0,0,-.001);const i=ue(16777215,{});s.add(new c.Mesh(t,i));const u=new c.PlaneGeometry(14,14);u.translate(0,0,-.002),u.scale(U,U,U);const l=et(e,o);s.add(new c.Mesh(u,l));const d=s.clone();d.rotation.set(0,Math.PI,0),s.add(d);const m=new c.RingGeometry(7,7.5,32);m.scale(U,U,U);const h=ue(ye,{glow:!0});h.emissiveIntensity=1;const g=new c.Mesh(m,h);return g.visible=!1,g.name="highlight",s.add(g),s},ot=a=>a*a,nt=a=>a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2,st=a=>.5*Math.cos(2*a*Math.PI+Math.PI)+.5;class O{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new c.Clock}static get Instance(){return O._instance||(O._instance=new O),O._instance}initScene(e){this.scene||(this.scene=e,this.clock.start())}update(){const e=this.clock.getElapsedTime()*1e3;this.animations=this.animations.filter(o=>{const{mesh:s,start:n,end:r,easeFunc:t,loop:i}=o,u=e-o.startTime,l=o.endTime-o.startTime,d=c.MathUtils.clamp(u/l,0,1);if(r.position&&s.position.lerpVectors(n.position,r.position,t(d)),r.rotation){const m=n.rotation,h=r.rotation,g=new c.Euler;g.order=m.order||c.Euler.DefaultOrder,g.x=m.x+(h.x-m.x)*t(d),g.y=m.y+(h.y-m.y)*t(d),g.z=m.z+(h.z-m.z)*t(d),s.rotation.copy(g)}return r.scaling&&s.scale.lerpVectors(n.scaling,r.scaling,t(d)),e>=o.endTime?i?(o.startTime=e,o.endTime=e+l,r.position&&s.position.copy(n.position),r.rotation&&s.rotation.copy(n.rotation),r.scaling&&s.scale.copy(n.scaling),!0):(o.resolve&&(o.resolve(),o.resolve=void 0,o.reject=void 0),!1):!0})}animateTransform(e){const{mesh:o,end:s}=e,n=e.duration||1e3,r=e.delay||0,t=e.ease||ot,i=this.clock.getElapsedTime()*1e3;let u,l;const d=new Promise((m,h)=>{u=m,l=h});return this.animations.push({mesh:o,start:{position:o.position.clone(),rotation:o.rotation.clone(),scaling:o.scale.clone()},end:s,easeFunc:t,startTime:i+r,endTime:i+r+n,loop:e.loop||!1,resolve:u,reject:l}),d}cancelAnimation(e,o=!1){const s=this.animations.filter(n=>n.mesh===e);s.length&&(s.forEach(n=>{const{end:r}=n;o&&(r.position&&e.position.copy(r.position),r.rotation&&e.rotation.copy(r.rotation),r.scaling&&e.scale.copy(r.scaling)),n.reject&&(n.reject(),n.resolve=void 0,n.reject=void 0)}),this.animations=this.animations.filter(n=>n.mesh!==e))}}class rt{constructor(){this.mOscillators=[this.osc_sin.bind(this),this.osc_square.bind(this),this.osc_saw.bind(this),this.osc_tri.bind(this)],this.mSong=null,this.mLastRow=0,this.mCurrentCol=0,this.mNumWords=0,this.mMixBuf=null}osc_sin(e){return Math.sin(e*6.283184)}osc_saw(e){return 2*(e%1)-1}osc_square(e){return e%1<.5?1:-1}osc_tri(e){var o=e%1*4;return o<2?o-1:3-o}getnotefreq(e){return .003959503758*2**((e-128)/12)}createNote(e,o,s){var n=this.mOscillators[e.i[0]],r=e.i[1],t=e.i[3]/32,i=this.mOscillators[e.i[4]],u=e.i[5],l=e.i[8]/32,d=e.i[9],m=e.i[10]*e.i[10]*4,h=e.i[11]*e.i[11]*4,g=e.i[12]*e.i[12]*4,y=1/g,E=-e.i[13]/16,f=e.i[14],M=s*2**(2-e.i[15]),b=new Int32Array(m+h+g),v=0,w=0,C,S,N,P,R,L;for(C=0,S=0;C<m+h+g;C++,S++)S>=0&&(f=f>>8|(f&255)<<4,S-=M,R=this.getnotefreq(o+(f&15)+e.i[2]-128),L=this.getnotefreq(o+(f&15)+e.i[6]-128)*(1+8e-4*e.i[7])),N=1,C<m?N=C/m:C>=m+h&&(N=(C-m-h)*y,N=(1-N)*3**(E*N)),v+=R*N**t,P=n(v)*r,w+=L*N**l,P+=i(w)*u,d&&(P+=(2*Math.random()-1)*d),b[C]=80*P*N|0;return b}async init(e){return new Promise(o=>{this.mSong=e,this.mLastRow=e.endPattern,this.mCurrentCol=0,this.mNumWords=e.rowLen*e.patternLen*(this.mLastRow+1)*2,this.mMixBuf=new Int32Array(this.mNumWords),o()})}generateChannel(e){return new Promise(o=>{var s,n,r,t,i,u,l,d,m,h,g,y,E=new Int32Array(this.mNumWords),f=this.mSong.songData[e],M=this.mSong.rowLen,b=this.mSong.patternLen,v=0,w=0,C,S,N=!1,P=[];for(r=0;r<=this.mLastRow;++r)for(l=f.p[r],t=0;t<b;++t){var R=l?f.c[l-1].f[t]:0;R&&(f.i[R-1]=f.c[l-1].f[t+b]||0,R<17&&(P=[]));var L=this.mOscillators[f.i[16]],x=f.i[17]/512,T=2**(f.i[18]-9)/M,B=f.i[19],H=f.i[20],G=f.i[21]*43.23529*3.141592/44100,V=1-f.i[22]/255,z=f.i[23]*1e-5,ke=f.i[24]/32,Ge=f.i[25]/512,ze=6.283184*2**(f.i[26]-9)/M,be=f.i[27]/255,le=f.i[28]*M&-2;for(g=(r*b+t)*M,i=0;i<4;++i)if(u=l?f.c[l-1].n[t+i*b]:0,u){P[u]||(P[u]=this.createNote(f,u,M));var Me=P[u];for(n=0,s=g*2;n<Me.length;n++,s+=2)E[s]+=Me[n]}for(n=0;n<M;n++)d=(g+n)*2,h=E[d],h||N?(y=G,B&&(y*=L(T*d)*x+.5),y=1.5*Math.sin(y),v+=y*w,C=V*(h-w)-v,w+=y*C,h=H==3?w:H==1?C:v,z&&(h*=z,h=h<1?h>-1?this.osc_sin(h*.25):-1:1,h/=z),h*=ke,N=h*h>1e-5,m=Math.sin(ze*d)*Ge+.5,S=h*(1-m),h*=m):S=0,d>=le&&(S+=E[d-le+1]*be,h+=E[d-le]*be),E[d]=S|0,E[d+1]=h|0,this.mMixBuf[d]+=S|0,this.mMixBuf[d+1]+=h|0}o()})}async generate(){this.mMixBuf.fill(0),this.mCurrentCol=0;const e=[];for(let o=0;o<this.mSong.numChannels;o++)e.push(this.generateChannel(o));return await Promise.all(e),this.mCurrentCol=this.mSong.numChannels,1}createAudioBuffer(e){for(var o=e.createBuffer(2,this.mNumWords/2,44100),s=0;s<2;s++)for(var n=o.getChannelData(s),r=s;r<this.mNumWords;r+=2)n[r>>1]=this.mMixBuf[r]/65536;return o}createAudioBufferRange(e,o=0,s=null){(s===null||s>this.mNumWords/2)&&(s=this.mNumWords/2),o<0&&(o=0),o>=s&&(o=s-1);const n=s-o;for(var r=e.createBuffer(2,n,44100),t=0;t<2;t++)for(var i=r.getChannelData(t),u=0;u<n;u++){var l=(o+u)*2+t;i[u]=this.mMixBuf[l]/65536}return r}createWave(){var e=44,o=e+this.mNumWords*2-8,s=o-36,n=new Uint8Array(e+this.mNumWords*2);n.set([82,73,70,70,o&255,o>>8&255,o>>16&255,o>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,s&255,s>>8&255,s>>16&255,s>>24&255]);for(var r=0,t=e;r<this.mNumWords;++r){var i=this.mMixBuf[r];i=i<-32767?-32767:i>32767?32767:i,n[t++]=i&255,n[t++]=i>>8&255}return n}createWaveRange(e=0,o=null){(o===null||o>this.mNumWords/2)&&(o=this.mNumWords/2),e<0&&(e=0),e>=o&&(e=o-1);const s=o-e;var n=44,r=n+s*2-8,t=r-36,i=new Uint8Array(n+s*2);i.set([82,73,70,70,r&255,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,t&255,t>>8&255,t>>16&255,t>>24&255]);for(var u=0,l=n;u<s;++u){var d=this.mMixBuf[(e+u)*2];d=d<-32767?-32767:d>32767?32767:d,i[l++]=d&255,i[l++]=d>>8&255}return i}getData(e,o){for(var s=2*Math.floor(e*44100),n=new Array(o),r=0;r<2*o;r+=1){var t=s+r;n[r]=e>0&&t<this.mMixBuf.length?this.mMixBuf[t]/32768:0}return n}}const at=.3,k=44100,de=new(window.AudioContext||window.webkitAudioContext),it=(a=1,e=.05,o=220,s=0,n=0,r=.1,t=0,i=1,u=0,l=0,d=0,m=0,h=0,g=0,y=0,E=0,f=0,M=1,b=0,v=0)=>{let w=2*Math.PI,C=u*=500*w/k**2,S=(0<y?1:-1)*w/4,N=o*=(1+2*e*Math.random()-e)*w/k,P=[],R=0,L=0,x=0,T=1,B=0,H=0,G=0,V,z;for(s=99+k*s,b*=k,n*=k,r*=k,f*=k,l*=500*w/k**3,y*=w/k,d*=w/k,m*=k,h=k*h|0,z=s+b+n+r+f|0;x<z;P[x++]=G)++H%(100*E|0)||(G=t?1<t?2<t?3<t?Math.sin((R%w)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/w%2+2)%2:1-4*Math.abs(Math.round(R/w)-R/w):Math.sin(R),G=(h?1-v+v*Math.sin(2*Math.PI*x/h):1)*(0<G?1:-1)*Math.abs(G)**i*a*at*(x<s?x/s:x<s+b?1-(x-s)/b*(1-M):x<s+b+n?M:x<z-f?(z-x-f)/r*M:0),G=f?G/2+(f>x?0:(x<z-f?1:(z-x)/f)*P[x-f|0]/2):G),V=(o+=u+=l)*Math.sin(L*y-S),R+=V-V*g*(1-1e9*(Math.sin(x)+1)%2),L+=V-V*g*(1-1e9*(Math.sin(x)**2+1)%2),T&&++T>m&&(o+=d,N+=d,T=0),!h||++B%h||(o=N,u=C,T=T||1);return P},ct=(...a)=>{let e=de.createBufferSource(),o=de.createBuffer(a.length,a[0].length,k);return a.map((s,n)=>o.getChannelData(n).set(s)),e.buffer=o,e.connect(de.destination),e.start(),e},Be=(...a)=>ct(it(...a));var lt={songData:[{i:[0,255,116,85,0,255,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,136,15,0,32,0,0,0,6],p:[1,1,1,2,,,1,1,2,2],c:[{n:[139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139,,139,,139,,139],f:[]},{n:[140,,140,,,,140,,,,140,,140,,140,,,,140,,140,,,,140,,140,,,,140],f:[]}]},{i:[0,160,128,64,0,160,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,0,6],p:[,1,2,1,2,1,2,1,1,1],c:[{n:[,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,139],f:[]},{n:[,,,,,,,,,,,,139,,139,,,,,,,,,,,,,,139,,139],f:[]}]},{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[,,,,1,,2,1,1,2],c:[{n:[144,,,,,,,,,,,,,,,,144],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,156,,,,,,,,,,,,,,,,156],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,,,1,1,1,1,2,2],c:[{n:[132,,,,,,,,132,,,,,,,,144,,,,,,,,144],f:[]},{n:[],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[,,2,1,,2,1,2,2,1],c:[{n:[144,,,,144,,,,144,,,,142,,142,,144,,144,,144,,,,144,,,,144,,,,147,,,,151,,,,147,,,,149,,149,,147,,147,,151,,,,147,,,,147,,,,151,,,,154,,,,151,,,,151,,151,,151,,151,,154,,,,151,,,,151],f:[]},{n:[144,144,144,,144,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,147,147,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,151,151,,151],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:5};const se=new AudioContext;let F=0;I.Instance.on("progress",a=>{const e=a.bestComboCount||0;F=Math.min(e,6)});const Ae=()=>Be(void 0,void 0,143,.03,.17,.09,2,1.5,10,-17,void 0,void 0,void 0,void 0,4,void 0,void 0,.73,.09),ut=()=>Be(1.01,void 0,275,.01,.01,.15,1,1.03,-3.7,void 0,-93,.07,void 0,void 0,void 0,-.1,void 0,.5,.04,.09),dt=async()=>{const a=new rt;await a.init(lt),await a.generate();const e=[];for(let d=0;d<6;d++){const m=d*176400,h=m+176400,g=a.createAudioBufferRange(se,m,h);e.push(g)}const o=6*176400,s=o+705600,n=a.createAudioBufferRange(se,o,s),r=[...e,n];let t=null,i=!1;const u=d=>{t&&(t.stop(),t.disconnect());let m;d<6?m=d:m=6;const h=r[m];t=se.createBufferSource(),t.buffer=h,t.connect(se.destination),t.loop=!0,t.start();const g=setInterval(()=>{I.Instance.emit("downbeat"),F!==d&&(console.log("Sequence change detected:",d,"â†’",F),clearInterval(g),u(F))},2e3);i=!0};return u(F),{source:t,stop:()=>{i=!1,t&&(t.stop(),t.disconnect(),t=null)},playSequence:d=>{F=d,u(d)},getCurrentSequence:()=>F,isPlaying:()=>i}},ht=["Light Blue","Yellow","Orange","Red","Purple","Blue","Green","Lime","Pink","Silver"],ft={"Light Blue":"#9999ff",Yellow:"#fffb00",Orange:"#ff7300",Red:"#ff0000",Purple:"#c300ff",Blue:"#0000ff",Green:"#00ff00",Lime:"#b0ffb0",Pink:"#ff00ff",Silver:"#d3d3d3"},mt=a=>{const[e,o,s,n,r,t,i,u,l,d,m,h,g,y,E]=a.split(","),f=p(s),M=p(n),b=p(r),v=p(t),w=p(i),C=p(u),S=p(h),N=p(g),P=p(y),R=p(l),L=p(d),x=p(m),T=Math.sqrt(f*f+f*f)/2,B=new c.CylinderGeometry(0,T,M,4,1,!1,Math.PI/4);return B.scale(1,1,b/f),B.translate(v-S,w-N+.3*M,C-P),B.rotateX(c.MathUtils.degToRad(R)),B.rotateY(c.MathUtils.degToRad(L)),B.rotateZ(c.MathUtils.degToRad(x)),B},pt=a=>{const[e,o,s,n,r,t,i,u,l,d,m,h,g,y,E]=a.split(","),f=p(s),M=p(n),b=p(r),v=p(t),w=p(i),C=p(u),S=p(h),N=p(g),P=p(y),R=p(l),L=p(d),x=p(m),T=new c.BoxGeometry(f,M,b);return T.translate(v-S,w-N,C-P),T.rotateX(c.MathUtils.degToRad(R)),T.rotateY(c.MathUtils.degToRad(L)),T.rotateZ(c.MathUtils.degToRad(x)),T.computeBoundingBox(),T},gt=a=>{const[e,o,s,n,r,t,i,u,l,d,m,h,g,y,E]=a.split(","),f=p(s),M=p(n),b=p(r),v=p(t),w=p(i),C=p(u),S=p(h),N=p(g),P=p(y),R=p(l),L=p(d),x=p(m),T=new c.SphereGeometry(f/2,32,16);return T.scale(f/f,M/f,b/f),T.translate(v-S,w-N,C-P),T.rotateX(c.MathUtils.degToRad(R)),T.rotateY(c.MathUtils.degToRad(L)),T.rotateZ(c.MathUtils.degToRad(x)),T},wt=a=>{const[e,o,s,n,r,t,i,u,l,d,m,h,g,y,E]=a.split(","),f=p(s),M=p(n),b=p(t),v=p(i),w=p(u),C=p(h),S=p(g),N=p(y),P=p(l),R=p(d),L=p(m),x=new c.PlaneGeometry(f,M);return x.rotateX(c.MathUtils.degToRad(-90)),x.translate(b-C,v-S,w-N),x.rotateX(c.MathUtils.degToRad(P)),x.rotateY(c.MathUtils.degToRad(R)),x.rotateZ(c.MathUtils.degToRad(L)),x.computeBoundingBox(),x},yt=a=>{const[e,o,s,n,r,t,i,u,l,d,m,h,g,y,E]=a.split(","),f=p(s),M=p(n),b=p(r),v=p(t),w=p(i),C=p(u),S=p(h),N=p(g),P=p(y),R=p(l),L=p(d),x=p(m),T=f/2,B=new c.CylinderGeometry(T,T,M,32);B.translate(v-S,w-N,C-P),B.scale(1,1,b/f);const H=c.MathUtils.degToRad(R),G=c.MathUtils.degToRad(L),V=c.MathUtils.degToRad(x),z=new c.Euler(H,G,V);return B.applyQuaternion(new c.Quaternion().setFromEuler(z)),B.computeBoundingBox(),B},bt=a=>{const[e]=a.split(",");switch(e){case"c":return pt(a);case"s":return gt(a);case"p":return wt(a);case"cy":return yt(a);case"py":return mt(a);default:throw new Error(`Unknown shape: ${e}`)}},Z=(a,e)=>{const o=new c.Group;o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1);const s={...ft,...e};return a.forEach(n=>{if(n===null){console.error("ITEM IS NULL");return}if(Array.isArray(n))o.add(Z(n,s));else{const[r,t,i,u,l,d,m,h,g,y,E,f,M,b,v]=n.split(","),w=bt(n);let C=new c.MeshStandardMaterial({color:s[ht[v]],side:c.DoubleSide});const S=new c.Mesh(w,C);S.name=t,S.position.set(f,M,b),o.add(S)}}),o},Mt=()=>[["c,desk,2,0.1,1,,0.85,-0.5,,,,,-0.1,,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.85,,,,0.1,,-0.9,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.15,,,,0.1,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.15,,,,1.8,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.85,,,,1.8,,-0.9,6","c,record-rack,0.4,0.1,0.8,0.7,0.95,-0.5,,,,0.7,0.95,-0.5,0","c,cube,0.3,0.1,0.4,-0.75,0.95,-0.3,,,,-0.75,0.95,-0.3,9","c,cube,0.4,0.1,0.4,-0.3,0.95,-0.3,,,,-0.3,0.95,-0.3,9","c,tableA,0.4,0.1,0.4,0.2,0.95,-0.3,,,,0.2,1.01,-0.3,0","cy,pad,0.4,0.02,0.4,0.2,1,-0.3,,,,0.2,1,-0.3,3"],"c,cube,22,1,4,,-1.5,-23,,,,,-2,-15,2","c,floor,20,1,20,,-2.5,-11,,,,,-3,-4,3","c,cube,20,1,6,,-2.5,2,,,,,-3,5,3","c,cube,8,2,3,,-1,0.5,,,,,-1,-4,2","c,pillar,1,4,1,6.5,,-6.5,,,,7,,-7,6","c,pillar,1,4,1,6.5,,-10.5,,,,7,,-11,6","c,pillar,1,3,1,6.5,0.5,-14.5,,,,7,,-15,6","c,pillar,1,4,1,6.5,,-18.5,,,,7,,-19,6","c,pillar,1,4,1,6.5,,-14.5,,,,7,,-15,6","c,pillar,1,4,1,-6.5,,-6.5,,,,-6,,-7,6","c,pillar,1,4,1,-6.5,,-2.5,,,,-6,,-3,6","c,pillar,1,4,1,6.5,,-2.5,,,,7,,-3,6","c,pillar,1,4,1,-6.5,,-10.5,,,,-6,,-11,6","c,pillar,1,4,1,-6.5,,-14.5,,,,-6,,-15,6","c,pillar,1,4,1,-6.5,,-18.5,,,,-6,,-19,6","c,cube,4,1,20,8,2.5,-11,,,,7,2,-3,1","c,cube,4,1,20,-8,2.5,-11,,,,-9,2,-3,1"],vt=()=>["s,head,20,16,16,,8,,,,,,8,,4","s,head,16,16,16,,-5,,,,,,-5,,4",["cy,leftEye,4,1,4,-3,10,-7.1,-71,-5,16,-3,10,-7.1,1","s,leftPupil,2,2,4,-2.8,10.1,-7,-75,7,10,-2.8,10.1,-7,4","cy,rightEye,4,1,4,3,10,-7.2,-71,5,-17,3,10,-7.2,1","s,rightPupil,2,2,4,2.9,10,-7.1,-74,-4,-12,2.9,10,-7.1,4"],["c,rightCheek,4,4,2,1.84,6.03,-7.5,-25,,80,2.34,6.53,-7.5,9","c,leftCheek,4,4,2,-2.91,5.98,-7.5,,23,10,-2.41,6.48,-7.5,9","c,tongue,2,2,2,,5,-7,,,,,4,-7,3","py,pyramid,3,1.6,1,,8.2,-8,-180,,,,8.2,-8,8"],["py,ear,6,7,4,-4.86,13.55,-1.28,-14,20,31,-4.86,13.55,-1.28,4","py,ear,6,7,4,5.14,13.55,-1.28,-11,-15,-33,5.14,13.55,-1.28,4","py,ear,5.2,6.2,3.4,5.14,13.15,-1.78,-9,-16,-33,5.14,13.15,-1.78,1","py,ear,5,5.5,3.8,-5.04,13.54,-1.59,-17,19,32,-5.04,13.54,-1.59,1"],["cy,cylinder,0.2,11,0.2,-7.93,6,-10.12,,-15,90,-7.93,6,-10.12,9","cy,cylinder,0.2,9.2,0.2,-6.87,7.72,-9,,-15,75,-6.87,7.72,-9,9","cy,cylinder,0.2,9,0.2,-7.07,3.78,-9.3,,-15,105,-7.07,3.78,-9.3,9","cy,cylinder,0.2,7.8,0.2,6.87,7.62,-8.9,180,-15,-105,6.87,7.62,-8.9,9","cy,cylinder,0.2,9.4,0.2,6.93,6,-9.52,,-165,90,6.93,6,-9.52,9","cy,cylinder,0.2,8.8,0.2,6.87,3.88,-9.1,180,-15,-75,6.87,3.88,-9.1,9"]],xt=[{Purple:ie,Silver:Fe,Yellow:ne,Red:K},{Purple:ge,Silver:we,Yellow:Ue,Red:K},{Purple:_e,Silver:ne,Yellow:Re,Red:K}],St=a=>{const e=new c.Group;e.name="Crowd";const o=new c.Object3D,s=8,n=10,r=new c.BoxGeometry(.5,.5,.5),t=new c.MeshStandardMaterial,i=new c.InstancedMesh(r,t,s*n);i.instanceMatrix.setUsage(c.DynamicDrawUsage);const u=new c.BoxGeometry(.2,.2,.6),l=new c.MeshStandardMaterial,d=new c.InstancedMesh(u,l,s*n*2);d.instanceMatrix.setUsage(c.DynamicDrawUsage);const m=new c.Color,h=new c.Color;e.add(i),e.add(d);const g=new c.Vector3(0,-1,0),y=[],E=[];for(let f=0;f<s;f++)for(let M=0;M<n;M++){const b=M+f*s,v=Je(xt),w=new c.Vector3(2*M-n+.5+f%2*1,0,2*f-s+.5);Math.abs(w.x)>=5&&(w.y+=5);const C=new c.Vector3(c.MathUtils.randFloatSpread(.3),c.MathUtils.randFloatSpread(.1),c.MathUtils.randFloatSpread(.3));w.add(C),o.position.copy(w).add(g),o.lookAt(0,6,0),o.updateMatrix(),i.setMatrixAt(b,o.matrix),m.setStyle(v.Purple),i.setColorAt(b,m);for(let S=0;S<2;S++){const N=b*2+S;o.position.copy(w),o.updateMatrix(),d.setMatrixAt(N,o.matrix),h.setStyle(v.Purple),d.setColorAt(N,h)}y.push({positionOffset:w,poseDelay:c.MathUtils.randInt(0,15),palette:v})}return I.Instance.on("tick",()=>{if(!a.xr?.getCamera())return;const f=a.xr?.getCamera(),M={controllers:[]};if([0,1].forEach(b=>{const v=a.xr?.getController(b);if(v){const w=v.getObjectByName("paw");w&&M.controllers.push(w.matrixWorld.clone())}}),f&&(M.camera=f.matrix.clone(),E.push(M),E.length>60&&E.shift()),E.length==0){i.visible=!1,d.visible=!1;return}y.forEach((b,v)=>{const w=E[Math.max(0,E.length-1-b.poseDelay)];w?.camera&&(o.matrix.copy(w.camera),o.matrix.decompose(o.position,o.quaternion,o.scale),o.position.add(b.positionOffset).add(g),o.updateMatrix(),i.setMatrixAt(v,o.matrix),w.controllers.forEach((C,S)=>{const N=v*2+S;o.matrix.copy(C),o.matrix.decompose(o.position,o.quaternion,o.scale),o.position.add(b.positionOffset).add(g),o.position.add(new c.Vector3(S===0?-.1:.1,.2,-.3)),o.updateMatrix(),d.setMatrixAt(N,o.matrix)}))}),i.instanceMatrix.needsUpdate=!0,d.instanceMatrix.needsUpdate=!0}),e},Et=()=>[["c,case1,1,8,2,7.5,7,,,,,7.5,7,,5","c,case2,3,9,2,5.5,7.5,,,,,5.5,7.5,,5","c,case3,8,4,2,,10,,,,,,11.5,,5","c,case4,8,1,2,,5.5,,,,,,5.5,,5","c,case5,3,9,2,-5.5,7.5,,,,,-5.5,7.5,,5","c,case6,1,8,2,-7.5,7,,,,,-7.5,7,,5"],"c,base,12,2.1,2.8,,3.95,,,,,,3,,3","c,rightReel,2,2,1,2.72,6.89,,,,-45,2.72,6.89,,2","c,rightTape,4,4,0.2,2.81,6.91,-0.1,,,-45,2.81,6.91,-0.1,4","c,leftReel,2,2,1,-2.69,6.91,,,,-45,-2.75,7,,2","cy,base,16,8,16,,-4,,,,,,-4,,6","c,label,12,2,2.2,,10,,,,,,9,1,9"],Ct=()=>{const a=Z(Et(),{Blue:Xe,Silver:Re,Red:K,Orange:ne,Purple:Ze,Green:j});return O.Instance.animateTransform({mesh:a,end:{rotation:new c.Euler(0,2*Math.PI-.01,0)},duration:16e3,ease:e=>e,loop:!0}),a},Nt=()=>["cy,lid,3.9,0.1,3.9,-0.27,2.1,,,,30,-0.27,2.1,,9","cy,label,4,0.8,4,,0.5,,,,,,0.5,,5","cy,can,3.9,1,3.9,,0.5,,,,,,0.5,,9","cy,tuna,3.8,0.6,3.8,,0.8,,,,,,0.8,,8"],Tt=()=>{const a=Z(Nt(),{Blue:Pe,Red:K,Silver:ye});return a.scale.set(.03125,.03125,.03125),a.userData.isPickable=!0,a.onPointerPick=e=>{Ae()},a};class It{clock;parent;_mesh;geometry;constructor(){this.clock=new c.Clock,this.parent=new c.Group,this.parent.name="Grid",this.geometry=new c.PlaneGeometry(20,26,20,26),this.geometry.rotateX(Math.PI/2),this._mesh=new c.Mesh(this.geometry,new c.MeshBasicMaterial({color:"#ff00ff",wireframe:!0})),this.parent.add(this._mesh),I.Instance.on("tick",e=>{const o=this.geometry.getAttribute("position");for(let s=0;s<o.array.length;s+=3){const n=o.array[s],r=o.array[s+2];o.array[s+1]=.5*Math.sin(Math.sqrt(n*n+r*r)-2*this.clock.getElapsedTime())}o.needsUpdate=!0}),I.Instance.on("progress",e=>{!this._mesh.material.visible&&e.bestComboCount>5&&(this._mesh.position.set(0,-5,0),O.Instance.animateTransform({mesh:this._mesh,end:{position:new c.Vector3(0,0,0)},ease:nt,duration:2e3})),this._mesh.material.visible=e.bestComboCount>5})}get mesh(){return this.parent}}const Rt=()=>{const a=new c.Group;a.name="debugScreen",a.renderOrder=1;const e=["You win!","Thanks for playing","Created by Alex Swan"],o=new c.PlaneGeometry(5,5);o.translate(0,-2,0);const s=Le(e,{color:"white"}),n=new c.Mesh(o,s);return a.add(n),n.position.set(0,0,-20),n.scale.set(.1,.1,.1),n.rotation.set(-Math.PI/2,0,0),n.visible=!1,I.Instance.on("progress",r=>{r.color.solved&&r.artist.solved&&r.title.solved&&(console.log("time to show"),n.userData.solved=!0,n.visible=!0,n.material.needsUpdate=!0,O.Instance.animateTransform({mesh:n,end:{position:{x:0,y:0,z:0},scaling:{x:1,y:1,z:1},rotation:new c.Euler(0,0,0)},duration:1e3}))}),a},Pt=()=>["c,base,13,1,3,-1.5,0.5,-0.5,,,,,,,5",["c,panel,12.4,2.7,1,-1.5,2.45,0.3,-60,,,-1.5,1.1,0.88,6","c,display-back,11.8,0.8,0.1,-1.5,3.2,0.85,-60,,,-1.5,1.1,0.88,3","c,progress-color-0,1.8,0.3,0.1,-6.5,2.45,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-color-1,1.8,0.3,0.1,-4.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-2,1.8,0.3,0.1,-2.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-3,1.8,0.3,0.1,-0.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-4,1.8,0.3,0.1,1.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-5,1.8,0.3,0.1,3.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-1,1.8,0.3,0.1,-4.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-2,1.8,0.3,0.1,-2.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-3,1.8,0.3,0.1,-0.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-4,1.8,0.3,0.1,1.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-5,1.8,0.3,0.1,3.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-0,1.8,0.3,0.1,-6.5,1.95,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-title-1,1.8,0.3,0.1,-4.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-2,1.8,0.3,0.1,-2.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-3,1.8,0.3,0.1,-0.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-4,1.8,0.3,0.1,1.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-5,1.8,0.3,0.1,3.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-0,1.8,0.3,0.1,-6.5,1.45,0.85,-60,,,-11.5,1.1,0.88,9","p,display,11.8,0.8,,-1.5,2.22,-0.88,30,,,-1.5,2.22,-0.88,8"]],Ot=()=>{const a=Z(Pt(),{Red:_,Green:ne,Blue:j,Silver:_});return a.scale.set(.1,.1,.1),I.Instance.on("progress",e=>{const o=a.getObjectByName("display");o.material=Le([e.displayText],{color:ve[e.bestComboType],textAlign:"left",ratio:11.8/.8,fontSize:He[e.bestComboType]}),Ke.forEach(s=>{for(let n=0;n<6;n++){const r=a.getObjectByName(`progress-${s}-${n}`);if(!r)continue;let t=ie;(e[s].solved||n<e[s].correctCount)&&(t=ve[s]),(e[s].solved||n<e[s].correctCount)&&s==="color"&&(t=$[n]);const i=t!==ie;r.material.color.set(t),r.material.emissive.set(i?t:_),r.material.emissiveIntensity=i?1:0,r.material.needsUpdate=!0}})}),a},Lt=a=>{const e=new c.Group;e.name="Runner";let o=[pe,ge,we,ce,j,Ie],s=[(t,i)=>t===0||i===0,(t,i)=>t===1||i===1,(t,i)=>t===2||i===2,(t,i)=>t===3||i===3,(t,i)=>t===4||i===4,(t,i)=>t===5||i===5,(t,i)=>i+t===0||2*a-t-i-2===0,(t,i)=>i+t===1||2*a-t-i-2===1,(t,i)=>i+t===2||2*a-t-i-2===2,(t,i)=>i+t===3||2*a-t-i-2===3,(t,i)=>i+t===4||2*a-t-i-2===4,(t,i)=>i+t===5||2*a-t-i-2===5,(t,i)=>(t+i)%2===0,(t,i)=>(t+i)%2===1,(t,i)=>(t+i)%2===0,(t,i)=>(t+i)%2===1,(t,i)=>(t+i)%2===0,(t,i)=>(t+i)%2===1];for(;o.length<a;)o.push(...o);o=o.slice(0,a);let n=-2;const r=new c.BoxGeometry;r.translate(.5,.5,.5),r.scale(.9,1.1,.9);for(let t=0;t<a;t++)for(let i=0;i<a;i++){const u=new c.MeshStandardMaterial({color:_}),l=new c.Mesh(r,u);l.name=`runner-${i}-${t}`,l.userData.x=i,l.userData.y=t,l.position.set(-a/2+i,0,-a/2+t),e.attach(l)}return I.Instance.on("beat",()=>{n+=1,!(n<0)&&e.children.forEach(t=>{const{x:i,y:u}=t.userData,l=s[n%s.length](i,u),d=l?o[n%o.length]:_;t.material.needsUpdate=!0,t.material.color.set(d),t.material.emissive.set(l?d:_),t.material.needsUpdate=!0,t.material.emissiveIntensity=l?1:0,l&&O.Instance.animateTransform({mesh:t,end:{scaling:new c.Vector3(1,l?1.1:1,1)},duration:500,ease:st})})}),e},Bt=a=>{const e=Z(Mt(),{Green:We,Yellow:ne,Orange:Ve,Red:Ye,"Light Blue":j}),o=Ot();e.add(o),o.position.set(-.1,.9,-.7);const s=Tt();e.add(s),s.position.set(-.4,1,-.3);const n=St(a);n.name="Crowd",e.add(n),n.position.set(0,-1,-10),n.rotation.set(0,Math.PI,0);const r=Z(vt(),{Purple:"#333333",Silver:"#888888"});r.name="catMesh",r.position.set(-3,1,0),r.scale.set(.1,.1,.1),r.rotation.set(0,-Math.PI/4,0),e.attach(r);const t=r.clone(!0);t.name="catMesh2",t.position.set(3,1,0),t.rotation.set(0,Math.PI/4,0),e.attach(t);const i=Ct();e.add(i),i.position.set(0,0,-30);const u=new It;e.add(u.mesh),u.mesh.position.set(0,-1,-7);const l=Rt();e.add(l),l.position.set(0,2,-1);const d=Lt(6);return e.add(d),d.position.set(0,-3,-10),d.scale.set(2,1,2),e},At=()=>["cy,cylinder,4,6,2,,-1,,,,,,-1,,4","s,sphere,4,4,2,,2,,,,,,2,,4","c,cube,0.3,1,0.3,-1.15,3.5,-0.55,-77,,,-1.15,3.5,-0.55,9","c,cube,0.3,1,0.3,-0.45,3.9,-0.55,-77,,,-0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,0.45,3.9,-0.55,-77,,,0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,1.05,3.6,-0.55,-77,,,1.05,3.6,-0.55,9","c,cube,2,0.7,0.4,,1.85,-0.9,,,,,1.5,-0.1,3","c,cube,0.8,0.5,1.1,,2.45,-0.55,,,,,2.2,-0.1,3","c,cube,0.3,0.6,0.6,-1.15,2.7,-0.8,,,,-1.15,2.7,-0.1,3","c,cube,0.3,0.6,0.6,-0.45,3.1,-0.8,,,,-0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,0.45,3.1,-0.8,,,,0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,1.05,2.7,-0.8,,,,1.05,2.7,-0.1,3"],Dt={Purple:ie,Red:K,Silver:ye},kt=(a={})=>{const e=new c.Group;e.name="paw";const o=Z(At(),{...Dt,...a});return o.scale.set(.03125,.03125,.03125),o.rotation.set(3*Math.PI/2,0,0),e.attach(o),e},Gt=()=>["c,cube,6,6,8,,,,,,,,-3,,2","c,cube,4,4,11.1,,,-0.55,,,,,-3,,2","c,cube,2,2,2,-2,,-5,,,,-2,-1,-5,4","c,cube,2,2,2,2,,-5,,,,2,-1,-5,4","c,cube,2,6,2,,,6,,,,,-3,7,2","c,cube,1,4,6,,-3,9.5,15,,,,-3,8.5,9","c,cube,1,5,7,,2.5,9.9,-15,,,,2,8.4,2","c,cube,2,5,6,,2.2,,-30,,,,2.7,,2","c,cube,1,2,2,-2.5,-4,-2,,,-40,-3,-3,-2,9","c,cube,3,1,4,-4.5,-3.5,4,,,20,-3,-3,3,9","c,cube,1,2,2,2.5,-4,-2,,,40,3,-3,-2,9","c,cube,3,1,4,4.5,-3.5,4,,,-25,3,-3,3,9"],Ee=[{},{Orange:qe,Purple:_,Silver:Pe}],zt=new c.Vector3(.05,.05,.05),Ut=()=>{new c.Vector3(1,0,0);const a=new c.Group;a.name="FishSwirl";const e=[];let o=!0;const s=new c.Group,n=Z(Gt(),Ee[c.MathUtils.randInt(0,Ee.length)]);for(let r=0;r<10;r++){const t=n.clone(!0);t.position.set(Math.random()*10-5,0,0),e.push(t),s.attach(t),t.userData.velocity=new c.Vector3(0,5+3*Math.random(),-5),t.scale.set(0,0,0)}return s.rotation.set(0,0,0),a.attach(s),I.Instance.on("tick",r=>{e.forEach(t=>{if(t.userData.velocity.y-=10*r,t.position.addScaledVector(t.userData.velocity,r),t.position.y<0){const u=new c.Vector3(Math.random()*4-2,0,Math.random()*4-2).sub(t.position).normalize(),l=new c.Quaternion;l.setFromUnitVectors(new c.Vector3(0,0,-1),u),t.quaternion.copy(l),t.position.y=0;const d=new c.Vector3(0,0,-1);d.applyQuaternion(t.quaternion),d.multiplyScalar(5),t.userData.velocity.x=d.x,t.userData.velocity.z=d.z,t.userData.velocity.y=5+6*Math.random()}const i=new c.Quaternion;i.setFromUnitVectors(new c.Vector3(0,0,-1),t.userData.velocity),t.quaternion.copy(i)})}),I.Instance.on("progress",r=>{const t=r.bestComboCount>=4,i=t!==o;e.forEach(u=>{i&&(O.Instance.cancelAnimation(u),O.Instance.animateTransform({mesh:u,end:{scaling:t?zt:new c.Vector3(0,0,0)},duration:t?2e3:1e3}))}),o=t}),a},_t=()=>{const a=new c.Group;a.name="Sky";const e=new c.Object3D,o=30,s=.05,n=new c.BoxGeometry,r=new c.MeshStandardMaterial,t=[];let i=0,u=0;const l=new c.InstancedMesh(n,r,o*o);l.instanceMatrix.setUsage(c.DynamicDrawUsage);const d=new c.Color,m=[new c.Color(65535),new c.Color(16776960),new c.Color(16711935)];let h=0;for(let g=0;g<o;g++)for(let y=0;y<o;y++){const E=xe(0,2*y*Math.PI/o,15);E.z=-g*4,e.position.copy(E),e.scale.set(1,1,2),e.updateMatrix(),d.setHSL(1,.5+Math.random()*.5,.5+Math.random()*.5),t.push(d.getHex()),l.setMatrixAt(h,e.matrix),l.setColorAt(h,d.multiply(m[0])),h++}return a.add(l),I.Instance.on("tick",g=>{i+=g;for(let y=0;y<l.count;y++){l.getMatrixAt(y,e.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const E=Math.floor(y/o),f=E%2?1:-1,M=y%o,b=-E*4,v=2*M*Math.PI/o,w=s*f*i;e.position.copy(xe(0,v+w,15)),e.position.z=b+u*f*Math.sin(i),e.updateMatrix(),l.setMatrixAt(y,e.matrix)}l.instanceMatrix.needsUpdate=!0}),I.Instance.on("progress",g=>{u=g.bestComboCount>=2?1:0}),a},Vt=new c.Clock;let oe=0,q,D,fe,A,Y,W,X;const me=[];let Ce;const he=new c.Vector3(0,0,.3),Yt=async()=>{document.getElementById("p").setAttribute("disabled","true"),document.getElementById("p").innerHTML="LOADING...",A=new c.WebGLRenderer({antialias:!0}),A.setPixelRatio(window.devicePixelRatio),A.setSize(window.innerWidth,window.innerHeight),A.setClearColor("#000000"),A.xr.addEventListener("sessionstart",Wt),A.xr.enabled=!0,A.setAnimationLoop(qt),document.body.appendChild(J.createButton(A)),document.body.appendChild(A.domElement);const a=new Qe;D=new c.Scene,q=new c.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),q.position.set(0,2,1),q.rotation.set(-1*Math.PI/12,0,0),q.name="camera",D.add(q),O.Instance.initScene(D);const e=new c.AmbientLight(16777215,.8);D.add(e);const o=new c.DirectionalLight(16777215,.8);o.position.set(6,10,8),o.castShadow=!0,o.target.position.set(0,0,0),D.add(o),D.add(o.target);const s=_t();s.position.set(0,0,5),D.add(s);const n=Bt(A);D.add(n);const r=n.getObjectByName("tableA"),t=Ut();t.position.set(0,0,-10),D.attach(t),a.vinyls.forEach((i,u)=>{const l=tt(i);l.name=`vinyl-${u}`;const d=new c.Vector3(.7,1.15,-.2-.125*u);l.position.copy(d),l.userData.originalPosition=d,l.userData.isPickable=!0,l.userData.recordIndex=u,l.userData.returnToOriginalPosition=()=>{D.attach(l),O.Instance.cancelAnimation(l),O.Instance.animateTransform({mesh:l,end:{position:l.userData.originalPosition,rotation:new c.Euler(0,0,0)},duration:100})},l.onPointerPick=m=>{if(m.userData.selected||a.isSolved())return;a.selected[m.id]=u;const h=m.getObjectByName("target");h&&(O.Instance.cancelAnimation(l),h.attach(l),O.Instance.animateTransform({mesh:l,end:{position:new c.Vector3(0,0,0),rotation:new c.Euler(0,Math.PI/2,0)},duration:60}),m.userData.selected=l)},l.onPointerDrop=m=>{if(O.Instance.cancelAnimation(l,!0),l.getWorldPosition(new c.Vector3).distanceTo(r.getWorldPosition(new c.Vector3))<.3){a.addVinylByIndex(l.userData.recordIndex),delete a.selected[m.id],m.userData.selected=void 0,r.children.forEach(g=>{g.userData.returnToOriginalPosition&&g.userData.returnToOriginalPosition()}),r.attach(l),ut(),O.Instance.animateTransform({mesh:l,end:{position:new c.Vector3(0,.01,0),rotation:new c.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{O.Instance.animateTransform({mesh:l,end:{rotation:new c.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:g=>g,duration:1800,loop:!0})});return}else l.userData.returnToOriginalPosition(),m.userData.selected=void 0},D.add(l)}),W=A.xr.getController(0),W.addEventListener("connected",Ne),W.addEventListener("selectstart",re),W.addEventListener("selectend",ae),W.addEventListener("squeezestart",re),W.addEventListener("squeezeend",ae),D.add(W),X=A.xr.getController(1),X.addEventListener("connected",Ne),X.addEventListener("selectstart",re),X.addEventListener("selectend",ae),X.addEventListener("squeezestart",re),X.addEventListener("squeezeend",ae),D.add(X),fe=new c.Raycaster,window.addEventListener("resize",Zt,!1),I.Instance.on("comboBroken",()=>{Ae()}),dt(),I.Instance.on("downbeat",()=>{oe>100&&(I.Instance.emit("beat"),oe=0)}),a.reset(),document.getElementById("intro").style.display="none",document.getElementById("c").style.display="block"};function Wt(){Ce=A.xr.getReferenceSpace();const a={x:-1*he.x,y:-1*he.y,z:-1*he.z,w:1},e=new c.Quaternion,o=new XRRigidTransform(a,e),s=Ce.getOffsetReferenceSpace(o);A.xr.setReferenceSpace(s)}function Ne(a){console.log("controller connected",a);const e=a.target,o=a.data.handedness==="left"?-1:1;if(!e.getObjectByName("target")){const t=new c.Group;t.name="target",t.rotation.set(0,0,0),t.position.set(-1*o*.035,.05,-.12),e.add(t)}let n=e.getObjectByName("paw");n||(n=kt(),n.position.set(0,0,.15),e.add(n));let r=e.getObjectByName("line");if(!r){const t=new c.BufferGeometry().setFromPoints([new c.Vector3(0,0,0),new c.Vector3(0,0,-1)]);r=new c.Line(t),r.material.color.set(16711680),r.name="line",r.scale.z=5,e.add(r)}}function re(a){Y=a.target;const e=De(Y);if(e.length>0){let o=!1;e.forEach(({object:s,distance:n})=>{if(o)return;let r=s;for(;r;){if(r.onPointerPick){r.onPointerPick(Y),o=!0;const t=Y.getObjectByName("line");t.visible=!1;break}r=r.parent}})}Y.userData.targetRayMode=a.data.targetRayMode}function ae(a){Y=a.target;const e=Y.userData.selected;e?.onPointerDrop&&e.onPointerDrop(Y);const o=Y.getObjectByName("line");o.visible=!0}function De(a){return a.updateMatrixWorld(),fe.setFromXRController(a),fe.intersectObjects(D.children,!0)}function Te(a){if(a.userData.targetRayMode==="screen"||a.userData.selected!==void 0)return;const e=a.getObjectByName("line"),o=De(a);if(e&&(e.scale.z=5),o.length>0){let s=!1;o.forEach(({object:n,distance:r})=>{if(s)return;let t=n;for(;t;){if(t.userData.isPickable){const i=t.getObjectByName("highlight");i&&(i.visible=!0),e&&(e.scale.z=r),me.push(t),s=!0;break}t=t.parent}})}}function Xt(){for(;me.length;){const e=me.pop().getObjectByName("highlight");e&&(e.visible=!1)}}function qt(){const a=Vt.getDelta();oe+=a,oe>=.5&&(I.Instance.emit("beat"),oe-=.5),O.Instance.update(),I.Instance.emit("tick",a),Xt(),Te(W),Te(X),A.render(D,q)}const Zt=()=>{q.aspect=window.innerWidth/window.innerHeight,q.updateProjectionMatrix(),A.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("p");a.onclick=Yt});
