import*as n from"https://js13kgames.com/2025/webxr/three.module.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))_(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&_(l)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function _(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const ge=()=>[["cube_case1_1_8_2_7.50_4_0_0_0_0_7.50_4_0_#0000ff","cube_case2_3_9_2_5.50_4.50_0_0_0_0_5.50_4.50_0_#0000ff","cube_case3_8_4_2_0_7_0_0_0_0_0_8.50_0_#0000ff","cube_case4_8_1_2_0_2.50_0_0_0_0_0_2.50_0_#0000ff","cube_case5_3_9_2_-5.50_4.50_0_0_0_0_-5.50_4.50_0_#0000ff","cube_case6_1_8_2_-7.50_4_0_0_0_0_-7.50_4_0_#0000ff"],"cube_base_12_2.10_2.40_0_0.95_0_0_0_0_0_0_0_#ff0000","cube_rightReel_2_2_1_2.72_3.89_0_0_0_-45_2.72_3.89_0_#ff7300","cube_rightTape_4_4_0.20_2.81_3.91_-0.10_0_0_-45_2.81_3.91_-0.10_#c300ff","cube_leftReel_2_2_1_-2.69_3.91_0_0_0_-45_-2.75_4_0_#ff7300","sphere_dot_1_1_1_0_4_0_0_0_0_0_4_0_#9999ff","plane_label_12_3_0_0_7_1.01_90_0_0_0_7_1.01_#d3d3d3","cylinder_base_16_8_16_0_-4_0_0_0_0_0_-4_0_#00ff00"],ye=()=>[[["cube_complete-0_0.3_0.1_0.1_-0.75_1.05_-0.45_0_0_0_-0.75_1.05_-0.45_#ff0000","cube_complete-1_0.3_0.1_0.1_-0.75_1.05_-0.35_0_0_0_-0.75_1.05_-0.35_#00ff00","cube_complete-2_0.3_0.1_0.1_-0.75_1.05_-0.25_0_0_0_-0.75_1.05_-0.25_#0000ff"],["sphere_progress-0_0.2_0.2_0.2_-0.75_1.05_-0.75_0_0_0_-0.75_1.05_-0.75_#fffb00","sphere_progress-1_0.2_0.2_0.2_-0.55_1.05_-0.75_0_0_0_-0.55_1.05_-0.75_#fffb00","sphere_progress-2_0.2_0.2_0.2_-0.35_1.05_-0.75_0_0_0_-0.35_1.05_-0.75_#fffb00","sphere_progress-3_0.2_0.2_0.2_-0.15_1.05_-0.75_0_0_0_-0.15_1.05_-0.75_#fffb00","sphere_progress-4_0.2_0.2_0.2_0.05_1.05_-0.75_0_0_0_0.05_1.05_-0.75_#fffb00","sphere_progress-5_0.2_0.2_0.2_0.25_1.05_-0.75_0_0_0_0.25_1.05_-0.75_#fffb00"],"cube_desk_2_0.9_1_0_0.45_-0.5_0_0_0_0_-0.1_0_#fffb00","cube_record-rack_0.4_0.1_0.8_0.7_0.95_-0.5_0_0_0_0.7_0.95_-0.5_#b0ffb0","cube_progress-bar_1.3_0.1_0.3_-0.25_0.95_-0.75_0_0_0_-0.25_0.95_-0.75_#d3d3d3","cube_cube_0.3_0.1_0.4_-0.75_0.95_-0.3_0_0_0_-0.75_0.95_-0.3_#9999ff","cube_cube_0.4_0.1_0.4_-0.3_0.95_-0.3_0_0_0_-0.3_0.95_-0.3_#d3d3d3","cube_tableA_0.4_0.1_0.4_0.2_0.95_-0.3_0_0_0_0.2_1.01_-0.3_#b0ffb0","cylinder_pad_0.4_0.02_0.4_0.2_1_-0.3_0_0_0_0.2_1_-0.3_#ff0000"],"cube_cube_22_1_19_0_-2.5_-4.5_0_0_0_0_-3_-4_#ff00ff","cube_cube_12_1_12_0_-1.5_-4_0_0_0_0_-2_-4_#ff0000","cube_cube_8_1_3_0_-0.5_0.5_0_0_0_0_-1_-4_#c300ff","cube_pillar_1_4_1_7.5_0_-2.5_0_0_0_8_0_-3_#fffb00","cube_pillar_1_4_1_7.5_0_-6.5_0_0_0_8_0_-7_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_-7.5_0_-2.5_0_0_0_-7_0_-3_#fffb00","cube_pillar_1_4_1_-7.5_0_1.5_0_0_0_-7_0_1_#fffb00","cube_pillar_1_4_1_7.5_0_1.5_0_0_0_8_0_1_#fffb00","cube_pillar_1_4_1_-7.5_0_-6.5_0_0_0_-7_0_-7_#fffb00","cube_pillar_1_4_1_-7.5_0_-10.5_0_0_0_-7_0_-11_#fffb00","cube_cube_4_1_16_9_2.5_-6_0_0_0_8_2_0_#00ff00","cube_cube_4_1_16_-9_2.5_-6_0_0_0_-10_2_0_#00ff00"],be=()=>["sphere_head_16_16_16_0_8_0_0_0_0_0_8_0_#c300ff",["cylinder_leftEye_4_1_4_-3_11_-6.3_-60_0_25_-3_11_-6.3_#fffb00","sphere_leftPupil_2_2_4_-3.6_11.3_-7_-60_0_25_-3.6_11.3_-7_#c300ff","cylinder_rightEye_4_1_4_3_11_-6.3_-60_0_-25_3_11_-6.3_#fffb00","sphere_rightPupil_2_2_4_3.4_11.3_-7_-60_0_-25_3.4_11.3_-7_#c300ff"],["cube_rightCheek_3_3_2_1.84_6.53_-7.5_-25_0_80_1.84_6.53_-7.5_#0000ff","cube_leftCheek_3_3_2_-1.91_6.48_-7.5_0_23_10_-1.91_6.48_-7.5_#0000ff","cube_tongue_2_2_2_0_5_-7_0_0_0_0_4_-7_#ff0000","pyramid_pyramid_3_1.6_1_0_8.2_-8_-180_0_0_0_8.2_-8_#ff00ff"],["pyramid_ear_6_11_4_-4.86_15.55_-1.28_-14_-6_24_-4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_-5.04_15.94_-1.59_-14_-6_24_-5.04_15.94_-1.59_#fffb00","pyramid_ear_6_11_4_4.86_15.55_-1.28_-14_6_-24_4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_5.04_15.94_-1.59_-14_6_-24_5.04_15.94_-1.59_#fffb00"],["cylinder_cylinder_0.2_6_0.2_-3.93_6_-8.92_0_-15_90_-3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_7.52_-8.5_0_-15_75_-4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_4.48_-8.5_0_-15_105_-4.87_4.48_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_7.52_-8.5_180_-15_-105_4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_6_0.2_3.93_6_-8.92_0_-165_90_3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_4.48_-8.5_180_-15_-75_4.87_4.48_-8.5_#d3d3d3"]],me=()=>["cylinder_cylinder_4_6_2_0_-1_0_0_0_0_0_-1_0_#c300ff","sphere_sphere_4_4_2_0_2_0_0_0_0_0_2_0_#c300ff","cube_cube_0.3_1_0.3_-1.15_3.5_-0.55_-77_0_0_-1.15_3.5_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_-0.45_3.9_-0.55_-77_0_0_-0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_0.45_3.9_-0.55_-77_0_0_0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_1.05_3.6_-0.55_-77_0_0_1.05_3.6_-0.55_#d3d3d3","cube_cube_2_0.7_0.4_0_1.85_-0.9_0_0_0_0_1.5_-0.1_#ff0000","cube_cube_0.8_0.5_1.1_0_2.45_-0.55_0_0_0_0_2.2_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-1.15_2.7_-0.8_0_0_0_-1.15_2.7_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-0.45_3.1_-0.8_0_0_0_-0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_0.45_3.1_-0.8_0_0_0_0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_1.05_2.7_-0.8_0_0_0_1.05_2.7_-0.1_#ff0000"],J={uniforms:{uDirLightPos:{value:new n.Vector3},uDirLightColor:{value:new n.Color(15658734)},uAmbientLightColor:{value:new n.Color(328965)},uBaseColor:{value:new n.Color(16777215)},uLineColor1:{value:new n.Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},Z=i=>{const t=new n.Group;t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1);const e=a=>{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_"),p=Math.sqrt(u*u+u*u)/2,M=new n.CylinderGeometry(0,p,m,4,1,!1,Math.PI/4);return M.scale(1,1,w/u),M.translate(x-g,v-d+.3*m,E-b),M.rotateX(n.MathUtils.degToRad(h)),M.rotateY(n.MathUtils.degToRad(y)),M.rotateZ(n.MathUtils.degToRad(c)),M},_=a=>{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_"),p=new n.BoxGeometry(u,m,w);return p.translate(x-g,v-d,E-b),p.rotateX(n.MathUtils.degToRad(h)),p.rotateY(n.MathUtils.degToRad(y)),p.rotateZ(n.MathUtils.degToRad(c)),p},r=a=>{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_"),p=new n.SphereGeometry(parseFloat(u)/2,32,16);return p.scale(u/u,m/u,w/u),p.translate(x-g,v-d,E-b),p.rotateX(n.MathUtils.degToRad(h)),p.rotateY(n.MathUtils.degToRad(y)),p.rotateZ(n.MathUtils.degToRad(c)),p},o=a=>{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_"),p=new n.PlaneGeometry(u,m);return p.rotateX(n.MathUtils.degToRad(-90)),p.translate(x-g,v-d,E-b),p.rotateX(n.MathUtils.degToRad(h)),p.rotateY(n.MathUtils.degToRad(y)),p.rotateZ(n.MathUtils.degToRad(c)),p},l=a=>{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_");console.log("cylinder",{name:s,width:u,height:m,depth:w,x,y:v,z:E,rX:h,rY:y,rZ:c,oX:g,oY:d,oZ:b});const p=u/2,M=new n.CylinderGeometry(p,p,m,32);M.translate(x-g,v-d,E-b),M.scale(1,1,w/u);const L=n.MathUtils.degToRad(h),q=n.MathUtils.degToRad(y),C=n.MathUtils.degToRad(c),N=new n.Euler(L,q,C);return M.applyQuaternion(new n.Quaternion().setFromEuler(N)),M};return i.forEach(a=>{if(a===null){console.error("ITEM IS NULL");return}if(Array.isArray(a))t.add(Z(a));else{const[f,s,u,m,w,x,v,E,h,y,c,g,d,b,I]=a.split("_");let p=null;switch(f){case"cube":p=_(a);break;case"sphere":p=r(a);break;case"plane":p=o(a);break;case"cylinder":p=l(a);break;case"pyramid":p=e(a);break;default:throw new Error(`Unknown shape: ${f}`)}let M=null;s.startsWith("case")?M=new n.ShaderMaterial({uniforms:{...J.uniforms},vertexShader:J.vertexShader,fragmentShader:J.fragmentShader}):M=new n.MeshStandardMaterial({color:I,side:n.DoubleSide});const L=new n.Mesh(p,M);L.name=s,L.position.set(g,d,b),t.add(L)}}),t},ie=i=>{const{radius:t,depth:e,color:_}=i,r=new n.CylinderGeometry(t,t,e,32),o=new n.MeshBasicMaterial({color:_});return new n.Mesh(r,o)},$=i=>{if(i==="cassette"){const t=Z(ge());return t.name="cassette",t}else if(i==="arena"){const t=Z(ye());return t.name="arena",t}else if(i==="cat"){const t=Z(be());return t.name="cat",t}else if(i==="paw"){const t=Z(me());return t.name="paw",t.scale.set(.03125,.03125,.03125),t}return null};class O{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return O._instance||(O._instance=new O),O._instance}on(t,e){this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e)}off(t,e){this.callbacks[t]=(this.callbacks[t]||[]).filter(_=>_!==e)}emit(t,...e){(this.callbacks[t]||[]).forEach(_=>_(...e))}_reset(){Object.keys(this.callbacks).forEach(t=>{delete this.callbacks[t]})}getCallbacks(){return this.callbacks}}const de="#e81416",we="#ffa500",xe="#faeb36",oe="#79c314",se="#487de7",ve="#70369d",Q="#000000",X=[de,we,xe,oe,se,ve],F=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],j=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],Se=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]];class Ee{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset()}addVinylByIndex(t){const{color:e,artist:_,title:r}=this.vinyls[t],o=X.indexOf(e),l=F.indexOf(_),a=j.indexOf(r);o===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===X.length&&(this.progress.color.solved=!0)):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),this.progress.color.currentIndex=o,l===(this.progress.artist.currentIndex+1)%F.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===F.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=l,a===(this.progress.title.currentIndex+1)%j.length?(this.progress.title.correctCount++,this.progress.title.correctCount===j.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=a,O.Instance.emit("progress",this.progress),O.Instance.emit("debug",JSON.stringify(this.progress))}isSolved(t){return this.progress[t].solved}reset(){this.queue=[],this.selected={};const[t,e,_]=Se;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-1,correctCount:0,solved:!1},title:{currentIndex:-1,correctCount:0,solved:!1}},this.vinyls=X.map((r,o)=>({index:o,color:X[t[o]],artist:F[e[o]],title:j[_[o]]})),t.forEach((r,o)=>{this.vinyls[r].color=X[o]}),e.forEach((r,o)=>{this.vinyls[r].artist=F[o]}),_.forEach((r,o)=>{this.vinyls[r].title=j[o]}),O.Instance.emit("progress",this.progress)}}class W{static createButton(t,e={}){const _=document.createElement("button");function r(){let s=null;async function u(x){x.addEventListener("end",m),await t.xr.setSession(x),_.textContent="EXIT VR",s=x}function m(){s.removeEventListener("end",m),_.textContent="ENTER VR",s=null}_.style.display="",_.style.cursor="pointer",_.style.left="calc(50% - 50px)",_.style.width="100px",_.textContent="ENTER VR";const w={...e,optionalFeatures:["local-floor","bounded-floor","layers",...e.optionalFeatures||[]]};_.onmouseenter=function(){_.style.opacity="1.0"},_.onmouseleave=function(){_.style.opacity="0.5"},_.onclick=function(){s===null?navigator.xr.requestSession("immersive-vr",w).then(u):(s.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",w).then(u).catch(x=>{console.warn(x)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",w).then(u).catch(x=>{console.warn(x)})}function o(){_.style.display="",_.style.cursor="auto",_.style.left="calc(50% - 75px)",_.style.width="150px",_.onmouseenter=null,_.onmouseleave=null,_.onclick=null}function l(){o(),_.textContent="VR NOT SUPPORTED"}function a(s){o(),console.warn("Exception when trying to call xr.isSessionSupported",s),_.textContent="VR NOT ALLOWED"}function f(s){s.style.position="absolute",s.style.bottom="20px",s.style.padding="12px 6px",s.style.border="1px solid #fff",s.style.borderRadius="4px",s.style.background="rgba(0,0,0,0.1)",s.style.color="#fff",s.style.font="normal 13px sans-serif",s.style.textAlign="center",s.style.opacity="0.5",s.style.outline="none",s.style.zIndex="999"}if("xr"in navigator)return _.id="VRButton",_.style.display="none",f(_),navigator.xr.isSessionSupported("immersive-vr").then(function(s){s?r():l(),s&&W.xrSessionIsGranted&&_.click()}).catch(a),_;{const s=document.createElement("a");return window.isSecureContext===!1?(s.href=document.location.href.replace(/^http:/,"https:"),s.innerHTML="WEBXR NEEDS HTTPS"):(s.href="https://immersiveweb.dev/",s.innerHTML="WEBXR NOT AVAILABLE"),s.style.left="calc(50% - 90px)",s.style.width="180px",s.style.textDecoration="none",f(s),s}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{W.xrSessionIsGranted=!0})}}}W.xrSessionIsGranted=!1;W.registerSessionGrantedListener();const Me=.3,P=44100,ee=new(window.AudioContext||window.webkitAudioContext),Ce=(i=1,t=.05,e=220,_=0,r=0,o=.1,l=0,a=1,f=0,s=0,u=0,m=0,w=0,x=0,v=0,E=0,h=0,y=1,c=0,g=0)=>{let d=2*Math.PI,b=f*=500*d/P**2,I=(0<v?1:-1)*d/4,p=e*=(1+2*t*Math.random()-t)*d/P,M=[],L=0,q=0,C=0,N=1,he=0,pe=0,G=0,V,U;for(_=99+P*_,c*=P,r*=P,o*=P,h*=P,s*=500*d/P**3,v*=d/P,u*=d/P,m*=P,w=P*w|0,U=_+c+r+o+h|0;C<U;M[C++]=G)++pe%(100*E|0)||(G=l?1<l?2<l?3<l?Math.sin((L%d)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/d%2+2)%2:1-4*Math.abs(Math.round(L/d)-L/d):Math.sin(L),G=(w?1-g+g*Math.sin(2*Math.PI*C/w):1)*(0<G?1:-1)*Math.abs(G)**a*i*Me*(C<_?C/_:C<_+c?1-(C-_)/c*(1-y):C<_+c+r?y:C<U-h?(U-C-h)/o*y:0),G=h?G/2+(h>C?0:(C<U-h?1:(U-C)/h)*M[C-h|0]/2):G),V=(e+=f+=s)*Math.sin(q*v-I),L+=V-V*x*(1-1e9*(Math.sin(C)+1)%2),q+=V-V*x*(1-1e9*(Math.sin(C)**2+1)%2),N&&++N>m&&(e+=u,p+=u,N=0),!w||++he%w||(e=p,f=b,N=N||1);return M},Re=(...i)=>{let t=ee.createBufferSource(),e=ee.createBuffer(i.length,i[0].length,P);return i.map((_,r)=>e.getChannelData(r).set(_)),t.buffer=e,t.connect(ee.destination),t.start(),t},Ie=(...i)=>Re(Ce(...i)),Te=()=>Ie(1.01,void 0,275,.01,.01,.15,1,1.03,-3.7,void 0,-93,.07,void 0,void 0,void 0,-.1,void 0,.5,.04,.09);let Le=0;const Pe=(i,t)=>{const e=new n.Group;e.name=`Witch${++Le}`;const _=[],r=$("cat");r.scale.set(.03,.03,.03),e.add(r),r.position.set(0,-.25,-.05);const o=()=>{if(t.xr?.getCamera()&&t.xr?.getCamera()){const l=t.xr?.getCamera();if(_.push(l.quaternion.clone()),_.length>60){let a=_.shift();const f=new n.Quaternion().setFromEuler(new n.Euler(0,Math.PI,0));a&&e.quaternion.copy(f.multiply(a))}}};return O.Instance.on("tick",o),e.userData.isPickable=!0,e.onPointerPick=()=>{Te()},i.add(e),e},Oe=(i,t,e)=>Math.min(Math.max(i,t),e),ue=(i=512)=>{const t=document.createElement("canvas");t.width=i,t.height=i;const e=t.getContext("2d");return[t,e]},k=.0254,ke=(i,t)=>{const[_,r]=ue(1024);r.fillStyle=Q,r.strokeStyle=Q,r.lineWidth=8,r.beginPath(),r.arc(1024/2,1024/2,20,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(1024/2,1024/2,288,0,2*Math.PI),r.stroke(),r.textAlign="center",i&&(r.font="64px monospace",r.textBaseline="middle",r.strokeStyle=Q,r.lineWidth=8,r.strokeText(i,.5*1024,.42*1024),r.fillStyle=oe,r.fillText(i,.5*1024,.42*1024)),t&&(r.font="96px monospace",r.textBaseline="bottom",r.fillStyle=se,r.strokeText(t,.5*1024,.68*1024),r.fillText(t,.5*1024,.68*1024));const o=new n.CanvasTexture(_);return o.encoding=n.LinearSRGBColorSpace,new n.MeshBasicMaterial({map:o,transparent:!0})},De=({color:i,artist:t,title:e})=>{const _=new n.Group,r=new n.RingGeometry(4,7,32);r.scale(k,k,k);const o=new n.MeshPhongMaterial({color:i,side:n.DoubleSide,emissive:0,specular:1118481,shininess:50});_.add(new n.Mesh(r,o));const l=new n.RingGeometry(.25,4,32);l.scale(k,k,k);const a=new n.MeshStandardMaterial({color:16777215,side:n.DoubleSide});_.add(new n.Mesh(l,a));const f=new n.PlaneGeometry(14,14);f.translate(0,0,.001),f.scale(k,k,k);const s=ke(t,e);_.add(new n.Mesh(f,s));const u=_.clone();return u.rotation.set(0,Math.PI,0),u.position.set(0,0,-.002),_.add(u),_},ze=i=>i*i;class T{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new n.Clock}static get Instance(){return T._instance||(T._instance=new T),T._instance}initScene(t){this.scene||(this.scene=t,this.clock.start())}update(){const t=this.clock.getElapsedTime()*1e3;this.animations=this.animations.filter(e=>{const _=t-e.startTime,r=e.endTime-e.startTime,o=Oe(_/r,0,1);if(t>=e.endTime)return e.loop?(e.startTime=t,e.endTime=t+r,e.end.position&&e.mesh.position.copy(e.start.position),e.end.rotation&&e.mesh.rotation.copy(e.start.rotation),e.end.scaling&&e.mesh.scale.copy(e.start.scaling),!0):(e.end.position&&e.mesh.position.copy(e.end.position),e.end.rotation&&e.mesh.rotation.copy(e.end.rotation),e.end.scaling&&e.mesh.scale.copy(e.end.scaling),e.resolve&&(e.resolve(),e.resolve=void 0,e.reject=void 0),!1);if(e.end.position&&e.mesh.position.lerpVectors(e.start.position,e.end.position,e.easeFunc(o)),e.end.rotation){const l=e.start.rotation,a=e.end.rotation,f=new n.Euler;f.x=l.x+(a.x-l.x)*e.easeFunc(o),f.y=l.y+(a.y-l.y)*e.easeFunc(o),f.z=l.z+(a.z-l.z)*e.easeFunc(o),e.mesh.rotation.copy(f)}return e.end.scaling&&e.mesh.scale.lerpVectors(e.start.scaling,e.end.scaling,e.easeFunc(o)),!0})}animateTransform(t){const{mesh:e,end:_}=t,r=t.duration||1e3,o=t.delay||0,l=t.ease||ze,a=this.clock.getElapsedTime()*1e3;let f,s;const u=new Promise((m,w)=>{f=m,s=w});return this.animations.push({mesh:e,start:{position:e.position.clone(),rotation:e.rotation.clone(),scaling:e.scale.clone()},end:_,easeFunc:l,startTime:a+o,endTime:a+o+r,loop:t.loop||!1,resolve:f,reject:s}),u}cancelAnimation(t,e=!1){const _=this.animations.filter(r=>r.mesh===t);_.length&&(_.forEach(r=>{e&&(r.end.position&&t.position.copy(r.end.position),r.end.rotation&&t.rotation.copy(r.end.rotation),r.end.scaling&&t.scale.copy(r.end.scaling)),r.reject&&(r.reject(),r.resolve=void 0,r.reject=void 0)}),this.animations=this.animations.filter(r=>r.mesh!==t))}}const Be=()=>{const i=new n.Group;i.name="debugScreen",i.renderOrder=1;const t=["You win!","Thanks for playing","Created by Alex Swan"],e=new n.PlaneGeometry(5,5);e.translate(0,-2,0);const[_,r]=ue(1024),o=new n.CanvasTexture(_);o.encoding=n.LinearSRGBColorSpace;const l=new n.MeshBasicMaterial({map:o,transparent:!0}),a=new n.Mesh(e,l);i.add(a),a.position.set(0,0,0);const f=()=>{if(!a.userData.solved)return;r.clearRect(0,0,_.width,_.height),r.globalAlpha=.5,r.fillStyle="black",r.fillRect(0,0,_.width,_.height*.2),r.globalAlpha=1;const s=64;r.fillStyle="white",r.textBaseline="top",r.textAlign="center",r.font=`${s}px monospace`,t.forEach((u,m)=>{r.fillText(u,_.width/2,s*m)}),o.needsUpdate=!0};return O.Instance.on("progress",s=>{s.color.solved&&s.artist.solved&&s.title.solved&&(a.userData.solved=!0),f()}),i},ae={color:de,artist:oe,title:se};let A,S,ne,R,B,D,z,te,re,Y,ce;const _e=new n.Vector3(0,0,.3),Ge=async()=>{document.getElementById("intro").style.display="none";const t=document.getElementById("c");if(!t)return;t.style.display="block",R=new n.WebGLRenderer({antialias:!0}),R.setPixelRatio(window.devicePixelRatio),R.setSize(window.innerWidth,window.innerHeight),R.setClearColor("#000000"),R.xr.addEventListener("sessionstart",Ae),R.xr.enabled=!0,R.setAnimationLoop(Ne),document.body.appendChild(W.createButton(R)),document.body.appendChild(R.domElement);const e=new Ee;S=new n.Scene,A=new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),A.position.set(0,2,1),A.rotation.set(-1*Math.PI/12,0,0),A.name="camera",S.add(A),T.Instance.initScene(S);const _=new n.AmbientLight(16777215,.8);S.add(_);const r=new n.DirectionalLight(16777215,.8);r.position.set(6,10,8),r.castShadow=!0,r.target.position.set(0,0,0),S.add(r),S.add(r.target);const o=Be();o.position.set(0,1.5,-1),S.add(o),Y=$("cassette"),Y.position.set(0,0,-20),Y.userData.isPickable=!0,S.add(Y),T.Instance.animateTransform({mesh:Y,end:{rotation:new n.Euler(0,2*Math.PI-.01,0)},duration:3e3,ease:h=>h,loop:!0});const l=$("arena"),a=l.getObjectByName("tableA");S.add(l);const f=$("cat");f.position.set(-3,1,0),f.scale.set(.1,.1,.1),S.add(f);const s=f.clone(!0);s.name="catMesh2",s.position.set(3,1,-1),s.rotation.set(0,Math.PI/2,0),S.add(s);const u=Pe(S,R);u.position.set(0,1.5,-1),u.rotation.set(0,Math.PI,0),e.vinyls.forEach((h,y)=>{const c=De(h);c.name=`vinyl-${y}`;const g=new n.Vector3(.7,1.15,-.2-.125*y);c.position.copy(g),c.userData.originalPosition=g,c.userData.isPickable=!0,c.userData.recordIndex=y,c.userData.returnToOriginalPosition=()=>{S.attach(c),T.Instance.cancelAnimation(c),T.Instance.animateTransform({mesh:c,end:{position:c.userData.originalPosition,rotation:new n.Euler(0,0,0)},duration:100})},c.onPointerPick=d=>{if(d.userData.selected)return;e.selected[d.id]=y;const b=d.getObjectByName("target");b&&(T.Instance.cancelAnimation(c),b.attach(c),T.Instance.animateTransform({mesh:c,end:{position:new n.Vector3(0,0,0),rotation:new n.Euler(0,0,0)},duration:60}),d.userData.selected=c)},c.onPointerDrop=d=>{if(T.Instance.cancelAnimation(c,!0),c.getWorldPosition(new n.Vector3).distanceTo(a.getWorldPosition(new n.Vector3))<.3){e.addVinylByIndex(c.userData.recordIndex),delete e.selected[d.id],d.userData.selected=void 0,a.children.forEach(I=>{I.userData.returnToOriginalPosition&&I.userData.returnToOriginalPosition()}),a.attach(c),T.Instance.animateTransform({mesh:c,end:{position:new n.Vector3(0,.01,0),rotation:new n.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{T.Instance.animateTransform({mesh:c,end:{rotation:new n.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:I=>I,duration:1800,loop:!0})});return}else c.userData.returnToOriginalPosition(),d.userData.selected=void 0},S.add(c)}),D=R.xr.getController(0),D.addEventListener("selectstart",H),D.addEventListener("selectend",K),D.addEventListener("squeezestart",H),D.addEventListener("squeezeend",K),S.add(D),z=R.xr.getController(1),z.addEventListener("selectstart",H),z.addEventListener("selectend",K),z.addEventListener("squeezestart",H),z.addEventListener("squeezeend",K),S.add(z),te=R.xr.getControllerGrip(0);const m=ie({radius:.01,depth:.2,color:16711935});m.name="controllerMesh1",m.rotateX(Math.PI/4),te.add(m),S.add(te),re=R.xr.getControllerGrip(1);const w=ie({radius:.01,depth:.2,color:65280});w.rotateX(Math.PI/4),re.add(w),S.add(re);const x=new n.BufferGeometry().setFromPoints([new n.Vector3(0,0,0),new n.Vector3(0,0,-1)]),v=new n.Line(x);v.name="line",v.scale.z=5,D.add(v.clone()),z.add(v.clone());const E=new n.Group;E.rotation.set(-1*Math.PI/2,0,0),E.position.set(0,-.05,-.12),E.name="target",D.add(E.clone()),z.add(E.clone()),ne=new n.Raycaster,window.addEventListener("resize",Ue,!1),O.Instance.on("progress",h=>{let y="color";h.artist.correctCount>=h[y].correctCount&&(y="artist"),h.title.correctCount>=h[y].correctCount&&(y="title");for(let g=0;g<6;g++){const d=l.getObjectByName(`progress-${g}`);let b=g<h[y].correctCount?ae[y]:0;g<h[y].correctCount&&y==="color"&&(b=X[g]),d&&(d.visible=!0,d.material.color.set(b),d.material.emissive.set(b),d.material.needsUpdate=!0)}const c=Object.keys(h);for(let g=0;g<c.length;g++){const d=c[g],b=l.getObjectByName(`complete-${g}`),I=h[d].solved?ae[d]:0;b&&(b.visible=!0,b.material.color.set(I),b.material.emissive.set(I),b.material.needsUpdate=!0)}}),e.reset()};function Ae(){ce=R.xr.getReferenceSpace();const i={x:-1*_e.x,y:-1*_e.y,z:-1*_e.z,w:1},t=new n.Quaternion,e=new XRRigidTransform(i,t),_=ce.getOffsetReferenceSpace(e);R.xr.setReferenceSpace(_)}function H(i){B=i.target;const t=fe(B);if(t.length>0){let e=!1;t.forEach(({object:_,distance:r})=>{if(e)return;let o=_;for(;o;){if(o.onPointerPick){o.onPointerPick(B),e=!0;const l=B.getObjectByName("line");l.visible=!1;break}o=o.parent}})}B.userData.targetRayMode=i.data.targetRayMode}function K(i){B=i.target;const t=B.userData.selected;t?.onPointerDrop&&t.onPointerDrop(B);const e=B.getObjectByName("line");e.visible=!0}function fe(i){return i.updateMatrixWorld(),ne.setFromXRController(i),ne.intersectObjects(S.children,!0)}function le(i){if(i.userData.targetRayMode==="screen"||i.userData.selected!==void 0)return;const t=i.getObjectByName("line"),e=fe(i);if(t.scale.z=5,e.length>0){let _=!1;e.forEach(({object:r,distance:o})=>{if(_)return;let l=r;for(;l;){if(l.userData.isPickable){t.scale.z=o,_=!0;break}l=l.parent}})}}function Ne(){T.Instance.update(),O.Instance.emit("tick"),le(D),le(z),R.render(S,A)}const Ue=()=>{A.aspect=window.innerWidth/window.innerHeight,A.updateProjectionMatrix(),R.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("playButton");i.onclick=Ge});
