import*as r from"https://js13kgames.com/2025/webxr/three.module.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))n(_);new MutationObserver(_=>{for(const o of _)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(_){const o={};return _.integrity&&(o.integrity=_.integrity),_.referrerPolicy&&(o.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?o.credentials="include":_.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(_){if(_.ep)return;_.ep=!0;const o=e(_);fetch(_.href,o)}})();const he=()=>[["cube_case1_1_8_2_7.50_4_0_0_0_0_7.50_4_0_#0000ff","cube_case2_3_9_2_5.50_4.50_0_0_0_0_5.50_4.50_0_#0000ff","cube_case3_8_4_2_0_7_0_0_0_0_0_8.50_0_#0000ff","cube_case4_8_1_2_0_2.50_0_0_0_0_0_2.50_0_#0000ff","cube_case5_3_9_2_-5.50_4.50_0_0_0_0_-5.50_4.50_0_#0000ff","cube_case6_1_8_2_-7.50_4_0_0_0_0_-7.50_4_0_#0000ff"],"cube_base_12_2.10_2.40_0_0.95_0_0_0_0_0_0_0_#ff0000","cube_rightReel_2_2_1_2.72_3.89_0_0_0_-45_2.72_3.89_0_#ff7300","cube_rightTape_4_4_0.20_2.81_3.91_-0.10_0_0_-45_2.81_3.91_-0.10_#c300ff","cube_leftReel_2_2_1_-2.69_3.91_0_0_0_-45_-2.75_4_0_#ff7300","sphere_dot_1_1_1_0_4_0_0_0_0_0_4_0_#9999ff","plane_label_12_3_0_0_7_1.01_90_0_0_0_7_1.01_#d3d3d3","cylinder_base_16_8_16_0_-4_0_0_0_0_0_-4_0_#00ff00"],pe=()=>[[["cube_complete-0_0.3_0.1_0.1_-0.75_1.05_-0.45_0_0_0_-0.75_1.05_-0.45_#ff0000","cube_complete-1_0.3_0.1_0.1_-0.75_1.05_-0.35_0_0_0_-0.75_1.05_-0.35_#00ff00","cube_complete-2_0.3_0.1_0.1_-0.75_1.05_-0.25_0_0_0_-0.75_1.05_-0.25_#0000ff"],["sphere_progress-0_0.2_0.2_0.2_-0.75_1.05_-0.75_0_0_0_-0.75_1.05_-0.75_#fffb00","sphere_progress-1_0.2_0.2_0.2_-0.55_1.05_-0.75_0_0_0_-0.55_1.05_-0.75_#fffb00","sphere_progress-2_0.2_0.2_0.2_-0.35_1.05_-0.75_0_0_0_-0.35_1.05_-0.75_#fffb00","sphere_progress-3_0.2_0.2_0.2_-0.15_1.05_-0.75_0_0_0_-0.15_1.05_-0.75_#fffb00","sphere_progress-4_0.2_0.2_0.2_0.05_1.05_-0.75_0_0_0_0.05_1.05_-0.75_#fffb00","sphere_progress-5_0.2_0.2_0.2_0.25_1.05_-0.75_0_0_0_0.25_1.05_-0.75_#fffb00"],"cube_desk_2_0.9_1_0_0.45_-0.5_0_0_0_0_-0.1_0_#fffb00","cube_record-rack_0.4_0.1_0.8_0.7_0.95_-0.5_0_0_0_0.7_0.95_-0.5_#b0ffb0","cube_progress-bar_1.3_0.1_0.3_-0.25_0.95_-0.75_0_0_0_-0.25_0.95_-0.75_#d3d3d3","cube_cube_0.3_0.1_0.4_-0.75_0.95_-0.3_0_0_0_-0.75_0.95_-0.3_#9999ff","cube_cube_0.4_0.1_0.4_-0.3_0.95_-0.3_0_0_0_-0.3_0.95_-0.3_#d3d3d3","cube_tableA_0.4_0.1_0.4_0.2_0.95_-0.3_0_0_0_0.2_1.01_-0.3_#b0ffb0","cylinder_pad_0.4_0.02_0.4_0.2_1_-0.3_0_0_0_0.2_1_-0.3_#ff0000"],"cube_cube_22_1_19_0_-2.5_-4.5_0_0_0_0_-3_-4_#ff00ff","cube_cube_12_1_12_0_-1.5_-4_0_0_0_0_-2_-4_#ff0000","cube_cube_8_1_3_0_-0.5_0.5_0_0_0_0_-1_-4_#c300ff","cube_pillar_1_4_1_7.5_0_-2.5_0_0_0_8_0_-3_#fffb00","cube_pillar_1_4_1_7.5_0_-6.5_0_0_0_8_0_-7_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_7.5_0_-10.5_0_0_0_8_0_-11_#fffb00","cube_pillar_1_4_1_-7.5_0_-2.5_0_0_0_-7_0_-3_#fffb00","cube_pillar_1_4_1_-7.5_0_1.5_0_0_0_-7_0_1_#fffb00","cube_pillar_1_4_1_7.5_0_1.5_0_0_0_8_0_1_#fffb00","cube_pillar_1_4_1_-7.5_0_-6.5_0_0_0_-7_0_-7_#fffb00","cube_pillar_1_4_1_-7.5_0_-10.5_0_0_0_-7_0_-11_#fffb00","cube_cube_4_1_16_9_2.5_-6_0_0_0_8_2_0_#00ff00","cube_cube_4_1_16_-9_2.5_-6_0_0_0_-10_2_0_#00ff00"],ge=()=>["sphere_head_16_16_16_0_8_0_0_0_0_0_8_0_#c300ff",["cylinder_leftEye_4_1_4_-3_11_-6.3_-60_0_25_-3_11_-6.3_#fffb00","sphere_leftPupil_2_2_4_-3.6_11.3_-7_-60_0_25_-3.6_11.3_-7_#c300ff","cylinder_rightEye_4_1_4_3_11_-6.3_-60_0_-25_3_11_-6.3_#fffb00","sphere_rightPupil_2_2_4_3.4_11.3_-7_-60_0_-25_3.4_11.3_-7_#c300ff"],["cube_rightCheek_3_3_2_1.84_6.53_-7.5_-25_0_80_1.84_6.53_-7.5_#0000ff","cube_leftCheek_3_3_2_-1.91_6.48_-7.5_0_23_10_-1.91_6.48_-7.5_#0000ff","cube_tongue_2_2_2_0_5_-7_0_0_0_0_4_-7_#ff0000","pyramid_pyramid_3_1.6_1_0_8.2_-8_-180_0_0_0_8.2_-8_#ff00ff"],["pyramid_ear_6_11_4_-4.86_15.55_-1.28_-14_-6_24_-4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_-5.04_15.94_-1.59_-14_-6_24_-5.04_15.94_-1.59_#fffb00","pyramid_ear_6_11_4_4.86_15.55_-1.28_-14_6_-24_4.86_15.55_-1.28_#c300ff","pyramid_ear_5_9.5_4_5.04_15.94_-1.59_-14_6_-24_5.04_15.94_-1.59_#fffb00"],["cylinder_cylinder_0.2_6_0.2_-3.93_6_-8.92_0_-15_90_-3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_7.52_-8.5_0_-15_75_-4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_-4.87_4.48_-8.5_0_-15_105_-4.87_4.48_-8.5_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_7.52_-8.5_180_-15_-105_4.87_7.52_-8.5_#d3d3d3","cylinder_cylinder_0.2_6_0.2_3.93_6_-8.92_0_-165_90_3.93_6_-8.92_#d3d3d3","cylinder_cylinder_0.2_4_0.2_4.87_4.48_-8.5_180_-15_-75_4.87_4.48_-8.5_#d3d3d3"]],be=()=>["cylinder_cylinder_4_6_2_0_-1_0_0_0_0_0_-1_0_#c300ff","sphere_sphere_4_4_2_0_2_0_0_0_0_0_2_0_#c300ff","cube_cube_0.3_1_0.3_-1.15_3.5_-0.55_-77_0_0_-1.15_3.5_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_-0.45_3.9_-0.55_-77_0_0_-0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_0.45_3.9_-0.55_-77_0_0_0.45_3.9_-0.55_#d3d3d3","cube_cube_0.3_1_0.3_1.05_3.6_-0.55_-77_0_0_1.05_3.6_-0.55_#d3d3d3","cube_cube_2_0.7_0.4_0_1.85_-0.9_0_0_0_0_1.5_-0.1_#ff0000","cube_cube_0.8_0.5_1.1_0_2.45_-0.55_0_0_0_0_2.2_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-1.15_2.7_-0.8_0_0_0_-1.15_2.7_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_-0.45_3.1_-0.8_0_0_0_-0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_0.45_3.1_-0.8_0_0_0_0.45_3.1_-0.1_#ff0000","cube_cube_0.3_0.6_0.6_1.05_2.7_-0.8_0_0_0_1.05_2.7_-0.1_#ff0000"],J={uniforms:{uDirLightPos:{value:new r.Vector3},uDirLightColor:{value:new r.Color(15658734)},uAmbientLightColor:{value:new r.Color(328965)},uBaseColor:{value:new r.Color(16777215)},uLineColor1:{value:new r.Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},Z=s=>{const t=new r.Group;t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1);const e=a=>{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_"),g=Math.sqrt(d*d+d*d)/2,x=new r.CylinderGeometry(0,g,h,4,1,!1,Math.PI/4);return x.scale(1,1,f/d),x.translate(l-R,y-w+.3*h,b-I),x.rotateX(r.MathUtils.degToRad(p)),x.rotateY(r.MathUtils.degToRad(m)),x.rotateZ(r.MathUtils.degToRad(E)),x},n=a=>{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_"),g=new r.BoxGeometry(d,h,f);return g.translate(l-R,y-w,b-I),g.rotateX(r.MathUtils.degToRad(p)),g.rotateY(r.MathUtils.degToRad(m)),g.rotateZ(r.MathUtils.degToRad(E)),g},_=a=>{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_"),g=new r.SphereGeometry(parseFloat(d)/2,32,16);return g.scale(d/d,h/d,f/d),g.translate(l-R,y-w,b-I),g.rotateX(r.MathUtils.degToRad(p)),g.rotateY(r.MathUtils.degToRad(m)),g.rotateZ(r.MathUtils.degToRad(E)),g},o=a=>{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_"),g=new r.PlaneGeometry(d,h);return g.rotateX(r.MathUtils.degToRad(-90)),g.translate(l-R,y-w,b-I),g.rotateX(r.MathUtils.degToRad(p)),g.rotateY(r.MathUtils.degToRad(m)),g.rotateZ(r.MathUtils.degToRad(E)),g},c=a=>{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_"),g=d/2,x=new r.CylinderGeometry(g,g,h,32);x.translate(l-R,y-w,b-I),x.scale(1,1,f/d);const T=r.MathUtils.degToRad(p),H=r.MathUtils.degToRad(m),v=r.MathUtils.degToRad(E),G=new r.Euler(T,H,v);return x.applyQuaternion(new r.Quaternion().setFromEuler(G)),x};return s.forEach(a=>{if(a===null){console.error("ITEM IS NULL");return}if(Array.isArray(a))t.add(Z(a));else{const[u,i,d,h,f,l,y,b,p,m,E,R,w,I,D]=a.split("_");let g=null;switch(u){case"cube":g=n(a);break;case"sphere":g=_(a);break;case"plane":g=o(a);break;case"cylinder":g=c(a);break;case"pyramid":g=e(a);break;default:throw new Error(`Unknown shape: ${u}`)}let x=null;i.startsWith("case")?x=new r.ShaderMaterial({uniforms:{...J.uniforms},vertexShader:J.vertexShader,fragmentShader:J.fragmentShader}):x=new r.MeshStandardMaterial({color:D,side:r.DoubleSide});const T=new r.Mesh(g,x);T.name=i,T.position.set(R,w,I),t.add(T)}}),t},q=s=>{if(s==="cassette"){const t=Z(he());return t.name="cassette",t}else if(s==="arena"){const t=Z(pe());return t.name="arena",t}else if(s==="cat"){const t=Z(ge());return t.name="cat",t}else if(s==="paw"){const t=Z(be());return t.name="paw",t.scale.set(.03125,.03125,.03125),t}return null};class O{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return O._instance||(O._instance=new O),O._instance}on(t,e){this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e)}off(t,e){this.callbacks[t]=(this.callbacks[t]||[]).filter(n=>n!==e)}emit(t,...e){(this.callbacks[t]||[]).forEach(n=>n(...e))}_reset(){Object.keys(this.callbacks).forEach(t=>{delete this.callbacks[t]})}getCallbacks(){return this.callbacks}}const ce="#e81416",ye="#ffa500",me="#faeb36",ne="#79c314",re="#487de7",we="#70369d",Q="#000000",X=[ce,ye,me,ne,re,we],j=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],F=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],xe=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]];class ve{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset()}addVinylByIndex(t){const{color:e,artist:n,title:_}=this.vinyls[t],o=X.indexOf(e),c=j.indexOf(n),a=F.indexOf(_);o===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===X.length&&(this.progress.color.solved=!0)):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),this.progress.color.currentIndex=o,c===(this.progress.artist.currentIndex+1)%j.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===j.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=c,a===(this.progress.title.currentIndex+1)%F.length?(this.progress.title.correctCount++,this.progress.title.correctCount===F.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=a,O.Instance.emit("progress",this.progress),O.Instance.emit("debug",JSON.stringify(this.progress))}isSolved(t){return this.progress[t].solved}reset(){this.queue=[],this.selected={};const[t,e,n]=xe;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-1,correctCount:0,solved:!1},title:{currentIndex:-1,correctCount:0,solved:!1}},this.vinyls=X.map((_,o)=>({index:o,color:X[t[o]],artist:j[e[o]],title:F[n[o]]})),t.forEach((_,o)=>{this.vinyls[_].color=X[o]}),e.forEach((_,o)=>{this.vinyls[_].artist=j[o]}),n.forEach((_,o)=>{this.vinyls[_].title=F[o]}),O.Instance.emit("progress",this.progress)}}class W{static createButton(t,e={}){const n=document.createElement("button");function _(){let i=null;async function d(l){l.addEventListener("end",h),await t.xr.setSession(l),n.textContent="EXIT VR",i=l}function h(){i.removeEventListener("end",h),n.textContent="ENTER VR",i=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";const f={...e,optionalFeatures:["local-floor","bounded-floor","layers",...e.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){i===null?navigator.xr.requestSession("immersive-vr",f).then(d):(i.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",f).then(d).catch(l=>{console.warn(l)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",f).then(d).catch(l=>{console.warn(l)})}function o(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function c(){o(),n.textContent="VR NOT SUPPORTED"}function a(i){o(),console.warn("Exception when trying to call xr.isSessionSupported",i),n.textContent="VR NOT ALLOWED"}function u(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",u(n),navigator.xr.isSessionSupported("immersive-vr").then(function(i){i?_():c(),i&&W.xrSessionIsGranted&&n.click()}).catch(a),n;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",u(i),i}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{W.xrSessionIsGranted=!0})}}}W.xrSessionIsGranted=!1;W.registerSessionGrantedListener();const Se=.3,L=44100,ee=new(window.AudioContext||window.webkitAudioContext),Ee=(s=1,t=.05,e=220,n=0,_=0,o=.1,c=0,a=1,u=0,i=0,d=0,h=0,f=0,l=0,y=0,b=0,p=0,m=1,E=0,R=0)=>{let w=2*Math.PI,I=u*=500*w/L**2,D=(0<y?1:-1)*w/4,g=e*=(1+2*t*Math.random()-t)*w/L,x=[],T=0,H=0,v=0,G=1,fe=0,ue=0,z=0,V,U;for(n=99+L*n,E*=L,_*=L,o*=L,p*=L,i*=500*w/L**3,y*=w/L,d*=w/L,h*=L,f=L*f|0,U=n+E+_+o+p|0;v<U;x[v++]=z)++ue%(100*b|0)||(z=c?1<c?2<c?3<c?Math.sin((T%w)**3):Math.max(Math.min(Math.tan(T),1),-1):1-(2*T/w%2+2)%2:1-4*Math.abs(Math.round(T/w)-T/w):Math.sin(T),z=(f?1-R+R*Math.sin(2*Math.PI*v/f):1)*(0<z?1:-1)*Math.abs(z)**a*s*Se*(v<n?v/n:v<n+E?1-(v-n)/E*(1-m):v<n+E+_?m:v<U-p?(U-v-p)/o*m:0),z=p?z/2+(p>v?0:(v<U-p?1:(U-v)/p)*x[v-p|0]/2):z),V=(e+=u+=i)*Math.sin(H*y-D),T+=V-V*l*(1-1e9*(Math.sin(v)+1)%2),H+=V-V*l*(1-1e9*(Math.sin(v)**2+1)%2),G&&++G>h&&(e+=d,g+=d,G=0),!f||++fe%f||(e=g,u=I,G=G||1);return x},Me=(...s)=>{let t=ee.createBufferSource(),e=ee.createBuffer(s.length,s[0].length,L);return s.map((n,_)=>e.getChannelData(_).set(n)),t.buffer=e,t.connect(ee.destination),t.start(),t},Ce=(...s)=>Me(Ee(...s)),Re=()=>Ce(1.01,void 0,275,.01,.01,.15,1,1.03,-3.7,void 0,-93,.07,void 0,void 0,void 0,-.1,void 0,.5,.04,.09);let Ie=0;const Te=(s,t)=>{const e=new r.Group;e.name=`Witch${++Ie}`;const n=[],_=q("cat");_.scale.set(.03,.03,.03),e.add(_),_.position.set(0,-.25,-.05);const o=()=>{if(t.xr?.getCamera()&&t.xr?.getCamera()){const c=t.xr?.getCamera();if(n.push(c.quaternion.clone()),n.length>60){let a=n.shift();const u=new r.Quaternion().setFromEuler(new r.Euler(0,Math.PI,0));a&&e.quaternion.copy(u.multiply(a))}}};return O.Instance.on("tick",o),e.userData.isPickable=!0,e.onPointerPick=()=>{Re()},s.add(e),e},Le=(s,t,e)=>Math.min(Math.max(s,t),e),le=(s=512)=>{const t=document.createElement("canvas");t.width=s,t.height=s;const e=t.getContext("2d");return[t,e]},P=.0254,Oe=(s,t)=>{const[n,_]=le(1024);_.fillStyle=Q,_.strokeStyle=Q,_.lineWidth=8,_.beginPath(),_.arc(1024/2,1024/2,20,0,2*Math.PI),_.stroke(),_.beginPath(),_.arc(1024/2,1024/2,288,0,2*Math.PI),_.stroke(),_.textAlign="center",s&&(_.font="64px monospace",_.textBaseline="middle",_.strokeStyle=Q,_.lineWidth=8,_.strokeText(s,.5*1024,.42*1024),_.fillStyle=ne,_.fillText(s,.5*1024,.42*1024)),t&&(_.font="96px monospace",_.textBaseline="bottom",_.fillStyle=re,_.strokeText(t,.5*1024,.68*1024),_.fillText(t,.5*1024,.68*1024));const o=new r.CanvasTexture(n);return o.encoding=r.LinearSRGBColorSpace,new r.MeshBasicMaterial({map:o,transparent:!0})},Pe=({color:s,artist:t,title:e})=>{const n=new r.Group,_=new r.RingGeometry(4,7,32);_.scale(P,P,P);const o=new r.MeshPhongMaterial({color:s,side:r.DoubleSide,emissive:0,specular:1118481,shininess:50});n.add(new r.Mesh(_,o));const c=new r.RingGeometry(.25,4,32);c.scale(P,P,P);const a=new r.MeshStandardMaterial({color:16777215,side:r.DoubleSide});n.add(new r.Mesh(c,a));const u=new r.PlaneGeometry(14,14);u.translate(0,0,.001),u.scale(P,P,P);const i=Oe(t,e);n.add(new r.Mesh(u,i));const d=n.clone();return d.rotation.set(0,Math.PI,0),d.position.set(0,0,-.002),n.add(d),n},ke=s=>s*s;class C{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new r.Clock}static get Instance(){return C._instance||(C._instance=new C),C._instance}initScene(t){this.scene||(this.scene=t,this.clock.start())}update(){const t=this.clock.getElapsedTime()*1e3;this.animations=this.animations.filter(e=>{const n=t-e.startTime,_=e.endTime-e.startTime,o=Le(n/_,0,1);if(t>=e.endTime)return e.loop?(e.startTime=t,e.endTime=t+_,e.end.position&&e.mesh.position.copy(e.start.position),e.end.rotation&&e.mesh.rotation.copy(e.start.rotation),e.end.scaling&&e.mesh.scale.copy(e.start.scaling),!0):(e.end.position&&e.mesh.position.copy(e.end.position),e.end.rotation&&e.mesh.rotation.copy(e.end.rotation),e.end.scaling&&e.mesh.scale.copy(e.end.scaling),e.resolve&&(e.resolve(),e.resolve=void 0,e.reject=void 0),!1);if(e.end.position&&e.mesh.position.lerpVectors(e.start.position,e.end.position,e.easeFunc(o)),e.end.rotation){const c=e.start.rotation,a=e.end.rotation,u=new r.Euler;u.x=c.x+(a.x-c.x)*e.easeFunc(o),u.y=c.y+(a.y-c.y)*e.easeFunc(o),u.z=c.z+(a.z-c.z)*e.easeFunc(o),e.mesh.rotation.copy(u)}return e.end.scaling&&e.mesh.scale.lerpVectors(e.start.scaling,e.end.scaling,e.easeFunc(o)),!0})}animateTransform(t){const{mesh:e,end:n}=t,_=t.duration||1e3,o=t.delay||0,c=t.ease||ke,a=this.clock.getElapsedTime()*1e3;let u,i;const d=new Promise((h,f)=>{u=h,i=f});return this.animations.push({mesh:e,start:{position:e.position.clone(),rotation:e.rotation.clone(),scaling:e.scale.clone()},end:n,easeFunc:c,startTime:a+o,endTime:a+o+_,loop:t.loop||!1,resolve:u,reject:i}),d}cancelAnimation(t,e=!1){const n=this.animations.filter(_=>_.mesh===t);n.length&&(n.forEach(_=>{e&&(_.end.position&&t.position.copy(_.end.position),_.end.rotation&&t.rotation.copy(_.end.rotation),_.end.scaling&&t.scale.copy(_.end.scaling)),_.reject&&(_.reject(),_.resolve=void 0,_.reject=void 0)}),this.animations=this.animations.filter(_=>_.mesh!==t))}}const De=()=>{const s=new r.Group;s.name="debugScreen",s.renderOrder=1;const t=["You win!","Thanks for playing","Created by Alex Swan"],e=new r.PlaneGeometry(5,5);e.translate(0,-2,0);const[n,_]=le(1024),o=new r.CanvasTexture(n);o.encoding=r.LinearSRGBColorSpace;const c=new r.MeshBasicMaterial({map:o,transparent:!0}),a=new r.Mesh(e,c);s.add(a),a.position.set(0,0,0);const u=()=>{if(!a.userData.solved)return;_.clearRect(0,0,n.width,n.height),_.globalAlpha=.5,_.fillStyle="black",_.fillRect(0,0,n.width,n.height*.2),_.globalAlpha=1;const i=64;_.fillStyle="white",_.textBaseline="top",_.textAlign="center",_.font=`${i}px monospace`,t.forEach((d,h)=>{_.fillText(d,n.width/2,i*h)}),o.needsUpdate=!0};return O.Instance.on("progress",i=>{i.color.solved&&i.artist.solved&&i.title.solved&&(a.userData.solved=!0),u()}),s},oe={color:ce,artist:ne,title:re};let A,S,_e,M,k,B,N,Y,se;const te=new r.Vector3(0,0,.3),ze=async()=>{document.getElementById("intro").style.display="none";const t=document.getElementById("c");if(!t)return;t.style.display="block",M=new r.WebGLRenderer({antialias:!0}),M.setPixelRatio(window.devicePixelRatio),M.setSize(window.innerWidth,window.innerHeight),M.setClearColor("#000000"),M.xr.addEventListener("sessionstart",Be),M.xr.enabled=!0,M.setAnimationLoop(Ne),document.body.appendChild(W.createButton(M)),document.body.appendChild(M.domElement);const e=new ve;S=new r.Scene,A=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),A.position.set(0,2,1),A.rotation.set(-1*Math.PI/12,0,0),A.name="camera",S.add(A),C.Instance.initScene(S);const n=new r.AmbientLight(16777215,.8);S.add(n);const _=new r.DirectionalLight(16777215,.8);_.position.set(6,10,8),_.castShadow=!0,_.target.position.set(0,0,0),S.add(_),S.add(_.target);const o=De();o.position.set(0,1.5,-1),S.add(o),Y=q("cassette"),Y.position.set(0,0,-20),Y.userData.isPickable=!0,S.add(Y),C.Instance.animateTransform({mesh:Y,end:{rotation:new r.Euler(0,2*Math.PI-.01,0)},duration:3e3,ease:h=>h,loop:!0});const c=q("arena"),a=c.getObjectByName("tableA");S.add(c);const u=q("cat");u.position.set(-3,1,0),u.scale.set(.1,.1,.1),S.add(u);const i=u.clone(!0);i.name="catMesh2",i.position.set(3,1,-1),i.rotation.set(0,Math.PI/2,0),S.add(i);const d=Te(S,M);d.position.set(0,1.5,-1),d.rotation.set(0,Math.PI,0),e.vinyls.forEach((h,f)=>{const l=Pe(h);l.name=`vinyl-${f}`;const y=new r.Vector3(.7,1.15,-.2-.125*f);l.position.copy(y),l.userData.originalPosition=y,l.userData.isPickable=!0,l.userData.recordIndex=f,l.userData.returnToOriginalPosition=()=>{S.attach(l),C.Instance.cancelAnimation(l),C.Instance.animateTransform({mesh:l,end:{position:l.userData.originalPosition,rotation:new r.Euler(0,0,0)},duration:100})},l.onPointerPick=b=>{if(b.userData.selected)return;e.selected[b.id]=f;const p=b.getObjectByName("target");p&&(C.Instance.cancelAnimation(l),p.attach(l),C.Instance.animateTransform({mesh:l,end:{position:new r.Vector3(0,0,0),rotation:new r.Euler(0,Math.PI/2,0)},duration:60}),b.userData.selected=l)},l.onPointerDrop=b=>{if(C.Instance.cancelAnimation(l,!0),l.getWorldPosition(new r.Vector3).distanceTo(a.getWorldPosition(new r.Vector3))<.3){e.addVinylByIndex(l.userData.recordIndex),delete e.selected[b.id],b.userData.selected=void 0,a.children.forEach(m=>{m.userData.returnToOriginalPosition&&m.userData.returnToOriginalPosition()}),a.attach(l),C.Instance.animateTransform({mesh:l,end:{position:new r.Vector3(0,.01,0),rotation:new r.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{C.Instance.animateTransform({mesh:l,end:{rotation:new r.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:m=>m,duration:1800,loop:!0})});return}else l.userData.returnToOriginalPosition(),b.userData.selected=void 0},S.add(l)}),B=M.xr.getController(0),B.addEventListener("connected",ie),B.addEventListener("selectstart",K),B.addEventListener("selectend",$),B.addEventListener("squeezestart",K),B.addEventListener("squeezeend",$),S.add(B),N=M.xr.getController(1),N.addEventListener("connected",ie),N.addEventListener("selectstart",K),N.addEventListener("selectend",$),N.addEventListener("squeezestart",K),N.addEventListener("squeezeend",$),S.add(N),_e=new r.Raycaster,window.addEventListener("resize",Ae,!1),O.Instance.on("progress",h=>{let f="color";h.artist.correctCount>=h[f].correctCount&&(f="artist"),h.title.correctCount>=h[f].correctCount&&(f="title");for(let y=0;y<6;y++){const b=c.getObjectByName(`progress-${y}`);let p=y<h[f].correctCount?oe[f]:0;y<h[f].correctCount&&f==="color"&&(p=X[y]),b&&(b.visible=!0,b.material.color.set(p),b.material.emissive.set(p),b.material.needsUpdate=!0)}const l=Object.keys(h);for(let y=0;y<l.length;y++){const b=l[y],p=c.getObjectByName(`complete-${y}`),m=h[b].solved?oe[b]:0;p&&(p.visible=!0,p.material.color.set(m),p.material.emissive.set(m),p.material.needsUpdate=!0)}}),e.reset()};function Be(){se=M.xr.getReferenceSpace();const s={x:-1*te.x,y:-1*te.y,z:-1*te.z,w:1},t=new r.Quaternion,e=new XRRigidTransform(s,t),n=se.getOffsetReferenceSpace(e);M.xr.setReferenceSpace(n)}function ie(s){console.log("controller connected",s);const t=s.target,e=s.data.handedness==="left"?-1:1,n=s.data.hand?0:e*Math.PI/2;if(O.Instance.emit("debug",`Hand: ${s.data.hand}`),!t.getObjectByName("target")){const a=new r.Group;a.name="target",a.rotation.set(0,0,0),a.position.set(-1*e*.035,.05,-.12),t.add(a)}let o=t.getObjectByName("paw");o||(o=q("paw"),o.position.set(0,0,.15),o.rotation.set(3*Math.PI/2,n,0),t.add(o.clone(!0)));let c=t.getObjectByName("line");if(!c){const a=new r.BufferGeometry().setFromPoints([new r.Vector3(0,0,0),new r.Vector3(0,0,-1)]);c=new r.Line(a),c.material.color.set(16711680),c.name="line",c.scale.z=5,t.add(c)}}function K(s){k=s.target;const t=de(k);if(t.length>0){let e=!1;t.forEach(({object:n,distance:_})=>{if(e)return;let o=n;for(;o;){if(o.onPointerPick){o.onPointerPick(k),e=!0;const c=k.getObjectByName("line");c.visible=!1;break}o=o.parent}})}k.userData.targetRayMode=s.data.targetRayMode}function $(s){k=s.target;const t=k.userData.selected;t?.onPointerDrop&&t.onPointerDrop(k);const e=k.getObjectByName("line");e.visible=!0}function de(s){return s.updateMatrixWorld(),_e.setFromXRController(s),_e.intersectObjects(S.children,!0)}function ae(s){if(s.userData.targetRayMode==="screen"||s.userData.selected!==void 0)return;const t=s.getObjectByName("line"),e=de(s);if(t&&(t.scale.z=5),e.length>0){let n=!1;e.forEach(({object:_,distance:o})=>{if(n)return;let c=_;for(;c;){if(c.userData.isPickable){t&&(t.scale.z=o),n=!0;break}c=c.parent}})}}function Ne(){C.Instance.update(),O.Instance.emit("tick"),ae(B),ae(N),M.render(S,A)}const Ae=()=>{A.aspect=window.innerWidth/window.innerHeight,A.updateProjectionMatrix(),M.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("playButton");s.onclick=ze});
