import*as e from"https://js13kgames.com/2025/webxr/three.module.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return t._instance||(t._instance=new t),t._instance}on(e,t){this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(t)}off(e,t){this.callbacks[e]=(this.callbacks[e]||[]).filter(e=>e!==t)}emit(e,...t){(this.callbacks[e]||[]).forEach(e=>e(...t))}_reset(){Object.keys(this.callbacks).forEach(e=>{delete this.callbacks[e]})}getCallbacks(){return this.callbacks}}const n="#e81416",r="#ffa500",s="#faeb36",o="#79c314",i="#487de7",a="#70369d",c="#ffffff",l="#000000",d="#abb7d0",u="#ff3b94",h="#8ea5ff",p="#333333",m={color:n,artist:o,title:i},f=[n,r,s,o,i,a],g=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],y=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],w={color:f,artist:g,title:y},b={color:0,artist:24,title:34},v=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]],M=["color","artist","title"];class x{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset(),this.progress.bestComboType="color"}addVinylByIndex(e){if(this.queue[0]===e)return;const{color:n,artist:r,title:s}=this.vinyls[e],o=f.indexOf(n),i=g.indexOf(r),a=y.indexOf(s);o===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===f.length&&(this.progress.color.solved=!0),this.progress.color.currentIndex=o):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),i===(this.progress.artist.currentIndex+1)%g.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===g.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=i,a===(this.progress.title.currentIndex+1)%y.length?(this.progress.title.correctCount++,this.progress.title.correctCount===y.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=a;const c=Math.max(this.progress.color.correctCount,this.progress.artist.correctCount,this.progress.title.correctCount);this.progress.bestComboCount<6&&c<this.progress.bestComboCount&&t.Instance.emit("comboBroken"),this.progress.bestComboCount=c,this.progress.bestComboType=this.progress.color.correctCount===this.progress.bestComboCount?"color":this.progress.artist.correctCount===this.progress.bestComboCount?"artist":"title",this.queue.unshift(e),this.progress.displayText=this.getDisplayText(),t.Instance.emit("progress",this.progress)}getVinylInQueue(e){return this.vinyls[this.queue[e]]}isSolved(e){return this.progress[e].solved}getDisplayText(){let e="";const{currentIndex:t,correctCount:n,solved:r}=this.progress[this.progress.bestComboType],s=w[this.progress.bestComboType];for(let o=0;o<n;o++){let n=t-o;n<0&&(n+=s.length),e=`${s[n]}â†’${e}`}return e}reset(){this.queue=[],this.selected={};const[e,n,r]=v;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-2,correctCount:0,solved:!1},title:{currentIndex:-2,correctCount:0,solved:!1},bestComboType:"color",bestComboCount:0},this.vinyls=f.map((e,t)=>({index:t,color:e,artist:"",title:""})),e.forEach((e,t)=>{this.vinyls[e].color=f[t]}),n.forEach((e,t)=>{this.vinyls[e].artist=g[t]}),r.forEach((e,t)=>{this.vinyls[e].title=y[t]}),t.Instance.emit("progress",this.progress)}}class C{static createButton(e,t={}){const n=document.createElement("button");function r(){n.style.display="block",n.setAttribute("data-disabled","true"),n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}if("xr"in navigator)return n.id="VRButton",n.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(function(s){s?function(){let r=null;async function s(t){t.addEventListener("end",o),await e.xr.setSession(t),n.textContent="EXIT VR",r=t}function o(){r.removeEventListener("end",o),n.textContent="ENTER VR",r=null}n.style.display="block",n.removeAttribute("data-disabled"),n.textContent="ENTER VR";const i={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onclick=function(){null===r?navigator.xr.requestSession("immersive-vr",i).then(s):(r.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",i).then(s).catch(e=>{}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",i).then(s).catch(e=>{})}():(r(),n.textContent="VR NOT SUPPORTED"),s&&C.xrSessionIsGranted&&n.click()}).catch(function(e){r(),n.textContent="VR NOT ALLOWED"}),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.className="webxr-message",e}}static registerSessionGrantedListener(){if("undefined"!=typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{C.xrSessionIsGranted=!0})}}}C.xrSessionIsGranted=!1,C.registerSessionGrantedListener();const I=.0254,P=(e=1024,t=1024)=>{const n=document.createElement("canvas");n.width=e,n.height=t;const r=n.getContext("2d");return[n,r]},E=(t,n,r)=>{const s=new e.Vector3(1,0,0),o=new e.Euler(0,t,-Math.PI/2+n);return s.applyEuler(o).normalize().multiplyScalar(r)},S=e=>parseFloat(`${e||0}`),T={},B=new e.Color,k=(t,n)=>{const r=1==n?.glow,s=`color-${t}-${r}`;if(T[s])return T[s];const o=new(r?e.MeshBasicMaterial:e.MeshStandardMaterial)({color:t,side:e.FrontSide});return T[s]=o,o},R=(t,n)=>{const{color:r,bgColor:s,textAlign:o,ratio:i,fontSize:a}=n;B.set(r);const c="string"==typeof r?r:`#${B.getHexString()}`,d=`text-${c}-${t.join("")}`;if(T[d])return T[d];const u=1024,h=i?u/i:u,[p,m]=P(u,h);m.textAlign=o||"center";let f=16;"center"===m.textAlign&&(f=512),t.forEach((e,t)=>{const n=void 0!==a?a:64;m.strokeStyle=l,m.font=`${n}px monospace`,m.textBaseline="top",m.lineWidth=8,m.strokeText(e,f,16+n*t),m.fillStyle=c,m.fillText(e,f,16+n*t)});const g=new e.CanvasTexture(p),y=new e.MeshBasicMaterial({map:g,transparent:!0});return T[d]=y,y},D=e=>e*e,A=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;class L{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new e.Clock}static get Instance(){return L._instance||(L._instance=new L),L._instance}initScene(e){this.scene||(this.scene=e,this.clock.start())}update(){const t=1e3*this.clock.getElapsedTime();this.animations=this.animations.filter(n=>{const r=t-n.startTime,s=n.endTime-n.startTime,o=e.MathUtils.clamp(r/s,0,1);if(t>=n.endTime)return n.loop?(n.startTime=t,n.endTime=t+s,n.end.position&&n.mesh.position.copy(n.start.position),n.end.rotation&&n.mesh.rotation.copy(n.start.rotation),n.end.scaling&&n.mesh.scale.copy(n.start.scaling),!0):(n.end.position&&n.mesh.position.copy(n.end.position),n.end.rotation&&n.mesh.rotation.copy(n.end.rotation),n.end.scaling&&n.mesh.scale.copy(n.end.scaling),n.resolve&&(n.resolve(),n.resolve=void 0,n.reject=void 0),!1);if(n.end.position&&n.mesh.position.lerpVectors(n.start.position,n.end.position,n.easeFunc(o)),n.end.rotation){const t=n.start.rotation,r=n.end.rotation,s=new e.Euler;s.order=t.order||e.Euler.DefaultOrder,s.x=t.x+(r.x-t.x)*n.easeFunc(o),s.y=t.y+(r.y-t.y)*n.easeFunc(o),s.z=t.z+(r.z-t.z)*n.easeFunc(o),n.mesh.rotation.copy(s)}return n.end.scaling&&n.mesh.scale.lerpVectors(n.start.scaling,n.end.scaling,n.easeFunc(o)),!0})}animateTransform(e){const{mesh:t,end:n}=e,r=e.duration||1e3,s=e.delay||0,o=e.ease||D,i=1e3*this.clock.getElapsedTime();let a,c;const l=new Promise((e,t)=>{a=e,c=t});return this.animations.push({mesh:t,start:{position:t.position.clone(),rotation:t.rotation.clone(),scaling:t.scale.clone()},end:n,easeFunc:o,startTime:i+s,endTime:i+s+r,loop:e.loop||!1,resolve:a,reject:c}),l}cancelAnimation(e,t=!1){const n=this.animations.filter(t=>t.mesh===e);n.length&&(n.forEach(n=>{t&&(n.end.position&&e.position.copy(n.end.position),n.end.rotation&&e.rotation.copy(n.end.rotation),n.end.scaling&&e.scale.copy(n.end.scaling)),n.reject&&(n.reject(),n.resolve=void 0,n.reject=void 0)}),this.animations=this.animations.filter(t=>t.mesh!==e))}}class O{constructor(){this.mOscillators=[this.osc_sin.bind(this),this.osc_square.bind(this),this.osc_saw.bind(this),this.osc_tri.bind(this)],this.mSong=null,this.mLastRow=0,this.mCurrentCol=0,this.mNumWords=0,this.mMixBuf=null}osc_sin(e){return Math.sin(6.283184*e)}osc_saw(e){return e%1*2-1}osc_square(e){return e%1<.5?1:-1}osc_tri(e){var t=e%1*4;return t<2?t-1:3-t}getnotefreq(e){return.003959503758*2**((e-128)/12)}createNote(e,t,n){var r,s,o,i,a,c,l=this.mOscillators[e.i[0]],d=e.i[1],u=e.i[3]/32,h=this.mOscillators[e.i[4]],p=e.i[5],m=e.i[8]/32,f=e.i[9],g=e.i[10]*e.i[10]*4,y=e.i[11]*e.i[11]*4,w=e.i[12]*e.i[12]*4,b=1/w,v=-e.i[13]/16,M=e.i[14],x=n*2**(2-e.i[15]),C=new Int32Array(g+y+w),I=0,P=0;for(r=0,s=0;r<g+y+w;r++,s++)s>=0&&(M=M>>8|(255&M)<<4,s-=x,a=this.getnotefreq(t+(15&M)+e.i[2]-128),c=this.getnotefreq(t+(15&M)+e.i[6]-128)*(1+8e-4*e.i[7])),o=1,r<g?o=r/g:r>=g+y&&(o=(1-(o=(r-g-y)*b))*3**(v*o)),i=l(I+=a*o**u)*d,i+=h(P+=c*o**m)*p,f&&(i+=(2*Math.random()-1)*f),C[r]=80*i*o|0;return C}async init(e){return new Promise(t=>{this.mSong=e,this.mLastRow=e.endPattern,this.mCurrentCol=0,this.mNumWords=e.rowLen*e.patternLen*(this.mLastRow+1)*2,this.mMixBuf=new Int32Array(this.mNumWords),t()})}generateChannel(e){return new Promise(t=>{var n,r,s,o,i,a,c,l,d,u,h,p,m,f,g=new Int32Array(this.mNumWords),y=this.mSong.songData[e],w=this.mSong.rowLen,b=this.mSong.patternLen,v=0,M=0,x=!1,C=[];for(s=0;s<=this.mLastRow;++s)for(c=y.p[s],o=0;o<b;++o){var I=c?y.c[c-1].f[o]:0;I&&(y.i[I-1]=y.c[c-1].f[o+b]||0,I<17&&(C=[]));var P=this.mOscillators[y.i[16]],E=y.i[17]/512,S=2**(y.i[18]-9)/w,T=y.i[19],B=y.i[20],k=43.23529*y.i[21]*3.141592/44100,R=1-y.i[22]/255,D=1e-5*y.i[23],A=y.i[24]/32,L=y.i[25]/512,O=6.283184*2**(y.i[26]-9)/w,G=y.i[27]/255,N=y.i[28]*w&-2;for(h=(s*b+o)*w,i=0;i<4;++i)if(a=c?y.c[c-1].n[o+i*b]:0){C[a]||(C[a]=this.createNote(y,a,w));var V=C[a];for(r=0,n=2*h;r<V.length;r++,n+=2)g[n]+=V[r]}for(r=0;r<w;r++)(u=g[l=2*(h+r)])||x?(p=k,T&&(p*=P(S*l)*E+.5),M+=(p=1.5*Math.sin(p))*(m=R*(u-M)-(v+=p*M)),u=3==B?M:1==B?m:v,D&&(u=(u*=D)<1?u>-1?this.osc_sin(.25*u):-1:1,u/=D),x=(u*=A)*u>1e-5,f=u*(1-(d=Math.sin(O*l)*L+.5)),u*=d):f=0,l>=N&&(f+=g[l-N+1]*G,u+=g[l-N]*G),g[l]=0|f,g[l+1]=0|u,this.mMixBuf[l]+=0|f,this.mMixBuf[l+1]+=0|u}t()})}async generate(){this.mMixBuf.fill(0),this.mCurrentCol=0;const e=[];for(let t=0;t<this.mSong.numChannels;t++)e.push(this.generateChannel(t));return await Promise.all(e),this.mCurrentCol=this.mSong.numChannels,1}createAudioBuffer(e){for(var t=e.createBuffer(2,this.mNumWords/2,44100),n=0;n<2;n++)for(var r=t.getChannelData(n),s=n;s<this.mNumWords;s+=2)r[s>>1]=this.mMixBuf[s]/65536;return t}createAudioBufferRange(e,t=0,n=null){(null===n||n>this.mNumWords/2)&&(n=this.mNumWords/2),t<0&&(t=0),t>=n&&(t=n-1);const r=n-t;for(var s=e.createBuffer(2,r,44100),o=0;o<2;o++)for(var i=s.getChannelData(o),a=0;a<r;a++){var c=2*(t+a)+o;i[a]=this.mMixBuf[c]/65536}return s}createWave(){var e=44+2*this.mNumWords-8,t=e-36,n=new Uint8Array(44+2*this.mNumWords);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var r=0,s=44;r<this.mNumWords;++r){var o=this.mMixBuf[r];o=o<-32767?-32767:o>32767?32767:o,n[s++]=255&o,n[s++]=o>>8&255}return n}createWaveRange(e=0,t=null){(null===t||t>this.mNumWords/2)&&(t=this.mNumWords/2),e<0&&(e=0),e>=t&&(e=t-1);const n=t-e;var r=44+2*n-8,s=r-36,o=new Uint8Array(44+2*n);o.set([82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&s,s>>8&255,s>>16&255,s>>24&255]);for(var i=0,a=44;i<n;++i){var c=this.mMixBuf[2*(e+i)];c=c<-32767?-32767:c>32767?32767:c,o[a++]=255&c,o[a++]=c>>8&255}return o}getData(e,t){for(var n=2*Math.floor(44100*e),r=new Array(t),s=0;s<2*t;s+=1){var o=n+s;r[s]=e>0&&o<this.mMixBuf.length?this.mMixBuf[o]/32768:0}return r}}const G=44100,N=new(window.AudioContext||window.webkitAudioContext),V=(...e)=>((...e)=>{let t=N.createBufferSource(),n=N.createBuffer(e.length,e[0].length,G);return e.map((e,t)=>n.getChannelData(t).set(e)),t.buffer=n,t.connect(N.destination),t.start(),t})(((e=1,t=.05,n=220,r=0,s=0,o=.1,i=0,a=1,c=0,l=0,d=0,u=0,h=0,p=0,m=0,f=0,g=0,y=1,w=0,b=0)=>{let v,M,x=2*Math.PI,C=c*=500*x/G**2,I=(0<m?1:-1)*x/4,P=n*=(1+2*t*Math.random()-t)*x/G,E=[],S=0,T=0,B=0,k=1,R=0,D=0,A=0;for(l*=500*x/G**3,m*=x/G,d*=x/G,u*=G,h=G*h|0,M=(r=99+G*r)+(w*=G)+(s*=G)+(o*=G)+(g*=G)|0;B<M;E[B++]=A)++D%(100*f|0)||(A=i?1<i?2<i?3<i?Math.sin((S%x)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/x%2+2)%2:1-4*Math.abs(Math.round(S/x)-S/x):Math.sin(S),A=(h?1-b+b*Math.sin(2*Math.PI*B/h):1)*(0<A?1:-1)*Math.abs(A)**a*e*.3*(B<r?B/r:B<r+w?1-(B-r)/w*(1-y):B<r+w+s?y:B<M-g?(M-B-g)/o*y:0),A=g?A/2+(g>B?0:(B<M-g?1:(M-B)/g)*E[B-g|0]/2):A),v=(n+=c+=l)*Math.sin(T*m-I),S+=v-v*p*(1-1e9*(Math.sin(B)+1)%2),T+=v-v*p*(1-1e9*(Math.sin(B)**2+1)%2),k&&++k>u&&(n+=d,P+=d,k=0),!h||++R%h||(n=P,c=C,k=k||1);return E})(...e));var W={songData:[{i:[0,255,116,85,0,255,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,136,15,0,32,0,0,0,6],p:[1,1,1,2,,,1,1,2,2],c:[{n:[139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139,,139,,139,,139],f:[]},{n:[140,,140,,,,140,,,,140,,140,,140,,,,140,,140,,,,140,,140,,,,140],f:[]}]},{i:[0,160,128,64,0,160,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,0,6],p:[,1,2,1,2,1,2,1,1,1],c:[{n:[,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,139],f:[]},{n:[,,,,,,,,,,,,139,,139,,,,,,,,,,,,,,139,,139],f:[]}]},{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[,,,,1,,2,1,1,2],c:[{n:[144,,,,,,,,,,,,,,,,144],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,156,,,,,,,,,,,,,,,,156],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,,,1,1,1,1,2,2],c:[{n:[132,,,,,,,,132,,,,,,,,144,,,,,,,,144],f:[]},{n:[],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[,,2,1,,2,1,2,2,1],c:[{n:[144,,,,144,,,,144,,,,142,,142,,144,,144,,144,,,,144,,,,144,,,,147,,,,151,,,,147,,,,149,,149,,147,,147,,151,,,,147,,,,147,,,,151,,,,154,,,,151,,,,151,,151,,151,,151,,154,,,,151,,,,151],f:[]},{n:[144,144,144,,144,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,147,147,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,151,151,,151],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:5};const U=new AudioContext;let z=0;t.Instance.on("progress",e=>{const t=e.bestComboCount||0;z=Math.min(t,6)});const q=()=>V(...[,,143,.03,.17,.09,2,1.5,10,-17,,,,,4,,,.73,.09]),_=["Light Blue","Yellow","Orange","Red","Purple","Blue","Green","Lime","Pink","Silver"],j={"Light Blue":"#9999ff",Yellow:"#fffb00",Orange:"#ff7300",Red:"#ff0000",Purple:"#c300ff",Blue:"#0000ff",Green:"#00ff00",Lime:"#b0ffb0",Pink:"#ff00ff",Silver:"#d3d3d3"},F=(t,n)=>{const r=new e.Group;r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1);const s={...j,...n};return t.forEach(t=>{if(null!==t)if(Array.isArray(t))r.add(F(t,s));else{const[n,o,i,a,c,l,d,u,h,p,m,f,g,y,w]=t.split(","),b=(t=>{const[n]=t.split(",");switch(n){case"c":return(t=>{const[n,r,s,o,i,a,c,l,d,u,h,p,m,f,g]=t.split(","),y=S(s),w=S(o),b=S(i),v=S(a),M=S(c),x=S(l),C=S(p),I=S(m),P=S(f),E=S(d),T=S(u),B=S(h),k=new e.BoxGeometry(y,w,b);return k.translate(v-C,M-I,x-P),k.rotateX(e.MathUtils.degToRad(E)),k.rotateY(e.MathUtils.degToRad(T)),k.rotateZ(e.MathUtils.degToRad(B)),k.computeBoundingBox(),k})(t);case"s":return(t=>{const[n,r,s,o,i,a,c,l,d,u,h,p,m,f,g]=t.split(","),y=S(s),w=S(o),b=S(i),v=S(a),M=S(c),x=S(l),C=S(p),I=S(m),P=S(f),E=S(d),T=S(u),B=S(h),k=new e.SphereGeometry(y/2,32,16);return k.scale(y/y,w/y,b/y),k.translate(v-C,M-I,x-P),k.rotateX(e.MathUtils.degToRad(E)),k.rotateY(e.MathUtils.degToRad(T)),k.rotateZ(e.MathUtils.degToRad(B)),k})(t);case"p":return(t=>{const[n,r,s,o,i,a,c,l,d,u,h,p,m,f,g]=t.split(","),y=S(s),w=S(o),b=S(a),v=S(c),M=S(l),x=S(p),C=S(m),I=S(f),P=S(d),E=S(u),T=S(h),B=new e.PlaneGeometry(y,w);return B.rotateX(e.MathUtils.degToRad(-90)),B.translate(b-x,v-C,M-I),B.rotateX(e.MathUtils.degToRad(P)),B.rotateY(e.MathUtils.degToRad(E)),B.rotateZ(e.MathUtils.degToRad(T)),B.computeBoundingBox(),B})(t);case"cy":return(t=>{const[n,r,s,o,i,a,c,l,d,u,h,p,m,f,g]=t.split(","),y=S(s),w=S(o),b=S(i),v=S(a),M=S(c),x=S(l),C=S(p),I=S(m),P=S(f),E=S(d),T=S(u),B=S(h),k=y/2,R=new e.CylinderGeometry(k,k,w,32);R.translate(v-C,M-I,x-P),R.scale(1,1,b/y);const D=e.MathUtils.degToRad(E),A=e.MathUtils.degToRad(T),L=e.MathUtils.degToRad(B),O=new e.Euler(D,A,L);return R.applyQuaternion((new e.Quaternion).setFromEuler(O)),R.computeBoundingBox(),R})(t);case"py":return(t=>{const[n,r,s,o,i,a,c,l,d,u,h,p,m,f,g]=t.split(","),y=S(s),w=S(o),b=S(i),v=S(a),M=S(c),x=S(l),C=S(p),I=S(m),P=S(f),E=S(d),T=S(u),B=S(h),k=Math.sqrt(y*y+y*y)/2,R=new e.CylinderGeometry(0,k,w,4,1,!1,Math.PI/4);return R.scale(1,1,b/y),R.translate(v-C,M-I+.3*w,x-P),R.rotateX(e.MathUtils.degToRad(E)),R.rotateY(e.MathUtils.degToRad(T)),R.rotateZ(e.MathUtils.degToRad(B)),R})(t);default:throw new Error(`Unknown shape: ${n}`)}})(t);let v=new e.MeshStandardMaterial({color:s[_[w]],side:e.DoubleSide});const M=new e.Mesh(b,v);M.name=o,M.position.set(f,g,y),r.add(M)}}),r},$=[{Purple:p,Silver:"#888888",Yellow:d}];class H{clock;parent;_mesh;geometry;constructor(){this.clock=new e.Clock,this.parent=new e.Group,this.parent.name="Grid",this.geometry=new e.PlaneGeometry(20,26,20,26),this.geometry.rotateX(Math.PI/2),this._mesh=new e.Mesh(this.geometry,new e.MeshBasicMaterial({color:"#ff00ff",wireframe:!0})),this.parent.add(this._mesh),t.Instance.on("tick",e=>{const t=this.geometry.getAttribute("position");for(let n=0;n<t.array.length;n+=3){const e=t.array[n],r=t.array[n+2];t.array[n+1]=.5*Math.sin(Math.sqrt(e*e+r*r)-2*this.clock.getElapsedTime())}t.needsUpdate=!0}),t.Instance.on("progress",t=>{!this._mesh.material.visible&&t.bestComboCount>5&&(this._mesh.position.set(0,-5,0),L.Instance.animateTransform({mesh:this._mesh,end:{position:new e.Vector3(0,0,0)},ease:A,duration:2e3})),this._mesh.material.visible=t.bestComboCount>5})}get mesh(){return this.parent}}const X=[{},{Orange:"#af3dff",Purple:l,Silver:h}],Y=new e.Clock;let Q,K,Z,J,ee,te,ne,re,se=0;const oe=new e.Vector3(0,0,.3),ie=async()=>{document.getElementById("p").setAttribute("disabled","true"),document.getElementById("p").innerHTML="LOADING...",J=new e.WebGLRenderer({antialias:!0}),J.setPixelRatio(window.devicePixelRatio),J.setSize(window.innerWidth,window.innerHeight),J.setClearColor("#000000"),J.xr.addEventListener("sessionstart",ae),J.xr.enabled=!0,J.setAnimationLoop(pe),document.body.appendChild(C.createButton(J)),document.body.appendChild(J.domElement);const g=new x;K=new e.Scene,Q=new e.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),Q.position.set(0,2,1),Q.rotation.set(-1*Math.PI/12,0,0),Q.name="camera",K.add(Q),L.Instance.initScene(K);const y=new e.AmbientLight(16777215,.8);K.add(y);const w=new e.DirectionalLight(16777215,.8);w.position.set(6,10,8),w.castShadow=!0,w.target.position.set(0,0,0),K.add(w),K.add(w.target);const v=(()=>{const n=new e.Group;n.name="Sky";const r=new e.Object3D,s=30,o=new e.BoxGeometry,i=new e.MeshStandardMaterial,a=[];let c=0,l=0;const d=new e.InstancedMesh(o,i,900);d.instanceMatrix.setUsage(e.DynamicDrawUsage);const u=new e.Color,h=[new e.Color(65535),new e.Color(16776960),new e.Color(16711935)];let p=0;for(let e=0;e<s;e++)for(let t=0;t<s;t++){const n=E(0,2*t*Math.PI/s,15);n.z=4*-e,r.position.copy(n),r.scale.set(1,1,2),r.updateMatrix(),u.setHSL(1,.5+.5*Math.random(),.5+.5*Math.random()),a.push(u.getHex()),d.setMatrixAt(p,r.matrix),d.setColorAt(p,u.multiply(h[0])),p++}return n.add(d),t.Instance.on("tick",e=>{c+=e;for(let t=0;t<d.count;t++){d.getMatrixAt(t,r.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale);const e=Math.floor(t/s),n=e%2?1:-1,o=4*-e,i=t%s*2*Math.PI/s,a=.05*n*c;r.position.copy(E(0,i+a,15)),r.position.z=o+l*n*Math.sin(c),r.updateMatrix(),d.setMatrixAt(t,r.matrix)}d.instanceMatrix.needsUpdate=!0}),t.Instance.on("progress",e=>{l=e.bestComboCount>=2?1:0}),n})();v.position.set(0,0,5),K.add(v);const S=(g=>{const y=F([["c,desk,2,0.1,1,,0.85,-0.5,,,,,-0.1,,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.85,,,,0.1,,-0.9,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.15,,,,0.1,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.15,,,,1.8,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.85,,,,1.8,,-0.9,6","c,record-rack,0.4,0.1,0.8,0.7,0.95,-0.5,,,,0.7,0.95,-0.5,0","c,cube,0.3,0.1,0.4,-0.75,0.95,-0.3,,,,-0.75,0.95,-0.3,9","c,cube,0.4,0.1,0.4,-0.3,0.95,-0.3,,,,-0.3,0.95,-0.3,9","c,tableA,0.4,0.1,0.4,0.2,0.95,-0.3,,,,0.2,1.01,-0.3,0","cy,pad,0.4,0.02,0.4,0.2,1,-0.3,,,,0.2,1,-0.3,3"],"c,cube,22,1,4,,-1.5,-23,,,,,-2,-15,2","c,floor,20,1,20,,-2.5,-11,,,,,-3,-4,3","c,cube,20,1,6,,-2.5,2,,,,,-3,5,3","c,cube,8,2,3,,-1,0.5,,,,,-1,-4,2","c,pillar,1,4,1,6.5,,-6.5,,,,7,,-7,6","c,pillar,1,4,1,6.5,,-10.5,,,,7,,-11,6","c,pillar,1,3,1,6.5,0.5,-14.5,,,,7,,-15,6","c,pillar,1,4,1,6.5,,-18.5,,,,7,,-19,6","c,pillar,1,4,1,6.5,,-14.5,,,,7,,-15,6","c,pillar,1,4,1,-6.5,,-6.5,,,,-6,,-7,6","c,pillar,1,4,1,-6.5,,-2.5,,,,-6,,-3,6","c,pillar,1,4,1,6.5,,-2.5,,,,7,,-3,6","c,pillar,1,4,1,-6.5,,-10.5,,,,-6,,-11,6","c,pillar,1,4,1,-6.5,,-14.5,,,,-6,,-15,6","c,pillar,1,4,1,-6.5,,-18.5,,,,-6,,-19,6","c,cube,4,1,20,8,2.5,-11,,,,7,2,-3,1","c,cube,4,1,20,-8,2.5,-11,,,,-9,2,-3,1"],{Green:"#93e0a8",Yellow:d,Orange:"#687793",Red:"#42485d"}),w=(()=>{const e=F(["c,base,13,1,3,-1.5,0.5,-0.5,,,,,,,5",["c,panel,12.4,2.7,1,-1.5,2.45,0.3,-60,,,-1.5,1.1,0.88,6","c,display-back,11.8,0.8,0.1,-1.5,3.2,0.85,-60,,,-1.5,1.1,0.88,3","c,progress-color-0,1.8,0.3,0.1,-6.5,2.45,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-color-1,1.8,0.3,0.1,-4.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-2,1.8,0.3,0.1,-2.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-3,1.8,0.3,0.1,-0.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-4,1.8,0.3,0.1,1.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-5,1.8,0.3,0.1,3.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-1,1.8,0.3,0.1,-4.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-2,1.8,0.3,0.1,-2.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-3,1.8,0.3,0.1,-0.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-4,1.8,0.3,0.1,1.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-5,1.8,0.3,0.1,3.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-0,1.8,0.3,0.1,-6.5,1.95,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-title-1,1.8,0.3,0.1,-4.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-2,1.8,0.3,0.1,-2.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-3,1.8,0.3,0.1,-0.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-4,1.8,0.3,0.1,1.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-5,1.8,0.3,0.1,3.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-0,1.8,0.3,0.1,-6.5,1.45,0.85,-60,,,-11.5,1.1,0.88,9","p,display,11.8,0.8,,-1.5,2.22,-0.88,30,,,-1.5,2.22,-0.88,8"]],{Red:l,Green:d,Blue:i,Silver:l});return e.scale.set(.1,.1,.1),t.Instance.on("progress",t=>{e.getObjectByName("display").material=R([t.displayText],{color:m[t.bestComboType],textAlign:"left",ratio:14.75,fontSize:b[t.bestComboType]}),M.forEach(n=>{for(let r=0;r<6;r++){const s=e.getObjectByName(`progress-${n}-${r}`);if(!s)continue;let o=p;(t[n].solved||r<t[n].correctCount)&&(o=m[n]),(t[n].solved||r<t[n].correctCount)&&"color"===n&&(o=f[r]),s.material.color.set(o),s.material.emissive.set(o),s.material.needsUpdate=!0}})}),e})();y.add(w),w.position.set(-.1,.9,-.7);const v=(()=>{const e=F(["cy,lid,3.9,0.1,3.9,-0.27,2.1,,,,30,-0.27,2.1,,9","cy,label,4,0.8,4,,0.5,,,,,,0.5,,5","cy,can,3.9,1,3.9,,0.5,,,,,,0.5,,9","cy,tuna,3.8,0.6,3.8,,0.8,,,,,,0.8,,8"],{Blue:h,Red:u,Silver:c});return e.scale.set(.03125,.03125,.03125),e.userData.isPickable=!0,e.onPointerPick=e=>{q()},e})();y.add(v),v.position.set(-.4,1,-.3);const x=(n=>{const r=[];let s=0;const o=[],i=new e.Group,a=F(["s,head,20,16,16,,8,,,,,,8,,4","s,head,16,16,16,,-5,,,,,,-5,,4",["cy,leftEye,4,1,4,-3,10,-7.1,-71,-5,16,-3,10,-7.1,1","s,leftPupil,2,2,4,-2.8,10.1,-7,-75,7,10,-2.8,10.1,-7,4","cy,rightEye,4,1,4,3,10,-7.2,-71,5,-17,3,10,-7.2,1","s,rightPupil,2,2,4,2.9,10,-7.1,-74,-4,-12,2.9,10,-7.1,4"],["c,rightCheek,4,4,2,1.84,6.03,-7.5,-25,,80,2.34,6.53,-7.5,9","c,leftCheek,4,4,2,-2.91,5.98,-7.5,,23,10,-2.41,6.48,-7.5,9","c,tongue,2,2,2,,5,-7,,,,,4,-7,3","py,pyramid,3,1.6,1,,8.2,-8,-180,,,,8.2,-8,8"],["py,ear,6,7,4,-4.86,13.55,-1.28,-14,20,31,-4.86,13.55,-1.28,4","py,ear,6,7,4,5.14,13.55,-1.28,-11,-15,-33,5.14,13.55,-1.28,4","py,ear,5.2,6.2,3.4,5.14,13.15,-1.78,-9,-16,-33,5.14,13.15,-1.78,1","py,ear,5,5.5,3.8,-5.04,13.54,-1.59,-17,19,32,-5.04,13.54,-1.59,1"],["cy,cylinder,0.2,11,0.2,-7.93,6,-10.12,,-15,90,-7.93,6,-10.12,9","cy,cylinder,0.2,9.2,0.2,-6.87,7.72,-9,,-15,75,-6.87,7.72,-9,9","cy,cylinder,0.2,9,0.2,-7.07,3.78,-9.3,,-15,105,-7.07,3.78,-9.3,9","cy,cylinder,0.2,7.8,0.2,6.87,7.62,-8.9,180,-15,-105,6.87,7.62,-8.9,9","cy,cylinder,0.2,9.4,0.2,6.93,6,-9.52,,-165,90,6.93,6,-9.52,9","cy,cylinder,0.2,8.8,0.2,6.87,3.88,-9.1,180,-15,-75,6.87,3.88,-9.1,9"]],$[0]);a.scale.set(.03125,.03125,.03125);for(let t=0;t<10;t++){const t=a.clone();i.add(t),t.position.set(6*Math.random()-3,1*Math.random()-.5,6*Math.random()-3),t.userData.offset=60*e.MathUtils.randInt(0,1e3),t.lookAt(0,6,0),r.push(t)}return t.Instance.on("tick",()=>{if(!n.xr?.getCamera())return;const t=n.xr?.getCamera();if(t){s++;const n=(new e.Quaternion).setFromEuler(new e.Euler(0,Math.PI,0)).multiply(t.quaternion.clone());o.push(n)}r.forEach(e=>{const t=o[(e.userData.offset+s)%o.length];t&&e.quaternion.copy(t)})}),i})(g);x.name="Crowd",y.add(x),x.position.set(0,-1,-10);const C=F(["s,head,20,16,16,,8,,,,,,8,,4","s,head,16,16,16,,-5,,,,,,-5,,4",["cy,leftEye,4,1,4,-3,10,-7.1,-71,-5,16,-3,10,-7.1,1","s,leftPupil,2,2,4,-2.8,10.1,-7,-75,7,10,-2.8,10.1,-7,4","cy,rightEye,4,1,4,3,10,-7.2,-71,5,-17,3,10,-7.2,1","s,rightPupil,2,2,4,2.9,10,-7.1,-74,-4,-12,2.9,10,-7.1,4"],["c,rightCheek,4,4,2,1.84,6.03,-7.5,-25,,80,2.34,6.53,-7.5,9","c,leftCheek,4,4,2,-2.91,5.98,-7.5,,23,10,-2.41,6.48,-7.5,9","c,tongue,2,2,2,,5,-7,,,,,4,-7,3","py,pyramid,3,1.6,1,,8.2,-8,-180,,,,8.2,-8,8"],["py,ear,6,7,4,-4.86,13.55,-1.28,-14,20,31,-4.86,13.55,-1.28,4","py,ear,6,7,4,5.14,13.55,-1.28,-11,-15,-33,5.14,13.55,-1.28,4","py,ear,5.2,6.2,3.4,5.14,13.15,-1.78,-9,-16,-33,5.14,13.15,-1.78,1","py,ear,5,5.5,3.8,-5.04,13.54,-1.59,-17,19,32,-5.04,13.54,-1.59,1"],["cy,cylinder,0.2,11,0.2,-7.93,6,-10.12,,-15,90,-7.93,6,-10.12,9","cy,cylinder,0.2,9.2,0.2,-6.87,7.72,-9,,-15,75,-6.87,7.72,-9,9","cy,cylinder,0.2,9,0.2,-7.07,3.78,-9.3,,-15,105,-7.07,3.78,-9.3,9","cy,cylinder,0.2,7.8,0.2,6.87,7.62,-8.9,180,-15,-105,6.87,7.62,-8.9,9","cy,cylinder,0.2,9.4,0.2,6.93,6,-9.52,,-165,90,6.93,6,-9.52,9","cy,cylinder,0.2,8.8,0.2,6.87,3.88,-9.1,180,-15,-75,6.87,3.88,-9.1,9"]],{Purple:"#333333",Silver:"#888888"});C.name="catMesh",C.position.set(-3,1,0),C.scale.set(.1,.1,.1),C.rotation.set(0,-Math.PI/4,0),y.attach(C);const I=C.clone(!0);I.name="catMesh2",I.position.set(3,1,0),I.rotation.set(0,Math.PI/4,0),y.attach(I);const P=(()=>{const t=F([["c,case1,1,8,2,7.5,7,,,,,7.5,7,,5","c,case2,3,9,2,5.5,7.5,,,,,5.5,7.5,,5","c,case3,8,4,2,,10,,,,,,11.5,,5","c,case4,8,1,2,,5.5,,,,,,5.5,,5","c,case5,3,9,2,-5.5,7.5,,,,,-5.5,7.5,,5","c,case6,1,8,2,-7.5,7,,,,,-7.5,7,,5"],"c,base,12,2.1,2.8,,3.95,,,,,,3,,3","c,rightReel,2,2,1,2.72,6.89,,,,-45,2.72,6.89,,2","c,rightTape,4,4,0.2,2.81,6.91,-0.1,,,-45,2.81,6.91,-0.1,4","c,leftReel,2,2,1,-2.69,6.91,,,,-45,-2.75,7,,2","cy,base,16,8,16,,-4,,,,,,-4,,6","c,label,12,2,2.2,,10,,,,,,9,1,9"],{Blue:"#ffcc00",Silver:"#f6ff00",Red:u,Orange:d,Purple:"#39013a",Green:i});return L.Instance.animateTransform({mesh:t,end:{rotation:new e.Euler(0,2*Math.PI-.01,0)},duration:16e3,ease:e=>e,loop:!0}),t})();y.add(P),P.position.set(0,0,-30);const E=new H;y.add(E.mesh),E.mesh.position.set(0,-1,-7);const S=(()=>{const n=new e.Group;n.name="debugScreen",n.renderOrder=1;const r=new e.PlaneGeometry(5,5);r.translate(0,-2,0);const s=R(["You win!","Thanks for playing","Created by Alex Swan"],{color:"white"}),o=new e.Mesh(r,s);return n.add(o),o.position.set(0,0,-20),o.scale.set(.1,.1,.1),o.rotation.set(-Math.PI/2,0,0),o.visible=!1,t.Instance.on("progress",t=>{t.color.solved&&t.artist.solved&&t.title.solved&&(o.userData.solved=!0,o.visible=!0,o.material.needsUpdate=!0,L.Instance.animateTransform({mesh:o,end:{position:{x:0,y:0,z:0},scaling:{x:1,y:1,z:1},rotation:new e.Euler(0,0,0)},duration:1e3}))}),n})();y.add(S),S.position.set(0,2,-1);const T=(()=>{const c=new e.Group;c.name="Runner";let d=[n,r,s,o,i,a],u=[(e,t)=>0===e||0===t,(e,t)=>1===e||1===t,(e,t)=>2===e||2===t,(e,t)=>3===e||3===t,(e,t)=>4===e||4===t,(e,t)=>5===e||5===t,(e,t)=>t+e===0||12-e-t-2==0,(e,t)=>t+e===1||12-e-t-2==1,(e,t)=>t+e===2||12-e-t-2==2,(e,t)=>t+e===3||12-e-t-2==3,(e,t)=>t+e===4||12-e-t-2==4,(e,t)=>t+e===5||12-e-t-2==5,(e,t)=>(e+t)%2==0,(e,t)=>(e+t)%2==1,(e,t)=>(e+t)%2==0,(e,t)=>(e+t)%2==1,(e,t)=>(e+t)%2==0,(e,t)=>(e+t)%2==1];for(;d.length<6;)d.push(...d);d=d.slice(0,6);let h=-2;const p=new e.BoxGeometry;p.translate(.5,.5,.5),p.scale(.9,1.1,.9);for(let t=0;t<6;t++)for(let n=0;n<6;n++){const r=new e.MeshBasicMaterial({color:l}),s=new e.Mesh(p,r);s.name=`runner-${n}-${t}`,s.userData.x=n,s.userData.y=t,s.position.set(-3+n,0,-3+t),c.attach(s)}return t.Instance.on("beat",()=>{h+=1,h<0||c.children.forEach(e=>{const{x:t,y:n}=e.userData,r=u[h%u.length](t,n)?d[h%d.length]:l;d[e.userData.index],e.material.color.set(r)})}),c})();return y.add(T),T.position.set(0,-3,-10),T.scale.set(2,1,2),y})(J);K.add(S);const T=S.getObjectByName("tableA"),B=(()=>{new e.Vector3(1,0,0);const n=new e.Group;n.name="FishSwirl";const r=[];let s=!0;const o=new e.Group,i=F(["c,cube,6,6,8,,,,,,,,-3,,2","c,cube,4,4,11.1,,,-0.55,,,,,-3,,2","c,cube,2,2,2,-2,,-5,,,,-2,-1,-5,4","c,cube,2,2,2,2,,-5,,,,2,-1,-5,4","c,cube,2,6,2,,,6,,,,,-3,7,2","c,cube,1,4,6,,-3,9.5,15,,,,-3,8.5,9","c,cube,1,5,7,,2.5,9.9,-15,,,,2,8.4,2","c,cube,2,5,6,,2.2,,-30,,,,2.7,,2","c,cube,1,2,2,-2.5,-4,-2,,,-40,-3,-3,-2,9","c,cube,3,1,4,-4.5,-3.5,4,,,20,-3,-3,3,9","c,cube,1,2,2,2.5,-4,-2,,,40,3,-3,-2,9","c,cube,3,1,4,4.5,-3.5,4,,,-25,3,-3,3,9"],X[e.MathUtils.randInt(0,X.length)]);for(let t=0;t<10;t++){const t=i.clone(!0);t.position.set(10*Math.random()-5,0,0),r.push(t),o.attach(t),t.userData.velocity=new e.Vector3(0,5+3*Math.random(),-5),t.scale.set(0,0,0)}return o.rotation.set(0,0,0),n.attach(o),t.Instance.on("tick",t=>{r.forEach(n=>{if(n.userData.velocity.y-=10*t,n.position.addScaledVector(n.userData.velocity,t),n.position.y<0){const t=new e.Vector3(4*Math.random()-2,0,4*Math.random()-2).sub(n.position).normalize(),r=new e.Quaternion;r.setFromUnitVectors(new e.Vector3(0,0,-1),t),n.quaternion.copy(r),n.position.y=0;const s=new e.Vector3(0,0,-1);s.applyQuaternion(n.quaternion),s.multiplyScalar(5),n.userData.velocity.x=s.x,n.userData.velocity.z=s.z,n.userData.velocity.y=5+6*Math.random()}const r=new e.Quaternion;r.setFromUnitVectors(new e.Vector3(0,0,-1),n.userData.velocity),n.quaternion.copy(r)})}),t.Instance.on("progress",t=>{const n=t.bestComboCount>=4;r.forEach(t=>{n&&!s?(L.Instance.cancelAnimation(t),L.Instance.animateTransform({mesh:t,end:{scaling:new e.Vector3(I,I,I)},duration:2e3})):!n&&s&&(L.Instance.cancelAnimation(t),L.Instance.animateTransform({mesh:t,end:{scaling:new e.Vector3(0,0,0)},duration:1e3}))}),s=n}),n})();B.position.set(0,0,-10),K.attach(B),g.vinyls.forEach((t,n)=>{const r=(({color:t,artist:n,title:r})=>{const s=new e.Group,a=new e.RingGeometry(4,7,32);a.scale(I,I,I);const c=k(t,{glow:!0});s.add(new e.Mesh(a,c));const d=new e.RingGeometry(.25,4,32);d.scale(I,I,I);const u=k(16777215,{});s.add(new e.Mesh(d,u));const h=new e.PlaneGeometry(14,14);h.translate(0,0,.001),h.scale(I,I,I);const p=((t,n)=>{const[r,s]=P();s.fillStyle=l,s.strokeStyle=l,s.lineWidth=8,s.beginPath(),s.arc(512,512,20,0,2*Math.PI),s.stroke(),s.beginPath(),s.arc(512,512,288,0,2*Math.PI),s.stroke(),s.textAlign="center",t&&(s.font="64px monospace",s.textBaseline="middle",s.strokeStyle=l,s.lineWidth=8,s.strokeText(t,512,430.08),s.fillStyle=o,s.fillText(t,512,430.08)),n&&(s.font="96px monospace",s.textBaseline="bottom",s.fillStyle=i,s.strokeText(n,512,696.32),s.fillText(n,512,696.32));const a=new e.CanvasTexture(r);return a.encoding=e.LinearSRGBColorSpace,new e.MeshBasicMaterial({map:a,transparent:!0})})(n,r);s.add(new e.Mesh(h,p));const m=s.clone();return m.rotation.set(0,Math.PI,0),m.position.set(0,0,-.002),s.add(m),s})(t);r.name=`vinyl-${n}`;const s=new e.Vector3(.7,1.15,-.2-.125*n);r.position.copy(s),r.userData.originalPosition=s,r.userData.isPickable=!0,r.userData.recordIndex=n,r.userData.returnToOriginalPosition=()=>{K.attach(r),L.Instance.cancelAnimation(r),L.Instance.animateTransform({mesh:r,end:{position:r.userData.originalPosition,rotation:new e.Euler(0,0,0)},duration:100})},r.onPointerPick=t=>{if(t.userData.selected)return;g.selected[t.id]=n;const s=t.getObjectByName("target");s&&(L.Instance.cancelAnimation(r),s.attach(r),L.Instance.animateTransform({mesh:r,end:{position:new e.Vector3(0,0,0),rotation:new e.Euler(0,Math.PI/2,0)},duration:60}),t.userData.selected=r)},r.onPointerDrop=t=>{if(L.Instance.cancelAnimation(r,!0),r.getWorldPosition(new e.Vector3).distanceTo(T.getWorldPosition(new e.Vector3))<.3)return g.addVinylByIndex(r.userData.recordIndex),delete g.selected[t.id],t.userData.selected=void 0,T.children.forEach(e=>{e.userData.returnToOriginalPosition&&e.userData.returnToOriginalPosition()}),T.attach(r),V(...[1.01,,275,.01,.01,.15,1,1.03,-3.7,,-93,.07,,,,-.1,,.5,.04,.09]),void L.Instance.animateTransform({mesh:r,end:{position:new e.Vector3(0,.01,0),rotation:new e.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{L.Instance.animateTransform({mesh:r,end:{rotation:new e.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:e=>e,duration:1800,loop:!0})});r.userData.returnToOriginalPosition(),t.userData.selected=void 0},K.add(r)}),te=J.xr.getController(0),te.addEventListener("connected",ce),te.addEventListener("selectstart",le),te.addEventListener("selectend",de),te.addEventListener("squeezestart",le),te.addEventListener("squeezeend",de),K.add(te),ne=J.xr.getController(1),ne.addEventListener("connected",ce),ne.addEventListener("selectstart",le),ne.addEventListener("selectend",de),ne.addEventListener("squeezestart",le),ne.addEventListener("squeezeend",de),K.add(ne),Z=new e.Raycaster,window.addEventListener("resize",me,!1),t.Instance.on("comboBroken",()=>{q()}),(async()=>{const e=new O;await e.init(W),await e.generate();const t=[];for(let a=0;a<6;a++){const n=176400*a,r=n+176400,s=e.createAudioBufferRange(U,n,r);t.push(s)}const n=e.createAudioBufferRange(U,1058400,1764e3),r=[...t,n];let s=null,o=!1;const i=e=>{let t;s&&(s.stop(),s.disconnect()),t=e<6?e:6;const n=r[t];s=U.createBufferSource(),s.buffer=n,s.connect(U.destination),s.loop=!0,s.start();const a=setInterval(()=>{z!==e&&(clearInterval(a),i(z))},2e3);o=!0};i(z)})(),g.reset(),document.getElementById("intro").style.display="none",document.getElementById("c").style.display="block"};function ae(){re=J.xr.getReferenceSpace();const t={x:-1*oe.x,y:-1*oe.y,z:-1*oe.z,w:1},n=new e.Quaternion,r=new XRRigidTransform(t,n),s=re.getOffsetReferenceSpace(r);J.xr.setReferenceSpace(s)}function ce(t){const n=t.target,r="left"===t.data.handedness?-1:1,s=t.data.hand?0:r*Math.PI/2;if(!n.getObjectByName("target")){const t=new e.Group;t.name="target",t.rotation.set(0,0,0),t.position.set(-1*r*.035,.05,-.12),n.add(t)}let o=n.getObjectByName("paw");o||(o=(()=>{const e=F(["cy,cylinder,4,6,2,,-1,,,,,,-1,,4","s,sphere,4,4,2,,2,,,,,,2,,4","c,cube,0.3,1,0.3,-1.15,3.5,-0.55,-77,,,-1.15,3.5,-0.55,9","c,cube,0.3,1,0.3,-0.45,3.9,-0.55,-77,,,-0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,0.45,3.9,-0.55,-77,,,0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,1.05,3.6,-0.55,-77,,,1.05,3.6,-0.55,9","c,cube,2,0.7,0.4,,1.85,-0.9,,,,,1.5,-0.1,3","c,cube,0.8,0.5,1.1,,2.45,-0.55,,,,,2.2,-0.1,3","c,cube,0.3,0.6,0.6,-1.15,2.7,-0.8,,,,-1.15,2.7,-0.1,3","c,cube,0.3,0.6,0.6,-0.45,3.1,-0.8,,,,-0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,0.45,3.1,-0.8,,,,0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,1.05,2.7,-0.8,,,,1.05,2.7,-0.1,3"],{Purple:p,Red:u,Silver:c});return e.scale.set(.03125,.03125,.03125),e})(),o.position.set(0,0,.15),o.rotation.set(3*Math.PI/2,s,0),n.add(o));let i=n.getObjectByName("line");if(!i){const t=(new e.BufferGeometry).setFromPoints([new e.Vector3(0,0,0),new e.Vector3(0,0,-1)]);i=new e.Line(t),i.material.color.set(16711680),i.name="line",i.scale.z=5,n.add(i)}}function le(e){ee=e.target;const t=ue(ee);if(t.length>0){let e=!1;t.forEach(({object:t,distance:n})=>{if(e)return;let r=t;for(;r;){if(r.onPointerPick){r.onPointerPick(ee),e=!0,ee.getObjectByName("line").visible=!1;break}r=r.parent}})}ee.userData.targetRayMode=e.data.targetRayMode}function de(e){ee=e.target;const t=ee.userData.selected;t?.onPointerDrop&&t.onPointerDrop(ee),ee.getObjectByName("line").visible=!0}function ue(e){return e.updateMatrixWorld(),Z.setFromXRController(e),Z.intersectObjects(K.children,!0)}function he(e){if("screen"===e.userData.targetRayMode)return;if(void 0!==e.userData.selected)return;const t=e.getObjectByName("line"),n=ue(e);if(t&&(t.scale.z=5),n.length>0){let e=!1;n.forEach(({object:n,distance:r})=>{if(e)return;let s=n;for(;s;){if(s.userData.isPickable){t&&(t.scale.z=r),e=!0;break}s=s.parent}})}}function pe(){const e=Y.getDelta();se+=e,se>=.5&&(t.Instance.emit("beat"),se-=.5),L.Instance.update(),t.Instance.emit("tick",e),he(te),he(ne),J.render(K,Q)}const me=()=>{Q.aspect=window.innerWidth/window.innerHeight,Q.updateProjectionMatrix(),J.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{document.getElementById("p").onclick=ie});
