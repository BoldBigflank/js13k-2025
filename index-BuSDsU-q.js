import*as c from"three";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();class N{static _instance;callbacks;constructor(){this.callbacks={}}static get Instance(){return N._instance||(N._instance=new N),N._instance}on(e,o){this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(o)}off(e,o){this.callbacks[e]=(this.callbacks[e]||[]).filter(r=>r!==o)}emit(e,...o){(this.callbacks[e]||[]).forEach(r=>r(...o))}_reset(){Object.keys(this.callbacks).forEach(e=>{delete this.callbacks[e]})}getCallbacks(){return this.callbacks}}const ce="#e81416",ye="#ffa500",we="#faeb36",le="#79c314",Z="#487de7",Le="#70369d",Xe="#1aff1a",oe="#ffffff",We="#666666",G="#000000",se="#abb7d0",qe="#687793",je="#42485d",Ze="#93e0a8",F="#ff3b94",Be="#ffcc00",be="#f6ff00",Fe="#a6fd29",Me="#8ea5ff",He="#af3dff",De="#39013a",ie="#333333",Ae="#888888",$e={"Light Blue":"#9999ff",Yellow:"#fffb00",Orange:"#ff7300",Red:"#ff0000",Purple:"#c300ff",Blue:"#0000ff",Green:"#00ff00",Lime:"#b0ffb0",Pink:"#ff00ff",Silver:"#d3d3d3"},pe={color:ce,artist:le,title:Z},Ke=[ce,ye,we,le,Z,Le],Q=["Red","Orange","Yellow","Green","Blue","Violet"],J=["Shiny Toy Guns","B.B. King","Jack White","Black Sabbath","Faith Hill","Cliff Sheen"],ee=["OFFSIDE","SHOWCASE","LOADOUT","BACKHAND","BOOKMARKS","MANPOWER"],Qe={color:Q,artist:J,title:ee},Je={color:42,artist:24,title:34},et=[[0,1,2,3,4,5],[0,2,4,1,5,3],[0,3,5,1,4,2]],tt=["color","artist","title"];class ot{queue;selected;vinyls;progress;constructor(){this.queue=[],this.selected={},this.vinyls=[],this.reset()}addVinylByIndex(e){if(this.queue[0]===e)return;const{color:o,artist:r,title:t}=this.vinyls[e],n=Q.indexOf(o),s=J.indexOf(r),i=ee.indexOf(t);n===this.progress.color.currentIndex+1?(this.progress.color.correctCount++,this.progress.color.correctCount===Q.length&&(this.progress.color.solved=!0),this.progress.color.currentIndex=n):(this.progress.color.currentIndex=-1,this.progress.color.correctCount=0),s===(this.progress.artist.currentIndex+1)%J.length?(this.progress.artist.correctCount++,this.progress.artist.correctCount===J.length&&(this.progress.artist.solved=!0)):this.progress.artist.correctCount=1,this.progress.artist.currentIndex=s,i===(this.progress.title.currentIndex+1)%ee.length?(this.progress.title.correctCount++,this.progress.title.correctCount===ee.length&&(this.progress.title.solved=!0)):this.progress.title.correctCount=1,this.progress.title.currentIndex=i;const d=Math.max(this.progress.color.correctCount,this.progress.artist.correctCount,this.progress.title.correctCount);this.progress.bestComboCount<6&&d<this.progress.bestComboCount?N.Instance.emit("comboBroken",!0):N.Instance.emit("comboBroken",!1),this.progress.bestComboCount=d,this.progress.bestComboType=this.progress.color.correctCount===this.progress.bestComboCount&&!this.progress.color.solved?"color":this.progress.artist.correctCount===this.progress.bestComboCount&&!this.progress.artist.solved?"artist":"title",this.queue.unshift(e),this.progress.bestComboUsedVinyls=this.queue.slice(0,this.progress.bestComboCount),this.progress.displayText=this.getDisplayText(),N.Instance.emit("progress",this.progress)}getVinylInQueue(e){return this.vinyls[this.queue[e]]}isSolved(e){if(e)return this.progress.color.solved&&this.progress.artist.solved&&this.progress.title.solved,this.progress[e].solved}getDisplayText(){let e=[];const{currentIndex:o,correctCount:r,solved:t}=this.progress[this.progress.bestComboType],n=Qe[this.progress.bestComboType];for(let s=0;s<r;s++){let i=o-s;i<0&&(i+=n.length),e.unshift(n[i])}return this.progress.color.solved&&this.progress.artist.solved&&this.progress.title.solved?"ðŸŽ‰ Game Over ðŸŽ‰":this.progress.color.correctCount===6||this.progress.artist.correctCount===6||this.progress.title.correctCount===6?"ðŸŽ‰ Sequence Complete ðŸŽ‰":e.join("â†’")}reset(){this.queue=[],this.selected={};const[e,o,r]=et;this.progress={color:{currentIndex:-1,correctCount:0,solved:!1},artist:{currentIndex:-2,correctCount:0,solved:!1},title:{currentIndex:-2,correctCount:0,solved:!1},bestComboType:"color",bestComboCount:0,bestComboUsedVinyls:[],displayText:"Select a record to play â†’ â†’ â†’ â†’ â†’"},this.vinyls=Q.map((t,n)=>({index:n,color:t,artist:"",title:""})),e.forEach((t,n)=>{this.vinyls[t].color=Q[n]}),o.forEach((t,n)=>{this.vinyls[t].artist=J[n]}),r.forEach((t,n)=>{this.vinyls[t].title=ee[n]}),N.Instance.emit("progress",this.progress)}}class st{static createButton(e){const o=document.createElement("button");let r=null;async function t(s){s.addEventListener("end",n),await e.xr.setSession(s),o.textContent="EXIT VR",r=s}function n(){r.removeEventListener("end",n),o.textContent="ENTER VR",r=null}if(o.style.display="block",o.textContent="ENTER VR",o.id="VRButton",o.onclick=function(){r===null?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","layers"]}).then(t):r.end()},"xr"in navigator)return o.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(function(s){s?o.style.display="block":(o.textContent="VR NOT SUPPORTED",o.setAttribute("data-disabled","true"))}).catch(()=>{o.textContent="VR NOT ALLOWED",o.setAttribute("data-disabled","true")}),o;{const s=document.createElement("a");return s.href="https://immersiveweb.dev/",s.innerHTML="WEBXR NOT AVAILABLE",s.className="webxr-message",s}}}const _=.0254,ke=(a=1024,e=1024)=>{const o=document.createElement("canvas");o.width=a,o.height=e;const r=o.getContext("2d");return[o,r]},Ee=(a,e,o)=>{const r=new c.Vector3(1,0,0),t=new c.Euler(0,a,-Math.PI/2+e);return r.applyEuler(t).normalize().multiplyScalar(o)},g=a=>parseFloat(`${a||0}`),nt=a=>a[Math.floor(Math.random()*a.length)],K={},xe=new c.Color,de=(a,e)=>{const o=e?.glow==!0,r=`color-${a}-${o}`;if(K[r])return K[r];const t=o?c.MeshBasicMaterial:c.MeshStandardMaterial,n=new t({color:a,side:c.FrontSide});return K[r]=n,n},Ge=(a,e)=>{const{color:o,bgColor:r,textAlign:t,ratio:n,fontSize:s}=e;xe.set(o);const i=typeof o=="string"?o:`#${xe.getHexString()}`,d=`text-${i}-${a.join("")}`;if(K[d])return K[d];const f=1024,l=n?f/n:f,[m,u]=ke(f,l);u.textAlign=t||"center";let y=16;u.textAlign==="center"&&(y=.5*f);let p=16;a.forEach((v,b)=>{const C=s!==void 0?s:64;u.strokeStyle=G,u.font=`${C}px monospace`,u.textBaseline="top",u.lineWidth=8,u.strokeText(v,y,p+C*b),u.fillStyle=i,u.fillText(v,y,p+C*b)});const M=new c.CanvasTexture(m),h=new c.MeshBasicMaterial({map:M,transparent:!0});return K[d]=h,h},rt=(a,e)=>{const[r,t]=ke();t.fillStyle=G,t.strokeStyle=G,t.lineWidth=8,t.beginPath(),t.arc(1024/2,1024/2,20,0,2*Math.PI),t.stroke(),t.save(),t.translate(1024/2,1024/2),t.beginPath();for(var n=4.5,s=60,i=2*Math.PI/s,d=3/2*Math.PI+i;d<20*Math.PI;){var f=d*Math.cos(d)*n,l=d*Math.sin(d)*n;t.lineTo(f,l),d=d+i}t.stroke(),t.restore(),t.beginPath(),t.arc(1024/2,1024/2,288,0,2*Math.PI),t.stroke(),t.lineWidth=32,t.beginPath(),t.arc(1024/2,1024/2,496,0,2*Math.PI),t.stroke(),t.textAlign="center",a&&(t.font="64px monospace",t.textBaseline="middle",t.strokeStyle=G,t.lineWidth=8,t.strokeText(a,.5*1024,.42*1024),t.fillStyle=le,t.fillText(a,.5*1024,.42*1024)),e&&(t.font="96px monospace",t.textBaseline="bottom",t.fillStyle=Z,t.strokeText(e,.5*1024,.68*1024),t.fillText(e,.5*1024,.68*1024));const m=new c.CanvasTexture(r);return m.encoding=c.LinearSRGBColorSpace,new c.MeshBasicMaterial({map:m,transparent:!0})},at=({color:a,artist:e,title:o})=>{const r=new c.Group,t=new c.RingGeometry(4,7,32);t.translate(0,0,-.001),t.scale(_,_,_);const n=de(a,{glow:!0});r.add(new c.Mesh(t,n));const s=new c.RingGeometry(.25,4,32);s.scale(_,_,_),s.translate(0,0,-.001);const i=de(new c.Color(oe),{});r.add(new c.Mesh(s,i));const d=new c.PlaneGeometry(14.2,14.2);d.translate(0,0,.102),d.scale(_,_,_);const f=rt(e,o);r.add(new c.Mesh(d,f));const l=r.clone();l.rotation.set(0,Math.PI,0),r.add(l);const m=new c.RingGeometry(7,7.5,32);m.scale(_,_,_);const u=de(oe,{glow:!0});u.emissiveIntensity=1;const y=new c.Mesh(m,u);y.visible=!1,y.name="highlight",r.add(y);const p=y.clone();return p.name="combo",p.material=p.material.clone(),r.add(p),N.Instance.on("progress",M=>{p.visible=M.bestComboUsedVinyls.includes(r.userData.recordIndex),p.material.color.set(pe[M.bestComboType]),p.material.needsUpdate=!0}),r},it=a=>a*a,ct=a=>a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2,lt=a=>.5*Math.cos(2*a*Math.PI+Math.PI)+.5;class O{static _instance;animations;scene;clock;constructor(){this.animations=[],this.scene=null,this.clock=new c.Clock}static get Instance(){return O._instance||(O._instance=new O),O._instance}initScene(e){this.scene||(this.scene=e,this.clock.start())}update(){const e=this.clock.getElapsedTime()*1e3;this.animations=this.animations.filter(o=>{const{mesh:r,start:t,end:n,easeFunc:s,loop:i}=o,d=e-o.startTime,f=o.endTime-o.startTime,l=c.MathUtils.clamp(d/f,0,1);if(n.position&&r.position.lerpVectors(t.position,n.position,s(l)),n.rotation){const m=t.rotation,u=n.rotation,y=new c.Euler;y.order=m.order||c.Euler.DefaultOrder,y.x=m.x+(u.x-m.x)*s(l),y.y=m.y+(u.y-m.y)*s(l),y.z=m.z+(u.z-m.z)*s(l),r.rotation.copy(y)}return n.scaling&&r.scale.lerpVectors(t.scaling,n.scaling,s(l)),e>=o.endTime?i?(o.startTime=e,o.endTime=e+f,n.position&&r.position.copy(t.position),n.rotation&&r.rotation.copy(t.rotation),n.scaling&&r.scale.copy(t.scaling),!0):(o.resolve&&(o.resolve(),o.resolve=void 0,o.reject=void 0),!1):!0})}animateTransform(e){const{mesh:o,end:r}=e,t=e.duration||1e3,n=e.delay||0,s=e.ease||it,i=this.clock.getElapsedTime()*1e3;let d,f;const l=new Promise((m,u)=>{d=m,f=u});return this.animations.push({mesh:o,start:{position:o.position.clone(),rotation:o.rotation.clone(),scaling:o.scale.clone()},end:r,easeFunc:s,startTime:i+n,endTime:i+n+t,loop:e.loop||!1,resolve:d,reject:f}),l}cancelAnimation(e,o=!1){const r=this.animations.filter(t=>t.mesh===e);r.length&&(r.forEach(t=>{const{end:n}=t;o&&(n.position&&e.position.copy(n.position),n.rotation&&e.rotation.copy(n.rotation),n.scaling&&e.scale.copy(n.scaling)),t.reject&&(t.reject(),t.resolve=void 0,t.reject=void 0)}),this.animations=this.animations.filter(t=>t.mesh!==e))}}class ut{constructor(){this.mOscillators=[this.osc_sin.bind(this),this.osc_square.bind(this),this.osc_saw.bind(this),this.osc_tri.bind(this)],this.mSong=null,this.mLastRow=0,this.mCurrentCol=0,this.mNumWords=0,this.mMixBuf=null}osc_sin(e){return Math.sin(e*6.283184)}osc_saw(e){return 2*(e%1)-1}osc_square(e){return e%1<.5?1:-1}osc_tri(e){var o=e%1*4;return o<2?o-1:3-o}getnotefreq(e){return .003959503758*2**((e-128)/12)}createNote(e,o,r){var t=this.mOscillators[e.i[0]],n=e.i[1],s=e.i[3]/32,i=this.mOscillators[e.i[4]],d=e.i[5],f=e.i[8]/32,l=e.i[9],m=e.i[10]*e.i[10]*4,u=e.i[11]*e.i[11]*4,y=e.i[12]*e.i[12]*4,p=1/y,M=-e.i[13]/16,h=e.i[14],v=r*2**(2-e.i[15]),b=new Int32Array(m+u+y),C=0,w=0,x,I,S,T,R,L;for(x=0,I=0;x<m+u+y;x++,I++)I>=0&&(h=h>>8|(h&255)<<4,I-=v,R=this.getnotefreq(o+(h&15)+e.i[2]-128),L=this.getnotefreq(o+(h&15)+e.i[6]-128)*(1+8e-4*e.i[7])),S=1,x<m?S=x/m:x>=m+u&&(S=(x-m-u)*p,S=(1-S)*3**(M*S)),C+=R*S**s,T=t(C)*n,w+=L*S**f,T+=i(w)*d,l&&(T+=(2*Math.random()-1)*l),b[x]=80*T*S|0;return b}async init(e){return new Promise(o=>{this.mSong=e,this.mLastRow=e.endPattern,this.mCurrentCol=0,this.mNumWords=e.rowLen*e.patternLen*(this.mLastRow+1)*2,this.mMixBuf=new Int32Array(this.mNumWords),o()})}generateChannel(e){return new Promise(o=>{var r,t,n,s,i,d,f,l,m,u,y,p,M=new Int32Array(this.mNumWords),h=this.mSong.songData[e],v=this.mSong.rowLen,b=this.mSong.patternLen,C=0,w=0,x,I,S=!1,T=[];for(n=0;n<=this.mLastRow;++n)for(f=h.p[n],s=0;s<b;++s){var R=f?h.c[f-1].f[s]:0;R&&(h.i[R-1]=h.c[f-1].f[s+b]||0,R<17&&(T=[]));var L=this.mOscillators[h.i[16]],E=h.i[17]/512,P=2**(h.i[18]-9)/v,B=h.i[19],H=h.i[20],U=h.i[21]*43.23529*3.141592/44100,V=1-h.i[22]/255,z=h.i[23]*1e-5,_e=h.i[24]/32,Ve=h.i[25]/512,Ye=6.283184*2**(h.i[26]-9)/v,Ce=h.i[27]/255,ue=h.i[28]*v&-2;for(y=(n*b+s)*v,i=0;i<4;++i)if(d=f?h.c[f-1].n[s+i*b]:0,d){T[d]||(T[d]=this.createNote(h,d,v));var Se=T[d];for(t=0,r=y*2;t<Se.length;t++,r+=2)M[r]+=Se[t]}for(t=0;t<v;t++)l=(y+t)*2,u=M[l],u||S?(p=U,B&&(p*=L(P*l)*E+.5),p=1.5*Math.sin(p),C+=p*w,x=V*(u-w)-C,w+=p*x,u=H==3?w:H==1?x:C,z&&(u*=z,u=u<1?u>-1?this.osc_sin(u*.25):-1:1,u/=z),u*=_e,S=u*u>1e-5,m=Math.sin(Ye*l)*Ve+.5,I=u*(1-m),u*=m):I=0,l>=ue&&(I+=M[l-ue+1]*Ce,u+=M[l-ue]*Ce),M[l]=I|0,M[l+1]=u|0,this.mMixBuf[l]+=I|0,this.mMixBuf[l+1]+=u|0}o()})}async generate(){this.mMixBuf.fill(0),this.mCurrentCol=0;const e=[];for(let o=0;o<this.mSong.numChannels;o++)e.push(this.generateChannel(o));return await Promise.all(e),this.mCurrentCol=this.mSong.numChannels,1}createAudioBuffer(e){for(var o=e.createBuffer(2,this.mNumWords/2,44100),r=0;r<2;r++)for(var t=o.getChannelData(r),n=r;n<this.mNumWords;n+=2)t[n>>1]=this.mMixBuf[n]/65536;return o}createAudioBufferRange(e,o=0,r=null){(r===null||r>this.mNumWords/2)&&(r=this.mNumWords/2),o<0&&(o=0),o>=r&&(o=r-1);const t=r-o;for(var n=e.createBuffer(2,t,44100),s=0;s<2;s++)for(var i=n.getChannelData(s),d=0;d<t;d++){var f=(o+d)*2+s;i[d]=this.mMixBuf[f]/65536}return n}createWave(){var e=44,o=e+this.mNumWords*2-8,r=o-36,t=new Uint8Array(e+this.mNumWords*2);t.set([82,73,70,70,o&255,o>>8&255,o>>16&255,o>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,r&255,r>>8&255,r>>16&255,r>>24&255]);for(var n=0,s=e;n<this.mNumWords;++n){var i=this.mMixBuf[n];i=i<-32767?-32767:i>32767?32767:i,t[s++]=i&255,t[s++]=i>>8&255}return t}createWaveRange(e=0,o=null){(o===null||o>this.mNumWords/2)&&(o=this.mNumWords/2),e<0&&(e=0),e>=o&&(e=o-1);const r=o-e;var t=44,n=t+r*2-8,s=n-36,i=new Uint8Array(t+r*2);i.set([82,73,70,70,n&255,n>>8&255,n>>16&255,n>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,s&255,s>>8&255,s>>16&255,s>>24&255]);for(var d=0,f=t;d<r;++d){var l=this.mMixBuf[(e+d)*2];l=l<-32767?-32767:l>32767?32767:l,i[f++]=l&255,i[f++]=l>>8&255}return i}getData(e,o){for(var r=2*Math.floor(e*44100),t=new Array(o),n=0;n<2*o;n+=1){var s=r+n;t[n]=e>0&&s<this.mMixBuf.length?this.mMixBuf[s]/32768:0}return t}}const dt=.3,k=44100,he=new(window.AudioContext||window.webkitAudioContext),ht=(a=1,e=.05,o=220,r=0,t=0,n=.1,s=0,i=1,d=0,f=0,l=0,m=0,u=0,y=0,p=0,M=0,h=0,v=1,b=0,C=0)=>{let w=2*Math.PI,x=d*=500*w/k**2,I=(0<p?1:-1)*w/4,S=o*=(1+2*e*Math.random()-e)*w/k,T=[],R=0,L=0,E=0,P=1,B=0,H=0,U=0,V,z;for(r=99+k*r,b*=k,t*=k,n*=k,h*=k,f*=500*w/k**3,p*=w/k,l*=w/k,m*=k,u=k*u|0,z=r+b+t+n+h|0;E<z;T[E++]=U)++H%(100*M|0)||(U=s?1<s?2<s?3<s?Math.sin((R%w)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/w%2+2)%2:1-4*Math.abs(Math.round(R/w)-R/w):Math.sin(R),U=(u?1-C+C*Math.sin(2*Math.PI*E/u):1)*(0<U?1:-1)*Math.abs(U)**i*a*dt*(E<r?E/r:E<r+b?1-(E-r)/b*(1-v):E<r+b+t?v:E<z-h?(z-E-h)/n*v:0),U=h?U/2+(h>E?0:(E<z-h?1:(z-E)/h)*T[E-h|0]/2):U),V=(o+=d+=f)*Math.sin(L*p-I),R+=V-V*y*(1-1e9*(Math.sin(E)+1)%2),L+=V-V*y*(1-1e9*(Math.sin(E)**2+1)%2),P&&++P>m&&(o+=l,S+=l,P=0),!u||++B%u||(o=S,d=x,P=P||1);return T},mt=(...a)=>{let e=he.createBufferSource(),o=he.createBuffer(a.length,a[0].length,k);return a.map((r,t)=>o.getChannelData(t).set(r)),e.buffer=o,e.connect(he.destination),e.start(),e},ve=(...a)=>mt(ht(...a));var pt={songData:[{i:[0,255,116,85,0,255,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,136,15,0,32,0,0,0,6],p:[1,1,1,2,,,1,1,2,2],c:[{n:[139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139,,139,,139,,139],f:[]},{n:[140,,140,,,,140,,,,140,,140,,140,,,,140,,140,,,,140,,140,,,,140],f:[]}]},{i:[0,160,128,64,0,160,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,0,6],p:[,1,2,1,2,1,2,1,1,1],c:[{n:[,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,139],f:[]},{n:[,,,,,,,,,,,,139,,139,,,,,,,,,,,,,,139,,139],f:[]}]},{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[,,,,1,,2,1,1,2],c:[{n:[144,,,,,,,,,,,,,,,,144],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,156,,,,,,,,,,,,,,,,156],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,,,1,1,1,1,2,2],c:[{n:[132,,,,,,,,132,,,,,,,,144,,,,,,,,144],f:[]},{n:[],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[,,2,1,,2,1,2,2,1],c:[{n:[144,,,,144,,,,144,,,,142,,142,,144,,144,,144,,,,144,,,,144,,,,147,,,,151,,,,147,,,,149,,149,,147,,147,,151,,,,147,,,,147,,,,151,,,,154,,,,151,,,,151,,151,,151,,151,,154,,,,151,,,,151],f:[]},{n:[144,144,144,,144,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,147,147,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,151,151,,151],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:5};const ne=new AudioContext;let $=0;N.Instance.on("progress",a=>{const e=a.bestComboCount||0;$=Math.min(e,6)});const Ue=()=>ve(void 0,void 0,143,.03,.17,.09,2,1.5,10,-17,void 0,void 0,void 0,void 0,4,void 0,void 0,.73,.09),ft=()=>ve(void 0,0,void 0,void 0,.07,.12,void 0,3.4,void 0,void 0,109,.07,void 0,void 0,void 0,void 0,void 0,.6,.05,void 0,-1428),gt=()=>ve(2.07,0,130.81,.01,.26,.47,3,1.15,void 0,.1,void 0,void 0,.05,void 0,void 0,void 0,.14,.26,.15,.02),yt=async()=>{const a=new ut;await a.init(pt),await a.generate();const e=[];for(let l=0;l<6;l++){const m=l*176400,u=m+176400,y=a.createAudioBufferRange(ne,m,u);e.push(y)}const o=6*176400,r=o+705600,t=a.createAudioBufferRange(ne,o,r),n=[...e,t];let s=null,i=!1;const d=l=>{s&&(s.stop(),s.disconnect());let m;l<6?m=l:m=6;const u=n[m];s=ne.createBufferSource(),s.buffer=u,s.connect(ne.destination),s.loop=!0,s.start();const y=setInterval(()=>{N.Instance.emit("downbeat"),$!==l&&(clearInterval(y),d($))},2e3);i=!0};return d($),{source:s,stop:()=>{i=!1,s&&(s.stop(),s.disconnect(),s=null)},playSequence:l=>{$=l,d(l)},getCurrentSequence:()=>$,isPlaying:()=>i}},Ie=["Light Blue","Yellow","Orange","Red","Purple","Blue","Green","Lime","Pink","Silver"],wt=a=>{const[e,o,r,t,n,s,i,d,f,l,m,u,y,p,M]=a.split(","),h=g(r),v=g(t),b=g(n),C=g(s),w=g(i),x=g(d),I=g(u),S=g(y),T=g(p),R=g(f),L=g(l),E=g(m),P=Math.sqrt(h*h+h*h)/2,B=new c.CylinderGeometry(0,P,v,4,1,!1,Math.PI/4);return B.scale(1,1,b/h),B.translate(C-I,w-S+.3*v,x-T),B.rotateX(c.MathUtils.degToRad(R)),B.rotateY(c.MathUtils.degToRad(L)),B.rotateZ(c.MathUtils.degToRad(E)),B},bt=a=>{const[e,o,r,t,n,s,i,d,f,l,m,u,y,p,M]=a.split(","),h=g(r),v=g(t),b=g(n),C=g(s),w=g(i),x=g(d),I=g(u),S=g(y),T=g(p),R=g(f),L=g(l),E=g(m),P=new c.BoxGeometry(h,v,b);return P.translate(C-I,w-S,x-T),P.rotateX(c.MathUtils.degToRad(R)),P.rotateY(c.MathUtils.degToRad(L)),P.rotateZ(c.MathUtils.degToRad(E)),P.computeBoundingBox(),P},Mt=a=>{const[e,o,r,t,n,s,i,d,f,l,m,u,y,p,M]=a.split(","),h=g(r),v=g(t),b=g(n),C=g(s),w=g(i),x=g(d),I=g(u),S=g(y),T=g(p),R=g(f),L=g(l),E=g(m),P=new c.SphereGeometry(h/2,32,16);return P.scale(h/h,v/h,b/h),P.translate(C-I,w-S,x-T),P.rotateX(c.MathUtils.degToRad(R)),P.rotateY(c.MathUtils.degToRad(L)),P.rotateZ(c.MathUtils.degToRad(E)),P},vt=a=>{const[e,o,r,t,n,s,i,d,f,l,m,u,y,p,M]=a.split(","),h=g(r),v=g(t),b=g(s),C=g(i),w=g(d),x=g(u),I=g(y),S=g(p),T=g(f),R=g(l),L=g(m),E=new c.PlaneGeometry(h,v);return E.rotateX(c.MathUtils.degToRad(-90)),E.translate(b-x,C-I,w-S),E.rotateX(c.MathUtils.degToRad(T)),E.rotateY(c.MathUtils.degToRad(R)),E.rotateZ(c.MathUtils.degToRad(L)),E.computeBoundingBox(),E},Ct=a=>{const[e,o,r,t,n,s,i,d,f,l,m,u,y,p,M]=a.split(","),h=g(r),v=g(t),b=g(n),C=g(s),w=g(i),x=g(d),I=g(u),S=g(y),T=g(p),R=g(f),L=g(l),E=g(m),P=h/2,B=new c.CylinderGeometry(P,P,v,32);B.translate(C-I,w-S,x-T),B.scale(1,1,b/h);const H=c.MathUtils.degToRad(R),U=c.MathUtils.degToRad(L),V=c.MathUtils.degToRad(E),z=new c.Euler(H,U,V);return B.applyQuaternion(new c.Quaternion().setFromEuler(z)),B.computeBoundingBox(),B},St=a=>{const[e]=a.split(",");switch(e){case"c":return bt(a);case"s":return Mt(a);case"p":return vt(a);case"cy":return Ct(a);case"py":return wt(a);default:throw new Error(`Unknown shape: ${e}`)}},j=(a,e)=>{const{palette:o={},glow:r=!1}=e,t=new c.Group;t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1);const n={...$e,...o};return a.forEach(s=>{if(s===null){console.error("ITEM IS NULL");return}if(Array.isArray(s))t.add(j(s,{palette:n,glow:r}));else{const[i,d,f,l,m,u,y,p,M,h,v,b,C,w,x]=s.split(","),I=St(s);let S=new c.MeshStandardMaterial({color:n[Ie[x]],side:c.DoubleSide});r&&(S.emissive=new c.Color(n[Ie[x]]),S.emissiveIntensity=1);const T=new c.Mesh(I,S);T.name=d,T.position.set(b,C,w),t.add(T)}}),t},Et=()=>[["c,desk,2,0.1,1,,0.85,-0.5,,,,,-0.1,,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.85,,,,0.1,,-0.9,6","c,leg,0.1,0.8,0.1,-0.85,0.4,-0.15,,,,0.1,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.15,,,,1.8,,-0.2,6","c,leg,0.1,0.8,0.1,0.85,0.4,-0.85,,,,1.8,,-0.9,6","c,record-rack,0.4,0.1,0.8,0.7,0.95,-0.5,,,,0.7,0.95,-0.5,0","c,cube,0.3,0.1,0.4,-0.75,0.95,-0.3,,,,-0.75,0.95,-0.3,9","c,cube,0.4,0.1,0.4,-0.3,0.95,-0.3,,,,-0.3,0.95,-0.3,9","c,tableA,0.4,0.1,0.4,0.2,0.95,-0.3,,,,0.2,1.01,-0.3,0","cy,pad,0.4,0.02,0.4,0.2,1,-0.3,,,,0.2,1,-0.3,3"],"c,cube,22,1,4,,-1.5,-23,,,,,-2,-15,2","c,floor,20,1,20,,-2.5,-11,,,,,-3,-4,3","c,cube,20,1,6,,-2.5,2,,,,,-3,5,3","c,cube,8,2,3,,-1,0.5,,,,,-1,-4,2","c,pillar,1,4,1,6.5,,-6.5,,,,7,,-7,6","c,pillar,1,4,1,6.5,,-10.5,,,,7,,-11,6","c,pillar,1,3,1,6.5,0.5,-14.5,,,,7,,-15,6","c,pillar,1,4,1,6.5,,-18.5,,,,7,,-19,6","c,pillar,1,4,1,6.5,,-14.5,,,,7,,-15,6","c,pillar,1,4,1,-6.5,,-6.5,,,,-6,,-7,6","c,pillar,1,4,1,-6.5,,-2.5,,,,-6,,-3,6","c,pillar,1,4,1,6.5,,-2.5,,,,7,,-3,6","c,pillar,1,4,1,-6.5,,-10.5,,,,-6,,-11,6","c,pillar,1,4,1,-6.5,,-14.5,,,,-6,,-15,6","c,pillar,1,4,1,-6.5,,-18.5,,,,-6,,-19,6","c,cube,4,1,20,8,2.5,-11,,,,7,2,-3,1","c,cube,4,1,20,-8,2.5,-11,,,,-9,2,-3,1"],xt=()=>["s,head,20,16,16,,8,,,,,,8,,4","s,head,16,16,16,,-5,,,,,,-5,,4",["cy,leftEye,4,1,4,-3,10,-7.1,-71,-5,16,-3,10,-7.1,1","s,leftPupil,2,2,4,-2.8,10.1,-7,-75,7,10,-2.8,10.1,-7,4","cy,rightEye,4,1,4,3,10,-7.2,-71,5,-17,3,10,-7.2,1","s,rightPupil,2,2,4,2.9,10,-7.1,-74,-4,-12,2.9,10,-7.1,4"],["c,rightCheek,4,4,2,1.84,6.03,-7.5,-25,,80,2.34,6.53,-7.5,9","c,leftCheek,4,4,2,-2.91,5.98,-7.5,,23,10,-2.41,6.48,-7.5,9","c,tongue,2,2,2,,5,-7,,,,,4,-7,3","py,pyramid,3,1.6,1,,8.2,-8,-180,,,,8.2,-8,8"],["py,ear,6,7,4,-4.86,13.55,-1.28,-14,20,31,-4.86,13.55,-1.28,4","py,ear,6,7,4,5.14,13.55,-1.28,-11,-15,-33,5.14,13.55,-1.28,4","py,ear,5.2,6.2,3.4,5.14,13.15,-1.78,-9,-16,-33,5.14,13.15,-1.78,1","py,ear,5,5.5,3.8,-5.04,13.54,-1.59,-17,19,32,-5.04,13.54,-1.59,1"],["cy,cylinder,0.2,11,0.2,-7.93,6,-10.12,,-15,90,-7.93,6,-10.12,9","cy,cylinder,0.2,9.2,0.2,-6.87,7.72,-9,,-15,75,-6.87,7.72,-9,9","cy,cylinder,0.2,9,0.2,-7.07,3.78,-9.3,,-15,105,-7.07,3.78,-9.3,9","cy,cylinder,0.2,7.8,0.2,6.87,7.62,-8.9,180,-15,-105,6.87,7.62,-8.9,9","cy,cylinder,0.2,9.4,0.2,6.93,6,-9.52,,-165,90,6.93,6,-9.52,9","cy,cylinder,0.2,8.8,0.2,6.87,3.88,-9.1,180,-15,-75,6.87,3.88,-9.1,9"]],It=[{Purple:ie,Silver:Ae,Yellow:se,Red:F},{Purple:ye,Silver:we,Yellow:Xe,Red:F},{Purple:We,Silver:se,Yellow:be,Red:F}],Nt=a=>{const e=new c.Group;e.name="Crowd";const o=new c.Object3D,r=8,t=10,n=new c.BoxGeometry(.5,.5,.5),s=new c.MeshStandardMaterial,i=new c.InstancedMesh(n,s,r*t);i.instanceMatrix.setUsage(c.DynamicDrawUsage);const d=new c.BoxGeometry(.2,.2,.6),f=new c.MeshStandardMaterial,l=new c.InstancedMesh(d,f,r*t*2);l.instanceMatrix.setUsage(c.DynamicDrawUsage);const m=new c.Color,u=new c.Color;e.add(i),e.add(l);const y=new c.Vector3(0,-1,0),p=[],M=[];for(let h=0;h<r;h++)for(let v=0;v<t;v++){const b=v+h*r,C=nt(It),w=new c.Vector3(2*v-t+.5+h%2*1,0,2*h-r+.5);Math.abs(w.x)>=5&&(w.y+=5);const x=new c.Vector3(c.MathUtils.randFloatSpread(.3),c.MathUtils.randFloatSpread(.1),c.MathUtils.randFloatSpread(.3));w.add(x),o.position.copy(w).add(y),o.lookAt(0,6,0),o.updateMatrix(),i.setMatrixAt(b,o.matrix),m.setStyle(C.Purple),i.setColorAt(b,m);for(let I=0;I<2;I++){const S=b*2+I;o.position.copy(w),o.updateMatrix(),l.setMatrixAt(S,o.matrix),u.setStyle(C.Purple),l.setColorAt(S,u)}p.push({positionOffset:w,poseDelay:c.MathUtils.randInt(0,15),palette:C})}return N.Instance.on("tick",()=>{if(!a.xr?.getCamera())return;const h=a.xr?.getCamera(),v={controllers:[]};if([0,1].forEach(b=>{const C=a.xr?.getController(b);if(C){const w=C.getObjectByName("paw");w&&v.controllers.push(w.matrixWorld.clone())}}),h&&(v.camera=h.matrix.clone(),M.push(v),M.length>60&&M.shift()),M.length==0){i.visible=!1,l.visible=!1;return}p.forEach((b,C)=>{const w=M[Math.max(0,M.length-1-b.poseDelay)];w?.camera&&(o.matrix.copy(w.camera),o.matrix.decompose(o.position,o.quaternion,o.scale),o.position.add(b.positionOffset).add(y),o.updateMatrix(),i.setMatrixAt(C,o.matrix),w.controllers.forEach((x,I)=>{const S=C*2+I;o.matrix.copy(x),o.matrix.decompose(o.position,o.quaternion,o.scale),o.position.add(b.positionOffset).add(y),o.position.add(new c.Vector3(I===0?-.1:.1,.2,-.3)),o.updateMatrix(),l.setMatrixAt(S,o.matrix)}))}),i.instanceMatrix.needsUpdate=!0,l.instanceMatrix.needsUpdate=!0}),e},Tt=()=>[["c,case1,1,8,2,7.5,7,,,,,7.5,7,,5","c,case2,3,9,2,5.5,7.5,,,,,5.5,7.5,,5","c,case3,8,4,2,,10,,,,,,11.5,,5","c,case4,8,1,2,,5.5,,,,,,5.5,,5","c,case5,3,9,2,-5.5,7.5,,,,,-5.5,7.5,,5","c,case6,1,8,2,-7.5,7,,,,,-7.5,7,,5"],"c,base,12,2.1,2.8,,3.95,,,,,,3,,3","c,rightReel,2,2,1,2.72,6.89,,,,-45,2.72,6.89,,2","c,rightTape,4,4,0.2,2.81,6.91,-0.1,,,-45,2.81,6.91,-0.1,4","c,leftReel,2,2,1,-2.69,6.91,,,,-45,-2.75,7,,2","cy,base,16,8,16,,-4,,,,,,-4,,6","c,label,12,2,2.2,,10,,,,,,9,1,9"],Pt=()=>{const a=j(Tt(),{palette:{Blue:Be,Silver:be,Red:F,Orange:se,Purple:De,Green:Z},glow:!0});return O.Instance.animateTransform({mesh:a,end:{rotation:new c.Euler(0,2*Math.PI-.01,0)},duration:16e3,ease:e=>e,loop:!0}),a},Rt=()=>["cy,lid,3.9,0.1,3.9,-0.27,2.1,,,,30,-0.27,2.1,,9","cy,label,4,0.8,4,,0.5,,,,,,0.5,,5","cy,can,3.9,1,3.9,,0.5,,,,,,0.5,,9","cy,tuna,3.8,0.6,3.8,,0.8,,,,,,0.8,,8"],Ot=()=>{const a=j(Rt(),{palette:{Blue:Me,Red:F,Silver:oe}});return a.scale.set(.03125,.03125,.03125),a.userData.isPickable=!0,a.onPointerPick=e=>{Ue()},a};class Lt{clock;parent;_mesh;geometry;constructor(){this.clock=new c.Clock,this.parent=new c.Group,this.parent.name="Grid",this.geometry=new c.PlaneGeometry(20,26,20,26),this.geometry.rotateX(Math.PI/2),this._mesh=new c.Mesh(this.geometry,new c.MeshBasicMaterial({color:"#ff00ff",wireframe:!0})),this.parent.add(this._mesh),N.Instance.on("tick",e=>{const o=this.geometry.getAttribute("position");for(let r=0;r<o.array.length;r+=3){const t=o.array[r],n=o.array[r+2];o.array[r+1]=.5*Math.sin(Math.sqrt(t*t+n*n)-2*this.clock.getElapsedTime())}o.needsUpdate=!0}),N.Instance.on("progress",e=>{!this._mesh.material.visible&&e.bestComboCount>=2&&(this._mesh.position.set(0,-5,0),O.Instance.animateTransform({mesh:this._mesh,end:{position:new c.Vector3(0,0,0)},ease:ct,duration:2e3})),this._mesh.material.visible=e.bestComboCount>5})}get mesh(){return this.parent}}const Bt=()=>{const a=new c.Group;a.name="debugScreen",a.renderOrder=1;const e=["You win!","Thanks for playing","Created by Alex Swan"],o=new c.PlaneGeometry(5,5);o.translate(0,-2,0);const r=Ge(e,{color:"white"}),t=new c.Mesh(o,r);return a.add(t),t.position.set(0,0,-20),t.scale.set(.1,.1,.1),t.rotation.set(-Math.PI/2,0,0),t.visible=!1,N.Instance.on("progress",n=>{n.color.solved&&n.artist.solved&&n.title.solved&&(t.userData.solved=!0,t.visible=!0,t.material.needsUpdate=!0,O.Instance.animateTransform({mesh:t,end:{position:{x:0,y:0,z:0},scaling:{x:1,y:1,z:1},rotation:new c.Euler(0,0,0)},duration:1e3}))}),a},Dt=()=>["c,base,13,1,3,-1.5,0.5,-0.5,,,,,,,5",["c,panel,12.4,2.7,1,-1.5,2.45,0.3,-60,,,-1.5,1.1,0.88,6","c,display-back,11.8,0.8,0.1,-1.5,3.2,0.85,-60,,,-1.5,1.1,0.88,3","c,progress-color-0,1.8,0.3,0.1,-6.5,2.45,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-color-1,1.8,0.3,0.1,-4.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-2,1.8,0.3,0.1,-2.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-3,1.8,0.3,0.1,-0.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-4,1.8,0.3,0.1,1.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-color-5,1.8,0.3,0.1,3.5,2.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-1,1.8,0.3,0.1,-4.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-2,1.8,0.3,0.1,-2.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-3,1.8,0.3,0.1,-0.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-4,1.8,0.3,0.1,1.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-5,1.8,0.3,0.1,3.5,1.95,0.85,-60,,,0.5,1.1,0.88,9","c,progress-artist-0,1.8,0.3,0.1,-6.5,1.95,0.85,-60,,,-11.5,1.1,0.88,9","c,progress-title-1,1.8,0.3,0.1,-4.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-2,1.8,0.3,0.1,-2.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-3,1.8,0.3,0.1,-0.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-4,1.8,0.3,0.1,1.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-5,1.8,0.3,0.1,3.5,1.45,0.85,-60,,,0.5,1.1,0.88,9","c,progress-title-0,1.8,0.3,0.1,-6.5,1.45,0.85,-60,,,-11.5,1.1,0.88,9","p,display,11.8,0.8,,-1.5,2.22,-0.88,30,,,-1.5,2.22,-0.88,8"]],At=()=>{const a=j(Dt(),{palette:{Red:G,Green:se,Blue:Z,Silver:G}});return a.scale.set(.1,.1,.1),N.Instance.on("progress",e=>{const o=a.getObjectByName("display");o.material=Ge([e.displayText],{color:pe[e.bestComboType],textAlign:"left",ratio:11.8/.8,fontSize:Je[e.bestComboType]}),tt.forEach(r=>{for(let t=0;t<6;t++){const n=a.getObjectByName(`progress-${r}-${t}`);if(!n)continue;let s=ie;(e[r].solved||t<e[r].correctCount)&&(s=pe[r]),(e[r].solved||t<e[r].correctCount)&&r==="color"&&(s=Ke[t]);const i=s!==ie;n.material.color.set(s),n.material.emissive.set(i?s:G),n.material.emissiveIntensity=i?1:0,n.material.needsUpdate=!0}})}),a},kt=a=>{const e=new c.Group;e.name="Runner";let o=[ce,ye,we,le,Z,Le],r=[(s,i)=>s===0||i===0,(s,i)=>s===1||i===1,(s,i)=>s===2||i===2,(s,i)=>s===3||i===3,(s,i)=>s===4||i===4,(s,i)=>s===5||i===5,(s,i)=>i+s===0||2*a-s-i-2===0,(s,i)=>i+s===1||2*a-s-i-2===1,(s,i)=>i+s===2||2*a-s-i-2===2,(s,i)=>i+s===3||2*a-s-i-2===3,(s,i)=>i+s===4||2*a-s-i-2===4,(s,i)=>i+s===5||2*a-s-i-2===5,(s,i)=>(s+i)%2===0,(s,i)=>(s+i)%2===1,(s,i)=>(s+i)%2===0,(s,i)=>(s+i)%2===1,(s,i)=>(s+i)%2===0,(s,i)=>(s+i)%2===1];for(;o.length<a;)o.push(...o);o=o.slice(0,a);let t=-2;const n=new c.BoxGeometry;n.translate(.5,.5,.5),n.scale(.9,1.1,.9);for(let s=0;s<a;s++)for(let i=0;i<a;i++){const d=new c.MeshStandardMaterial({color:G}),f=new c.Mesh(n,d);f.name=`runner-${i}-${s}`,f.userData.x=i,f.userData.y=s,f.position.set(-a/2+i,0,-a/2+s),e.attach(f)}return N.Instance.on("beat",()=>{if(t+=1,t<0)return;const s=o[t%o.length];e.children.forEach(i=>{const{x:d,y:f}=i.userData,l=r[t%r.length](d,f),m=l?s:G;i.material.needsUpdate=!0,i.material.color.set(m),i.material.emissive.set(l?m:G),i.material.needsUpdate=!0,i.material.emissiveIntensity=l?1:0,l&&O.Instance.animateTransform({mesh:i,end:{scaling:new c.Vector3(1,l?1.1:1,1)},duration:500,ease:lt})}),N.Instance.emit("roomGlow",s)}),e},Gt=a=>{const e=j(Et(),{palette:{Green:Ze,Yellow:se,Orange:qe,Red:je,"Light Blue":Z}}),o=At();e.add(o),o.position.set(-.1,.9,-.7);const r=Ot();e.add(r),r.position.set(-.4,1,-.3);const t=Nt(a);t.name="Crowd",e.add(t),t.position.set(0,-1,-10),t.rotation.set(0,Math.PI,0);const n=j(xt(),{palette:{Purple:"#333333",Silver:"#888888"}});n.name="catMesh",n.position.set(-3,1,0),n.scale.set(.1,.1,.1),n.rotation.set(0,-Math.PI/4,0),e.attach(n);const s=n.clone(!0);s.name="catMesh2",s.position.set(3,1,0),s.rotation.set(0,Math.PI/4,0),e.attach(s);const i=Pt();e.add(i),i.position.set(0,0,-30);const d=new Lt;e.add(d.mesh),d.mesh.position.set(0,-1,-7);const f=Bt();e.add(f),f.position.set(0,2,-1);const l=kt(6);return e.add(l),l.position.set(0,-3,-10),l.scale.set(2,1,2),e},Ut=()=>["cy,cylinder,4,6,2,,-1,,,,,,-1,,4","s,sphere,4,4,2,,2,,,,,,2,,4","c,cube,0.3,1,0.3,-1.15,3.5,-0.55,-77,,,-1.15,3.5,-0.55,9","c,cube,0.3,1,0.3,-0.45,3.9,-0.55,-77,,,-0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,0.45,3.9,-0.55,-77,,,0.45,3.9,-0.55,9","c,cube,0.3,1,0.3,1.05,3.6,-0.55,-77,,,1.05,3.6,-0.55,9","c,cube,2,0.7,0.4,,1.85,-0.9,,,,,1.5,-0.1,3","c,cube,0.8,0.5,1.1,,2.45,-0.55,,,,,2.2,-0.1,3","c,cube,0.3,0.6,0.6,-1.15,2.7,-0.8,,,,-1.15,2.7,-0.1,3","c,cube,0.3,0.6,0.6,-0.45,3.1,-0.8,,,,-0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,0.45,3.1,-0.8,,,,0.45,3.1,-0.1,3","c,cube,0.3,0.6,0.6,1.05,2.7,-0.8,,,,1.05,2.7,-0.1,3"],zt={Purple:ie,Red:F,Silver:oe},_t=(a={})=>{const e=new c.Group;e.name="paw";const o=j(Ut(),{palette:{...zt,...a}});o.scale.set(.03125,.03125,.03125),o.rotation.set(3*Math.PI/2,0,0),e.attach(o);const r=new c.PointLight(F,.5,4);return e.attach(r),e},Vt=()=>["c,cube,6,6,8,,,,,,,,-3,,2","c,cube,4,4,11.1,,,-0.55,,,,,-3,,2","c,cube,2,2,2,-2,,-5,,,,-2,-1,-5,4","c,cube,2,2,2,2,,-5,,,,2,-1,-5,4","c,cube,2,6,2,,,6,,,,,-3,7,2","c,cube,1,4,6,,-3,9.5,15,,,,-3,8.5,9","c,cube,1,5,7,,2.5,9.9,-15,,,,2,8.4,2","c,cube,2,5,6,,2.2,,-30,,,,2.7,,2","c,cube,1,2,2,-2.5,-4,-2,,,-40,-3,-3,-2,9","c,cube,3,1,4,-4.5,-3.5,4,,,20,-3,-3,3,9","c,cube,1,2,2,2.5,-4,-2,,,40,3,-3,-2,9","c,cube,3,1,4,4.5,-3.5,4,,,-25,3,-3,3,9"],Ne=[{Orange:Be,Purple:G,Silver:be},{Orange:He,Purple:G,Silver:Me},{Orange:Fe,Purple:De,Silver:Ae}],Yt=new c.Vector3(.05,.05,.05),Xt=()=>{const a=new c.Group;a.name="FishSwirl";const e=[];let o=!0;for(let r=0;r<10;r++){const t=Ne[c.MathUtils.randInt(0,Ne.length-1)],s=j(Vt(),{palette:t,glow:!0}).clone(!0);s.userData.velocity=new c.Vector3(0,5+3*Math.random(),-5),s.userData.isPickable=!0,s.onPointerPick=i=>{gt(),s.userData.velocity.set(0,20,0)},s.position.set(Math.random()*10-5,0,0),e.push(s),a.attach(s),s.scale.set(0,0,0)}return N.Instance.on("tick",r=>{e.forEach(t=>{if(t.userData.velocity.y-=10*r,t.position.addScaledVector(t.userData.velocity,r),t.position.y<-2){const s=new c.Vector3(Math.random()*4-2,0,Math.random()*4-2).sub(t.position).normalize(),i=new c.Quaternion;i.setFromUnitVectors(new c.Vector3(0,0,-1),s),t.quaternion.copy(i),t.position.y=-2;const d=new c.Vector3(0,0,-1);d.applyQuaternion(t.quaternion),d.multiplyScalar(5),t.userData.velocity.x=d.x,t.userData.velocity.z=d.z,t.userData.velocity.y=7+6*Math.random()}const n=new c.Quaternion;n.setFromUnitVectors(new c.Vector3(0,0,-1),t.userData.velocity),t.quaternion.copy(n)})}),N.Instance.on("progress",r=>{const t=r.bestComboCount>=4,n=t!==o;e.forEach(s=>{n&&(O.Instance.cancelAnimation(s),O.Instance.animateTransform({mesh:s,end:{scaling:t?Yt:new c.Vector3(0,0,0)},duration:t?2e3:1e3}))}),o=t}),a},Wt=()=>{const a=new c.Group;a.name="Sky";const e=new c.Object3D,o=30,r=.05,t=new c.BoxGeometry,n=new c.MeshStandardMaterial;n.emissive=new c.Color(Z),n.emissiveIntensity=.2;const s=[];let i=[0],d=0,f=0;const l=new c.InstancedMesh(t,n,o*o);l.instanceMatrix.setUsage(c.DynamicDrawUsage);const m=new c.Color;let u=0;for(let y=0;y<o;y++)for(let p=0;p<o;p++){const M=Ee(0,2*p*Math.PI/o,15);M.z=-y*4,e.position.copy(M),e.scale.set(1,1,2),e.updateMatrix(),m.setHSL(.6,.5+Math.random()*.5,.25+Math.random()*.5),s.push(m.getHex()),l.setMatrixAt(u,e.matrix),l.setColorAt(u,m),u++}return a.add(l),N.Instance.on("tick",y=>{d+=y;for(let p=0;p<i.length;p++)i[p]+=y*4;i=i.filter(p=>p<10);for(let p=0;p<l.count;p++){l.getMatrixAt(p,e.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const M=Math.floor(p/o),h=M%2?1:-1,v=p%o,b=-M*4,C=2*v*Math.PI/o,w=r*h*d,x=i.some(S=>M===Math.floor(S*4));e.position.copy(Ee(0,C+w,15)),e.position.z=b+f*h*Math.sin(d),e.updateMatrix(),l.setMatrixAt(p,e.matrix),l.setColorAt(p,x?m.setStyle(oe):m.setHex(s[p]))}l.instanceMatrix.needsUpdate=!0,l.instanceColor.needsUpdate=!0}),N.Instance.on("progress",y=>{f=y.bestComboCount>=6?1:0,i.push(0)}),a},qt=new c.Clock;let te=0,q,D,fe,A,Y,X,W;const ge=[];let Te;const me=new c.Vector3(0,0,.3),Pe=new c.Color,jt=async()=>{document.getElementById("p").setAttribute("disabled","true"),document.getElementById("p").innerHTML="LOADING...",A=new c.WebGLRenderer({antialias:!0}),A.setPixelRatio(window.devicePixelRatio),A.setSize(window.innerWidth,window.innerHeight),A.setClearColor("#000000"),A.xr.addEventListener("sessionstart",Zt),A.xr.enabled=!0,A.setAnimationLoop(Ht),document.body.appendChild(st.createButton(A)),document.body.appendChild(A.domElement);const a=new ot;D=new c.Scene,q=new c.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),q.position.set(0,2,1),q.rotation.set(-1*Math.PI/12,0,0),q.name="camera",D.add(q),O.Instance.initScene(D);const e=new c.Color().setStyle("#888888"),o=new c.AmbientLight(e,.2);o.name="ambientLight",D.add(o);const r=new c.Color().setStyle("#ffffff"),t=new c.DirectionalLight(r,.3);t.name="directionalLight",t.position.set(6,10,8),t.castShadow=!0,t.target.position.set(0,0,0),D.add(t),D.add(t.target);const n=Wt();n.position.set(0,0,5),D.add(n);const s=Gt(A);D.add(s);const i=s.getObjectByName("tableA"),d=s.getObjectByName("pad"),f=Xt();f.position.set(0,0,-10),D.attach(f),a.vinyls.forEach((l,m)=>{const u=at(l);u.name=`vinyl-${m}`;const y=new c.Vector3(.7,1.15,-.2-.125*m);u.position.copy(y),u.userData.originalPosition=y,u.userData.isPickable=!0,u.userData.recordIndex=m,u.userData.returnToOriginalPosition=()=>{D.attach(u),O.Instance.cancelAnimation(u),O.Instance.animateTransform({mesh:u,end:{position:u.userData.originalPosition,rotation:new c.Euler(0,0,0)},duration:100})},u.onPointerPick=p=>{if(p.userData.selected||a.isSolved())return;a.selected[p.id]=m;const M=p.getObjectByName("target");M&&(O.Instance.cancelAnimation(u),M.attach(u),O.Instance.animateTransform({mesh:u,end:{position:new c.Vector3(0,0,0),rotation:new c.Euler(0,Math.PI/2,0)},duration:60}),p.userData.selected=u,d.material.emissive.setStyle(Me))},u.onPointerDrop=p=>{if(O.Instance.cancelAnimation(u,!0),d.material.emissive.setStyle(G),u.getWorldPosition(new c.Vector3).distanceTo(i.getWorldPosition(new c.Vector3))<.3){a.addVinylByIndex(u.userData.recordIndex),delete a.selected[p.id],p.userData.selected=void 0,i.children.forEach(h=>{h.userData.returnToOriginalPosition&&h.userData.returnToOriginalPosition()}),i.attach(u),O.Instance.animateTransform({mesh:u,end:{position:new c.Vector3(0,.01,0),rotation:new c.Euler(-1*Math.PI/2,0,0)},duration:60}).then(()=>{O.Instance.animateTransform({mesh:u,end:{rotation:new c.Euler(-1*Math.PI/2,0,-2*Math.PI)},ease:h=>h,duration:1800,loop:!0})});return}else u.userData.returnToOriginalPosition(),p.userData.selected=void 0},D.add(u)}),X=A.xr.getController(0),X.addEventListener("connected",Re),X.addEventListener("selectstart",re),X.addEventListener("selectend",ae),X.addEventListener("squeezestart",re),X.addEventListener("squeezeend",ae),D.add(X),W=A.xr.getController(1),W.addEventListener("connected",Re),W.addEventListener("selectstart",re),W.addEventListener("selectend",ae),W.addEventListener("squeezestart",re),W.addEventListener("squeezeend",ae),D.add(W),fe=new c.Raycaster,window.addEventListener("resize",$t,!1),N.Instance.on("comboBroken",l=>{l?Ue():ft()}),N.Instance.on("roomGlow",l=>{const m=D.getObjectByName("ambientLight");Pe.setStyle(l),m.color.set(Pe.add(e).multiplyScalar(.5))}),yt(),N.Instance.on("downbeat",()=>{te>100&&(N.Instance.emit("beat"),te=0)}),a.reset(),document.getElementById("intro").style.display="none",document.getElementById("c").style.display="block"};function Zt(){Te=A.xr.getReferenceSpace();const a={x:-1*me.x,y:-1*me.y,z:-1*me.z,w:1},e=new c.Quaternion,o=new XRRigidTransform(a,e),r=Te.getOffsetReferenceSpace(o);A.xr.setReferenceSpace(r)}function Re(a){const e=a.target,o=a.data.handedness==="left"?-1:1;if(!e.getObjectByName("target")){const s=new c.Group;s.name="target",s.rotation.set(0,0,0),s.position.set(-1*o*.035,.05,-.12),e.add(s)}let t=e.getObjectByName("paw");t||(t=_t(),t.position.set(0,0,.15),e.add(t));let n=e.getObjectByName("line");if(!n){const s=new c.BufferGeometry().setFromPoints([new c.Vector3(0,0,0),new c.Vector3(0,0,-1)]);n=new c.Line(s),n.material.color.set(ce),n.name="line",n.scale.z=5,e.add(n)}}function re(a){Y=a.target;const e=ze(Y);if(e.length>0){let o=!1;e.forEach(({object:r,distance:t})=>{if(o)return;let n=r;for(;n;){if(n.onPointerPick){n.onPointerPick(Y),o=!0;const s=Y.getObjectByName("line");s.visible=!1;break}n=n.parent}})}Y.userData.targetRayMode=a.data.targetRayMode}function ae(a){Y=a.target;const e=Y.userData.selected;e?.onPointerDrop&&e.onPointerDrop(Y);const o=Y.getObjectByName("line");o.visible=!0}function ze(a){return a.updateMatrixWorld(),fe.setFromXRController(a),fe.intersectObjects(D.children,!0)}function Oe(a){if(a.userData.targetRayMode==="screen"||a.userData.selected!==void 0)return;const e=a.getObjectByName("line"),o=ze(a);if(e&&(e.scale.z=5),o.length>0){let r=!1;o.forEach(({object:t,distance:n})=>{if(r)return;let s=t;for(;s;){if(s.userData.isPickable){const i=s.getObjectByName("highlight");i&&(i.visible=!0),e&&(e.scale.z=n),ge.push(s),r=!0;break}s=s.parent}})}}function Ft(){for(;ge.length;){const e=ge.pop().getObjectByName("highlight");e&&(e.visible=!1)}}function Ht(){const a=qt.getDelta();te+=a,te>=.5&&(N.Instance.emit("beat"),te-=.5),O.Instance.update(),N.Instance.emit("tick",a),Ft(),Oe(X),Oe(W),A.render(D,q)}const $t=()=>{q.aspect=window.innerWidth/window.innerHeight,q.updateProjectionMatrix(),A.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("p");a.onclick=jt});
